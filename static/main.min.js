(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
'use strict'

const GOVUKFrontend = require('govuk-frontend')
GOVUKFrontend.initAll()

},{"govuk-frontend":2}],2:[function(require,module,exports){
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
  typeof define === 'function' && define.amd ? define(['exports'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.GOVUKFrontend = global.GOVUKFrontend || {}));
})(this, (function (exports) { 'use strict';

  const version = '5.10.2';

  function getFragmentFromUrl(url) {
    if (!url.includes('#')) {
      return undefined;
    }
    return url.split('#').pop();
  }
  function getBreakpoint(name) {
    const property = `--govuk-frontend-breakpoint-${name}`;
    const value = window.getComputedStyle(document.documentElement).getPropertyValue(property);
    return {
      property,
      value: value || undefined
    };
  }
  function setFocus($element, options = {}) {
    var _options$onBeforeFocu;
    const isFocusable = $element.getAttribute('tabindex');
    if (!isFocusable) {
      $element.setAttribute('tabindex', '-1');
    }
    function onFocus() {
      $element.addEventListener('blur', onBlur, {
        once: true
      });
    }
    function onBlur() {
      var _options$onBlur;
      (_options$onBlur = options.onBlur) == null || _options$onBlur.call($element);
      if (!isFocusable) {
        $element.removeAttribute('tabindex');
      }
    }
    $element.addEventListener('focus', onFocus, {
      once: true
    });
    (_options$onBeforeFocu = options.onBeforeFocus) == null || _options$onBeforeFocu.call($element);
    $element.focus();
  }
  function isInitialised($root, moduleName) {
    return $root instanceof HTMLElement && $root.hasAttribute(`data-${moduleName}-init`);
  }

  /**
   * Checks if GOV.UK Frontend is supported on this page
   *
   * Some browsers will load and run our JavaScript but GOV.UK Frontend
   * won't be supported.
   *
   * @param {HTMLElement | null} [$scope] - (internal) `<body>` HTML element checked for browser support
   * @returns {boolean} Whether GOV.UK Frontend is supported on this page
   */
  function isSupported($scope = document.body) {
    if (!$scope) {
      return false;
    }
    return $scope.classList.contains('govuk-frontend-supported');
  }
  function isArray(option) {
    return Array.isArray(option);
  }
  function isObject(option) {
    return !!option && typeof option === 'object' && !isArray(option);
  }
  function formatErrorMessage(Component, message) {
    return `${Component.moduleName}: ${message}`;
  }
  /**
   * @typedef ComponentWithModuleName
   * @property {string} moduleName - Name of the component
   */
  /**
   * @import { ObjectNested } from './configuration.mjs'
   */

  class GOVUKFrontendError extends Error {
    constructor(...args) {
      super(...args);
      this.name = 'GOVUKFrontendError';
    }
  }
  class SupportError extends GOVUKFrontendError {
    /**
     * Checks if GOV.UK Frontend is supported on this page
     *
     * @param {HTMLElement | null} [$scope] - HTML element `<body>` checked for browser support
     */
    constructor($scope = document.body) {
      const supportMessage = 'noModule' in HTMLScriptElement.prototype ? 'GOV.UK Frontend initialised without `<body class="govuk-frontend-supported">` from template `<script>` snippet' : 'GOV.UK Frontend is not supported in this browser';
      super($scope ? supportMessage : 'GOV.UK Frontend initialised without `<script type="module">`');
      this.name = 'SupportError';
    }
  }
  class ConfigError extends GOVUKFrontendError {
    constructor(...args) {
      super(...args);
      this.name = 'ConfigError';
    }
  }
  class ElementError extends GOVUKFrontendError {
    constructor(messageOrOptions) {
      let message = typeof messageOrOptions === 'string' ? messageOrOptions : '';
      if (typeof messageOrOptions === 'object') {
        const {
          component,
          identifier,
          element,
          expectedType
        } = messageOrOptions;
        message = identifier;
        message += element ? ` is not of type ${expectedType != null ? expectedType : 'HTMLElement'}` : ' not found';
        message = formatErrorMessage(component, message);
      }
      super(message);
      this.name = 'ElementError';
    }
  }
  class InitError extends GOVUKFrontendError {
    constructor(componentOrMessage) {
      const message = typeof componentOrMessage === 'string' ? componentOrMessage : formatErrorMessage(componentOrMessage, `Root element (\`$root\`) already initialised`);
      super(message);
      this.name = 'InitError';
    }
  }
  /**
   * @import { ComponentWithModuleName } from '../common/index.mjs'
   */

  class Component {
    /**
     * Returns the root element of the component
     *
     * @protected
     * @returns {RootElementType} - the root element of component
     */
    get $root() {
      return this._$root;
    }
    constructor($root) {
      this._$root = void 0;
      const childConstructor = this.constructor;
      if (typeof childConstructor.moduleName !== 'string') {
        throw new InitError(`\`moduleName\` not defined in component`);
      }
      if (!($root instanceof childConstructor.elementType)) {
        throw new ElementError({
          element: $root,
          component: childConstructor,
          identifier: 'Root element (`$root`)',
          expectedType: childConstructor.elementType.name
        });
      } else {
        this._$root = $root;
      }
      childConstructor.checkSupport();
      this.checkInitialised();
      const moduleName = childConstructor.moduleName;
      this.$root.setAttribute(`data-${moduleName}-init`, '');
    }
    checkInitialised() {
      const constructor = this.constructor;
      const moduleName = constructor.moduleName;
      if (moduleName && isInitialised(this.$root, moduleName)) {
        throw new InitError(constructor);
      }
    }
    static checkSupport() {
      if (!isSupported()) {
        throw new SupportError();
      }
    }
  }

  /**
   * @typedef ChildClass
   * @property {string} moduleName - The module name that'll be looked for in the DOM when initialising the component
   */

  /**
   * @typedef {typeof Component & ChildClass} ChildClassConstructor
   */
  Component.elementType = HTMLElement;

  const configOverride = Symbol.for('configOverride');
  class ConfigurableComponent extends Component {
    [configOverride](param) {
      return {};
    }

    /**
     * Returns the root element of the component
     *
     * @protected
     * @returns {ConfigurationType} - the root element of component
     */
    get config() {
      return this._config;
    }
    constructor($root, config) {
      super($root);
      this._config = void 0;
      const childConstructor = this.constructor;
      if (!isObject(childConstructor.defaults)) {
        throw new ConfigError(formatErrorMessage(childConstructor, 'Config passed as parameter into constructor but no defaults defined'));
      }
      const datasetConfig = normaliseDataset(childConstructor, this._$root.dataset);
      this._config = mergeConfigs(childConstructor.defaults, config != null ? config : {}, this[configOverride](datasetConfig), datasetConfig);
    }
  }
  function normaliseString(value, property) {
    const trimmedValue = value ? value.trim() : '';
    let output;
    let outputType = property == null ? void 0 : property.type;
    if (!outputType) {
      if (['true', 'false'].includes(trimmedValue)) {
        outputType = 'boolean';
      }
      if (trimmedValue.length > 0 && isFinite(Number(trimmedValue))) {
        outputType = 'number';
      }
    }
    switch (outputType) {
      case 'boolean':
        output = trimmedValue === 'true';
        break;
      case 'number':
        output = Number(trimmedValue);
        break;
      default:
        output = value;
    }
    return output;
  }
  function normaliseDataset(Component, dataset) {
    if (!isObject(Component.schema)) {
      throw new ConfigError(formatErrorMessage(Component, 'Config passed as parameter into constructor but no schema defined'));
    }
    const out = {};
    const entries = Object.entries(Component.schema.properties);
    for (const entry of entries) {
      const [namespace, property] = entry;
      const field = namespace.toString();
      if (field in dataset) {
        out[field] = normaliseString(dataset[field], property);
      }
      if ((property == null ? void 0 : property.type) === 'object') {
        out[field] = extractConfigByNamespace(Component.schema, dataset, namespace);
      }
    }
    return out;
  }
  function mergeConfigs(...configObjects) {
    const formattedConfigObject = {};
    for (const configObject of configObjects) {
      for (const key of Object.keys(configObject)) {
        const option = formattedConfigObject[key];
        const override = configObject[key];
        if (isObject(option) && isObject(override)) {
          formattedConfigObject[key] = mergeConfigs(option, override);
        } else {
          formattedConfigObject[key] = override;
        }
      }
    }
    return formattedConfigObject;
  }
  function validateConfig(schema, config) {
    const validationErrors = [];
    for (const [name, conditions] of Object.entries(schema)) {
      const errors = [];
      if (Array.isArray(conditions)) {
        for (const {
          required,
          errorMessage
        } of conditions) {
          if (!required.every(key => !!config[key])) {
            errors.push(errorMessage);
          }
        }
        if (name === 'anyOf' && !(conditions.length - errors.length >= 1)) {
          validationErrors.push(...errors);
        }
      }
    }
    return validationErrors;
  }
  function extractConfigByNamespace(schema, dataset, namespace) {
    const property = schema.properties[namespace];
    if ((property == null ? void 0 : property.type) !== 'object') {
      return;
    }
    const newObject = {
      [namespace]: {}
    };
    for (const [key, value] of Object.entries(dataset)) {
      let current = newObject;
      const keyParts = key.split('.');
      for (const [index, name] of keyParts.entries()) {
        if (isObject(current)) {
          if (index < keyParts.length - 1) {
            if (!isObject(current[name])) {
              current[name] = {};
            }
            current = current[name];
          } else if (key !== namespace) {
            current[name] = normaliseString(value);
          }
        }
      }
    }
    return newObject[namespace];
  }
  /**
   * Schema for component config
   *
   * @template {Partial<Record<keyof ConfigurationType, unknown>>} ConfigurationType
   * @typedef {object} Schema
   * @property {Record<keyof ConfigurationType, SchemaProperty | undefined>} properties - Schema properties
   * @property {SchemaCondition<ConfigurationType>[]} [anyOf] - List of schema conditions
   */
  /**
   * Schema property for component config
   *
   * @typedef {object} SchemaProperty
   * @property {'string' | 'boolean' | 'number' | 'object'} type - Property type
   */
  /**
   * Schema condition for component config
   *
   * @template {Partial<Record<keyof ConfigurationType, unknown>>} ConfigurationType
   * @typedef {object} SchemaCondition
   * @property {(keyof ConfigurationType)[]} required - List of required config fields
   * @property {string} errorMessage - Error message when required config fields not provided
   */
  /**
   * @template {Partial<Record<keyof ConfigurationType, unknown>>} [ConfigurationType=ObjectNested]
   * @typedef ChildClass
   * @property {string} moduleName - The module name that'll be looked for in the DOM when initialising the component
   * @property {Schema<ConfigurationType>} [schema] - The schema of the component configuration
   * @property {ConfigurationType} [defaults] - The default values of the configuration of the component
   */
  /**
   * @template {Partial<Record<keyof ConfigurationType, unknown>>} [ConfigurationType=ObjectNested]
   * @typedef {typeof Component & ChildClass<ConfigurationType>} ChildClassConstructor<ConfigurationType>
   */

  class I18n {
    constructor(translations = {}, config = {}) {
      var _config$locale;
      this.translations = void 0;
      this.locale = void 0;
      this.translations = translations;
      this.locale = (_config$locale = config.locale) != null ? _config$locale : document.documentElement.lang || 'en';
    }
    t(lookupKey, options) {
      if (!lookupKey) {
        throw new Error('i18n: lookup key missing');
      }
      let translation = this.translations[lookupKey];
      if (typeof (options == null ? void 0 : options.count) === 'number' && typeof translation === 'object') {
        const translationPluralForm = translation[this.getPluralSuffix(lookupKey, options.count)];
        if (translationPluralForm) {
          translation = translationPluralForm;
        }
      }
      if (typeof translation === 'string') {
        if (translation.match(/%{(.\S+)}/)) {
          if (!options) {
            throw new Error('i18n: cannot replace placeholders in string if no option data provided');
          }
          return this.replacePlaceholders(translation, options);
        }
        return translation;
      }
      return lookupKey;
    }
    replacePlaceholders(translationString, options) {
      const formatter = Intl.NumberFormat.supportedLocalesOf(this.locale).length ? new Intl.NumberFormat(this.locale) : undefined;
      return translationString.replace(/%{(.\S+)}/g, function (placeholderWithBraces, placeholderKey) {
        if (Object.prototype.hasOwnProperty.call(options, placeholderKey)) {
          const placeholderValue = options[placeholderKey];
          if (placeholderValue === false || typeof placeholderValue !== 'number' && typeof placeholderValue !== 'string') {
            return '';
          }
          if (typeof placeholderValue === 'number') {
            return formatter ? formatter.format(placeholderValue) : `${placeholderValue}`;
          }
          return placeholderValue;
        }
        throw new Error(`i18n: no data found to replace ${placeholderWithBraces} placeholder in string`);
      });
    }
    hasIntlPluralRulesSupport() {
      return Boolean('PluralRules' in window.Intl && Intl.PluralRules.supportedLocalesOf(this.locale).length);
    }
    getPluralSuffix(lookupKey, count) {
      count = Number(count);
      if (!isFinite(count)) {
        return 'other';
      }
      const translation = this.translations[lookupKey];
      const preferredForm = this.hasIntlPluralRulesSupport() ? new Intl.PluralRules(this.locale).select(count) : this.selectPluralFormUsingFallbackRules(count);
      if (typeof translation === 'object') {
        if (preferredForm in translation) {
          return preferredForm;
        } else if ('other' in translation) {
          console.warn(`i18n: Missing plural form ".${preferredForm}" for "${this.locale}" locale. Falling back to ".other".`);
          return 'other';
        }
      }
      throw new Error(`i18n: Plural form ".other" is required for "${this.locale}" locale`);
    }
    selectPluralFormUsingFallbackRules(count) {
      count = Math.abs(Math.floor(count));
      const ruleset = this.getPluralRulesForLocale();
      if (ruleset) {
        return I18n.pluralRules[ruleset](count);
      }
      return 'other';
    }
    getPluralRulesForLocale() {
      const localeShort = this.locale.split('-')[0];
      for (const pluralRule in I18n.pluralRulesMap) {
        const languages = I18n.pluralRulesMap[pluralRule];
        if (languages.includes(this.locale) || languages.includes(localeShort)) {
          return pluralRule;
        }
      }
    }
  }
  I18n.pluralRulesMap = {
    arabic: ['ar'],
    chinese: ['my', 'zh', 'id', 'ja', 'jv', 'ko', 'ms', 'th', 'vi'],
    french: ['hy', 'bn', 'fr', 'gu', 'hi', 'fa', 'pa', 'zu'],
    german: ['af', 'sq', 'az', 'eu', 'bg', 'ca', 'da', 'nl', 'en', 'et', 'fi', 'ka', 'de', 'el', 'hu', 'lb', 'no', 'so', 'sw', 'sv', 'ta', 'te', 'tr', 'ur'],
    irish: ['ga'],
    russian: ['ru', 'uk'],
    scottish: ['gd'],
    spanish: ['pt-PT', 'it', 'es'],
    welsh: ['cy']
  };
  I18n.pluralRules = {
    arabic(n) {
      if (n === 0) {
        return 'zero';
      }
      if (n === 1) {
        return 'one';
      }
      if (n === 2) {
        return 'two';
      }
      if (n % 100 >= 3 && n % 100 <= 10) {
        return 'few';
      }
      if (n % 100 >= 11 && n % 100 <= 99) {
        return 'many';
      }
      return 'other';
    },
    chinese() {
      return 'other';
    },
    french(n) {
      return n === 0 || n === 1 ? 'one' : 'other';
    },
    german(n) {
      return n === 1 ? 'one' : 'other';
    },
    irish(n) {
      if (n === 1) {
        return 'one';
      }
      if (n === 2) {
        return 'two';
      }
      if (n >= 3 && n <= 6) {
        return 'few';
      }
      if (n >= 7 && n <= 10) {
        return 'many';
      }
      return 'other';
    },
    russian(n) {
      const lastTwo = n % 100;
      const last = lastTwo % 10;
      if (last === 1 && lastTwo !== 11) {
        return 'one';
      }
      if (last >= 2 && last <= 4 && !(lastTwo >= 12 && lastTwo <= 14)) {
        return 'few';
      }
      if (last === 0 || last >= 5 && last <= 9 || lastTwo >= 11 && lastTwo <= 14) {
        return 'many';
      }
      return 'other';
    },
    scottish(n) {
      if (n === 1 || n === 11) {
        return 'one';
      }
      if (n === 2 || n === 12) {
        return 'two';
      }
      if (n >= 3 && n <= 10 || n >= 13 && n <= 19) {
        return 'few';
      }
      return 'other';
    },
    spanish(n) {
      if (n === 1) {
        return 'one';
      }
      if (n % 1000000 === 0 && n !== 0) {
        return 'many';
      }
      return 'other';
    },
    welsh(n) {
      if (n === 0) {
        return 'zero';
      }
      if (n === 1) {
        return 'one';
      }
      if (n === 2) {
        return 'two';
      }
      if (n === 3) {
        return 'few';
      }
      if (n === 6) {
        return 'many';
      }
      return 'other';
    }
  };

  /**
   * Accordion component
   *
   * This allows a collection of sections to be collapsed by default, showing only
   * their headers. Sections can be expanded or collapsed individually by clicking
   * their headers. A "Show all sections" button is also added to the top of the
   * accordion, which switches to "Hide all sections" when all the sections are
   * expanded.
   *
   * The state of each section is saved to the DOM via the `aria-expanded`
   * attribute, which also provides accessibility.
   *
   * @preserve
   * @augments ConfigurableComponent<AccordionConfig>
   */
  class Accordion extends ConfigurableComponent {
    /**
     * @param {Element | null} $root - HTML element to use for accordion
     * @param {AccordionConfig} [config] - Accordion config
     */
    constructor($root, config = {}) {
      super($root, config);
      this.i18n = void 0;
      this.controlsClass = 'govuk-accordion__controls';
      this.showAllClass = 'govuk-accordion__show-all';
      this.showAllTextClass = 'govuk-accordion__show-all-text';
      this.sectionClass = 'govuk-accordion__section';
      this.sectionExpandedClass = 'govuk-accordion__section--expanded';
      this.sectionButtonClass = 'govuk-accordion__section-button';
      this.sectionHeaderClass = 'govuk-accordion__section-header';
      this.sectionHeadingClass = 'govuk-accordion__section-heading';
      this.sectionHeadingDividerClass = 'govuk-accordion__section-heading-divider';
      this.sectionHeadingTextClass = 'govuk-accordion__section-heading-text';
      this.sectionHeadingTextFocusClass = 'govuk-accordion__section-heading-text-focus';
      this.sectionShowHideToggleClass = 'govuk-accordion__section-toggle';
      this.sectionShowHideToggleFocusClass = 'govuk-accordion__section-toggle-focus';
      this.sectionShowHideTextClass = 'govuk-accordion__section-toggle-text';
      this.upChevronIconClass = 'govuk-accordion-nav__chevron';
      this.downChevronIconClass = 'govuk-accordion-nav__chevron--down';
      this.sectionSummaryClass = 'govuk-accordion__section-summary';
      this.sectionSummaryFocusClass = 'govuk-accordion__section-summary-focus';
      this.sectionContentClass = 'govuk-accordion__section-content';
      this.$sections = void 0;
      this.$showAllButton = null;
      this.$showAllIcon = null;
      this.$showAllText = null;
      this.i18n = new I18n(this.config.i18n);
      const $sections = this.$root.querySelectorAll(`.${this.sectionClass}`);
      if (!$sections.length) {
        throw new ElementError({
          component: Accordion,
          identifier: `Sections (\`<div class="${this.sectionClass}">\`)`
        });
      }
      this.$sections = $sections;
      this.initControls();
      this.initSectionHeaders();
      this.updateShowAllButton(this.areAllSectionsOpen());
    }
    initControls() {
      this.$showAllButton = document.createElement('button');
      this.$showAllButton.setAttribute('type', 'button');
      this.$showAllButton.setAttribute('class', this.showAllClass);
      this.$showAllButton.setAttribute('aria-expanded', 'false');
      this.$showAllIcon = document.createElement('span');
      this.$showAllIcon.classList.add(this.upChevronIconClass);
      this.$showAllButton.appendChild(this.$showAllIcon);
      const $accordionControls = document.createElement('div');
      $accordionControls.setAttribute('class', this.controlsClass);
      $accordionControls.appendChild(this.$showAllButton);
      this.$root.insertBefore($accordionControls, this.$root.firstChild);
      this.$showAllText = document.createElement('span');
      this.$showAllText.classList.add(this.showAllTextClass);
      this.$showAllButton.appendChild(this.$showAllText);
      this.$showAllButton.addEventListener('click', () => this.onShowOrHideAllToggle());
      if ('onbeforematch' in document) {
        document.addEventListener('beforematch', event => this.onBeforeMatch(event));
      }
    }
    initSectionHeaders() {
      this.$sections.forEach(($section, i) => {
        const $header = $section.querySelector(`.${this.sectionHeaderClass}`);
        if (!$header) {
          throw new ElementError({
            component: Accordion,
            identifier: `Section headers (\`<div class="${this.sectionHeaderClass}">\`)`
          });
        }
        this.constructHeaderMarkup($header, i);
        this.setExpanded(this.isExpanded($section), $section);
        $header.addEventListener('click', () => this.onSectionToggle($section));
        this.setInitialState($section);
      });
    }
    constructHeaderMarkup($header, index) {
      const $span = $header.querySelector(`.${this.sectionButtonClass}`);
      const $heading = $header.querySelector(`.${this.sectionHeadingClass}`);
      const $summary = $header.querySelector(`.${this.sectionSummaryClass}`);
      if (!$heading) {
        throw new ElementError({
          component: Accordion,
          identifier: `Section heading (\`.${this.sectionHeadingClass}\`)`
        });
      }
      if (!$span) {
        throw new ElementError({
          component: Accordion,
          identifier: `Section button placeholder (\`<span class="${this.sectionButtonClass}">\`)`
        });
      }
      const $button = document.createElement('button');
      $button.setAttribute('type', 'button');
      $button.setAttribute('aria-controls', `${this.$root.id}-content-${index + 1}`);
      for (const attr of Array.from($span.attributes)) {
        if (attr.name !== 'id') {
          $button.setAttribute(attr.name, attr.value);
        }
      }
      const $headingText = document.createElement('span');
      $headingText.classList.add(this.sectionHeadingTextClass);
      $headingText.id = $span.id;
      const $headingTextFocus = document.createElement('span');
      $headingTextFocus.classList.add(this.sectionHeadingTextFocusClass);
      $headingText.appendChild($headingTextFocus);
      Array.from($span.childNodes).forEach($child => $headingTextFocus.appendChild($child));
      const $showHideToggle = document.createElement('span');
      $showHideToggle.classList.add(this.sectionShowHideToggleClass);
      $showHideToggle.setAttribute('data-nosnippet', '');
      const $showHideToggleFocus = document.createElement('span');
      $showHideToggleFocus.classList.add(this.sectionShowHideToggleFocusClass);
      $showHideToggle.appendChild($showHideToggleFocus);
      const $showHideText = document.createElement('span');
      const $showHideIcon = document.createElement('span');
      $showHideIcon.classList.add(this.upChevronIconClass);
      $showHideToggleFocus.appendChild($showHideIcon);
      $showHideText.classList.add(this.sectionShowHideTextClass);
      $showHideToggleFocus.appendChild($showHideText);
      $button.appendChild($headingText);
      $button.appendChild(this.getButtonPunctuationEl());
      if ($summary) {
        const $summarySpan = document.createElement('span');
        const $summarySpanFocus = document.createElement('span');
        $summarySpanFocus.classList.add(this.sectionSummaryFocusClass);
        $summarySpan.appendChild($summarySpanFocus);
        for (const attr of Array.from($summary.attributes)) {
          $summarySpan.setAttribute(attr.name, attr.value);
        }
        Array.from($summary.childNodes).forEach($child => $summarySpanFocus.appendChild($child));
        $summary.remove();
        $button.appendChild($summarySpan);
        $button.appendChild(this.getButtonPunctuationEl());
      }
      $button.appendChild($showHideToggle);
      $heading.removeChild($span);
      $heading.appendChild($button);
    }
    onBeforeMatch(event) {
      const $fragment = event.target;
      if (!($fragment instanceof Element)) {
        return;
      }
      const $section = $fragment.closest(`.${this.sectionClass}`);
      if ($section) {
        this.setExpanded(true, $section);
      }
    }
    onSectionToggle($section) {
      const nowExpanded = !this.isExpanded($section);
      this.setExpanded(nowExpanded, $section);
      this.storeState($section, nowExpanded);
    }
    onShowOrHideAllToggle() {
      const nowExpanded = !this.areAllSectionsOpen();
      this.$sections.forEach($section => {
        this.setExpanded(nowExpanded, $section);
        this.storeState($section, nowExpanded);
      });
      this.updateShowAllButton(nowExpanded);
    }
    setExpanded(expanded, $section) {
      const $showHideIcon = $section.querySelector(`.${this.upChevronIconClass}`);
      const $showHideText = $section.querySelector(`.${this.sectionShowHideTextClass}`);
      const $button = $section.querySelector(`.${this.sectionButtonClass}`);
      const $content = $section.querySelector(`.${this.sectionContentClass}`);
      if (!$content) {
        throw new ElementError({
          component: Accordion,
          identifier: `Section content (\`<div class="${this.sectionContentClass}">\`)`
        });
      }
      if (!$showHideIcon || !$showHideText || !$button) {
        return;
      }
      const newButtonText = expanded ? this.i18n.t('hideSection') : this.i18n.t('showSection');
      $showHideText.textContent = newButtonText;
      $button.setAttribute('aria-expanded', `${expanded}`);
      const ariaLabelParts = [];
      const $headingText = $section.querySelector(`.${this.sectionHeadingTextClass}`);
      if ($headingText) {
        ariaLabelParts.push(`${$headingText.textContent}`.trim());
      }
      const $summary = $section.querySelector(`.${this.sectionSummaryClass}`);
      if ($summary) {
        ariaLabelParts.push(`${$summary.textContent}`.trim());
      }
      const ariaLabelMessage = expanded ? this.i18n.t('hideSectionAriaLabel') : this.i18n.t('showSectionAriaLabel');
      ariaLabelParts.push(ariaLabelMessage);
      $button.setAttribute('aria-label', ariaLabelParts.join(' , '));
      if (expanded) {
        $content.removeAttribute('hidden');
        $section.classList.add(this.sectionExpandedClass);
        $showHideIcon.classList.remove(this.downChevronIconClass);
      } else {
        $content.setAttribute('hidden', 'until-found');
        $section.classList.remove(this.sectionExpandedClass);
        $showHideIcon.classList.add(this.downChevronIconClass);
      }
      this.updateShowAllButton(this.areAllSectionsOpen());
    }
    isExpanded($section) {
      return $section.classList.contains(this.sectionExpandedClass);
    }
    areAllSectionsOpen() {
      return Array.from(this.$sections).every($section => this.isExpanded($section));
    }
    updateShowAllButton(expanded) {
      if (!this.$showAllButton || !this.$showAllText || !this.$showAllIcon) {
        return;
      }
      this.$showAllButton.setAttribute('aria-expanded', expanded.toString());
      this.$showAllText.textContent = expanded ? this.i18n.t('hideAllSections') : this.i18n.t('showAllSections');
      this.$showAllIcon.classList.toggle(this.downChevronIconClass, !expanded);
    }

    /**
     * Get the identifier for a section
     *
     * We need a unique way of identifying each content in the Accordion.
     * Since an `#id` should be unique and an `id` is required for `aria-`
     * attributes `id` can be safely used.
     *
     * @param {Element} $section - Section element
     * @returns {string | undefined | null} Identifier for section
     */
    getIdentifier($section) {
      const $button = $section.querySelector(`.${this.sectionButtonClass}`);
      return $button == null ? void 0 : $button.getAttribute('aria-controls');
    }
    storeState($section, isExpanded) {
      if (!this.config.rememberExpanded) {
        return;
      }
      const id = this.getIdentifier($section);
      if (id) {
        try {
          window.sessionStorage.setItem(id, isExpanded.toString());
        } catch (exception) {}
      }
    }
    setInitialState($section) {
      if (!this.config.rememberExpanded) {
        return;
      }
      const id = this.getIdentifier($section);
      if (id) {
        try {
          const state = window.sessionStorage.getItem(id);
          if (state !== null) {
            this.setExpanded(state === 'true', $section);
          }
        } catch (exception) {}
      }
    }
    getButtonPunctuationEl() {
      const $punctuationEl = document.createElement('span');
      $punctuationEl.classList.add('govuk-visually-hidden', this.sectionHeadingDividerClass);
      $punctuationEl.textContent = ', ';
      return $punctuationEl;
    }
  }

  /**
   * Accordion config
   *
   * @see {@link Accordion.defaults}
   * @typedef {object} AccordionConfig
   * @property {AccordionTranslations} [i18n=Accordion.defaults.i18n] - Accordion translations
   * @property {boolean} [rememberExpanded] - Whether the expanded and collapsed
   *   state of each section is remembered and restored when navigating.
   */

  /**
   * Accordion translations
   *
   * @see {@link Accordion.defaults.i18n}
   * @typedef {object} AccordionTranslations
   *
   * Messages used by the component for the labels of its buttons. This includes
   * the visible text shown on screen, and text to help assistive technology users
   * for the buttons toggling each section.
   * @property {string} [hideAllSections] - The text content for the 'Hide all
   *   sections' button, used when at least one section is expanded.
   * @property {string} [hideSection] - The text content for the 'Hide'
   *   button, used when a section is expanded.
   * @property {string} [hideSectionAriaLabel] - The text content appended to the
   *   'Hide' button's accessible name when a section is expanded.
   * @property {string} [showAllSections] - The text content for the 'Show all
   *   sections' button, used when all sections are collapsed.
   * @property {string} [showSection] - The text content for the 'Show'
   *   button, used when a section is collapsed.
   * @property {string} [showSectionAriaLabel] - The text content appended to the
   *   'Show' button's accessible name when a section is expanded.
   */

  /**
   * @import { Schema } from '../../common/configuration.mjs'
   */
  Accordion.moduleName = 'govuk-accordion';
  Accordion.defaults = Object.freeze({
    i18n: {
      hideAllSections: 'Hide all sections',
      hideSection: 'Hide',
      hideSectionAriaLabel: 'Hide this section',
      showAllSections: 'Show all sections',
      showSection: 'Show',
      showSectionAriaLabel: 'Show this section'
    },
    rememberExpanded: true
  });
  Accordion.schema = Object.freeze({
    properties: {
      i18n: {
        type: 'object'
      },
      rememberExpanded: {
        type: 'boolean'
      }
    }
  });

  const DEBOUNCE_TIMEOUT_IN_SECONDS = 1;

  /**
   * JavaScript enhancements for the Button component
   *
   * @preserve
   * @augments ConfigurableComponent<ButtonConfig>
   */
  class Button extends ConfigurableComponent {
    /**
     * @param {Element | null} $root - HTML element to use for button
     * @param {ButtonConfig} [config] - Button config
     */
    constructor($root, config = {}) {
      super($root, config);
      this.debounceFormSubmitTimer = null;
      this.$root.addEventListener('keydown', event => this.handleKeyDown(event));
      this.$root.addEventListener('click', event => this.debounce(event));
    }
    handleKeyDown(event) {
      const $target = event.target;
      if (event.key !== ' ') {
        return;
      }
      if ($target instanceof HTMLElement && $target.getAttribute('role') === 'button') {
        event.preventDefault();
        $target.click();
      }
    }
    debounce(event) {
      if (!this.config.preventDoubleClick) {
        return;
      }
      if (this.debounceFormSubmitTimer) {
        event.preventDefault();
        return false;
      }
      this.debounceFormSubmitTimer = window.setTimeout(() => {
        this.debounceFormSubmitTimer = null;
      }, DEBOUNCE_TIMEOUT_IN_SECONDS * 1000);
    }
  }

  /**
   * Button config
   *
   * @typedef {object} ButtonConfig
   * @property {boolean} [preventDoubleClick=false] - Prevent accidental double
   *   clicks on submit buttons from submitting forms multiple times.
   */

  /**
   * @import { Schema } from '../../common/configuration.mjs'
   */
  Button.moduleName = 'govuk-button';
  Button.defaults = Object.freeze({
    preventDoubleClick: false
  });
  Button.schema = Object.freeze({
    properties: {
      preventDoubleClick: {
        type: 'boolean'
      }
    }
  });

  function closestAttributeValue($element, attributeName) {
    const $closestElementWithAttribute = $element.closest(`[${attributeName}]`);
    return $closestElementWithAttribute ? $closestElementWithAttribute.getAttribute(attributeName) : null;
  }

  /**
   * Character count component
   *
   * Tracks the number of characters or words in the `.govuk-js-character-count`
   * `<textarea>` inside the element. Displays a message with the remaining number
   * of characters/words available, or the number of characters/words in excess.
   *
   * You can configure the message to only appear after a certain percentage
   * of the available characters/words has been entered.
   *
   * @preserve
   * @augments ConfigurableComponent<CharacterCountConfig>
   */
  class CharacterCount extends ConfigurableComponent {
    [configOverride](datasetConfig) {
      let configOverrides = {};
      if ('maxwords' in datasetConfig || 'maxlength' in datasetConfig) {
        configOverrides = {
          maxlength: undefined,
          maxwords: undefined
        };
      }
      return configOverrides;
    }

    /**
     * @param {Element | null} $root - HTML element to use for character count
     * @param {CharacterCountConfig} [config] - Character count config
     */
    constructor($root, config = {}) {
      var _ref, _this$config$maxwords;
      super($root, config);
      this.$textarea = void 0;
      this.$visibleCountMessage = void 0;
      this.$screenReaderCountMessage = void 0;
      this.lastInputTimestamp = null;
      this.lastInputValue = '';
      this.valueChecker = null;
      this.i18n = void 0;
      this.maxLength = void 0;
      const $textarea = this.$root.querySelector('.govuk-js-character-count');
      if (!($textarea instanceof HTMLTextAreaElement || $textarea instanceof HTMLInputElement)) {
        throw new ElementError({
          component: CharacterCount,
          element: $textarea,
          expectedType: 'HTMLTextareaElement or HTMLInputElement',
          identifier: 'Form field (`.govuk-js-character-count`)'
        });
      }
      const errors = validateConfig(CharacterCount.schema, this.config);
      if (errors[0]) {
        throw new ConfigError(formatErrorMessage(CharacterCount, errors[0]));
      }
      this.i18n = new I18n(this.config.i18n, {
        locale: closestAttributeValue(this.$root, 'lang')
      });
      this.maxLength = (_ref = (_this$config$maxwords = this.config.maxwords) != null ? _this$config$maxwords : this.config.maxlength) != null ? _ref : Infinity;
      this.$textarea = $textarea;
      const textareaDescriptionId = `${this.$textarea.id}-info`;
      const $textareaDescription = document.getElementById(textareaDescriptionId);
      if (!$textareaDescription) {
        throw new ElementError({
          component: CharacterCount,
          element: $textareaDescription,
          identifier: `Count message (\`id="${textareaDescriptionId}"\`)`
        });
      }
      this.$errorMessage = this.$root.querySelector('.govuk-error-message');
      if (`${$textareaDescription.textContent}`.match(/^\s*$/)) {
        $textareaDescription.textContent = this.i18n.t('textareaDescription', {
          count: this.maxLength
        });
      }
      this.$textarea.insertAdjacentElement('afterend', $textareaDescription);
      const $screenReaderCountMessage = document.createElement('div');
      $screenReaderCountMessage.className = 'govuk-character-count__sr-status govuk-visually-hidden';
      $screenReaderCountMessage.setAttribute('aria-live', 'polite');
      this.$screenReaderCountMessage = $screenReaderCountMessage;
      $textareaDescription.insertAdjacentElement('afterend', $screenReaderCountMessage);
      const $visibleCountMessage = document.createElement('div');
      $visibleCountMessage.className = $textareaDescription.className;
      $visibleCountMessage.classList.add('govuk-character-count__status');
      $visibleCountMessage.setAttribute('aria-hidden', 'true');
      this.$visibleCountMessage = $visibleCountMessage;
      $textareaDescription.insertAdjacentElement('afterend', $visibleCountMessage);
      $textareaDescription.classList.add('govuk-visually-hidden');
      this.$textarea.removeAttribute('maxlength');
      this.bindChangeEvents();
      window.addEventListener('pageshow', () => this.updateCountMessage());
      this.updateCountMessage();
    }
    bindChangeEvents() {
      this.$textarea.addEventListener('keyup', () => this.handleKeyUp());
      this.$textarea.addEventListener('focus', () => this.handleFocus());
      this.$textarea.addEventListener('blur', () => this.handleBlur());
    }
    handleKeyUp() {
      this.updateVisibleCountMessage();
      this.lastInputTimestamp = Date.now();
    }
    handleFocus() {
      this.valueChecker = window.setInterval(() => {
        if (!this.lastInputTimestamp || Date.now() - 500 >= this.lastInputTimestamp) {
          this.updateIfValueChanged();
        }
      }, 1000);
    }
    handleBlur() {
      if (this.valueChecker) {
        window.clearInterval(this.valueChecker);
      }
    }
    updateIfValueChanged() {
      if (this.$textarea.value !== this.lastInputValue) {
        this.lastInputValue = this.$textarea.value;
        this.updateCountMessage();
      }
    }
    updateCountMessage() {
      this.updateVisibleCountMessage();
      this.updateScreenReaderCountMessage();
    }
    updateVisibleCountMessage() {
      const remainingNumber = this.maxLength - this.count(this.$textarea.value);
      const isError = remainingNumber < 0;
      this.$visibleCountMessage.classList.toggle('govuk-character-count__message--disabled', !this.isOverThreshold());
      if (!this.$errorMessage) {
        this.$textarea.classList.toggle('govuk-textarea--error', isError);
      }
      this.$visibleCountMessage.classList.toggle('govuk-error-message', isError);
      this.$visibleCountMessage.classList.toggle('govuk-hint', !isError);
      this.$visibleCountMessage.textContent = this.getCountMessage();
    }
    updateScreenReaderCountMessage() {
      if (this.isOverThreshold()) {
        this.$screenReaderCountMessage.removeAttribute('aria-hidden');
      } else {
        this.$screenReaderCountMessage.setAttribute('aria-hidden', 'true');
      }
      this.$screenReaderCountMessage.textContent = this.getCountMessage();
    }
    count(text) {
      if (this.config.maxwords) {
        var _text$match;
        const tokens = (_text$match = text.match(/\S+/g)) != null ? _text$match : [];
        return tokens.length;
      }
      return text.length;
    }
    getCountMessage() {
      const remainingNumber = this.maxLength - this.count(this.$textarea.value);
      const countType = this.config.maxwords ? 'words' : 'characters';
      return this.formatCountMessage(remainingNumber, countType);
    }
    formatCountMessage(remainingNumber, countType) {
      if (remainingNumber === 0) {
        return this.i18n.t(`${countType}AtLimit`);
      }
      const translationKeySuffix = remainingNumber < 0 ? 'OverLimit' : 'UnderLimit';
      return this.i18n.t(`${countType}${translationKeySuffix}`, {
        count: Math.abs(remainingNumber)
      });
    }
    isOverThreshold() {
      if (!this.config.threshold) {
        return true;
      }
      const currentLength = this.count(this.$textarea.value);
      const maxLength = this.maxLength;
      const thresholdValue = maxLength * this.config.threshold / 100;
      return thresholdValue <= currentLength;
    }
  }

  /**
   * Character count config
   *
   * @see {@link CharacterCount.defaults}
   * @typedef {object} CharacterCountConfig
   * @property {number} [maxlength] - The maximum number of characters.
   *   If maxwords is provided, the maxlength option will be ignored.
   * @property {number} [maxwords] - The maximum number of words. If maxwords is
   *   provided, the maxlength option will be ignored.
   * @property {number} [threshold=0] - The percentage value of the limit at
   *   which point the count message is displayed. If this attribute is set, the
   *   count message will be hidden by default.
   * @property {CharacterCountTranslations} [i18n=CharacterCount.defaults.i18n] - Character count translations
   */

  /**
   * Character count translations
   *
   * @see {@link CharacterCount.defaults.i18n}
   * @typedef {object} CharacterCountTranslations
   *
   * Messages shown to users as they type. It provides feedback on how many words
   * or characters they have remaining or if they are over the limit. This also
   * includes a message used as an accessible description for the textarea.
   * @property {TranslationPluralForms} [charactersUnderLimit] - Message displayed
   *   when the number of characters is under the configured maximum, `maxlength`.
   *   This message is displayed visually and through assistive technologies. The
   *   component will replace the `%{count}` placeholder with the number of
   *   remaining characters. This is a [pluralised list of
   *   messages](https://frontend.design-system.service.gov.uk/localise-govuk-frontend).
   * @property {string} [charactersAtLimit] - Message displayed when the number of
   *   characters reaches the configured maximum, `maxlength`. This message is
   *   displayed visually and through assistive technologies.
   * @property {TranslationPluralForms} [charactersOverLimit] - Message displayed
   *   when the number of characters is over the configured maximum, `maxlength`.
   *   This message is displayed visually and through assistive technologies. The
   *   component will replace the `%{count}` placeholder with the number of
   *   remaining characters. This is a [pluralised list of
   *   messages](https://frontend.design-system.service.gov.uk/localise-govuk-frontend).
   * @property {TranslationPluralForms} [wordsUnderLimit] - Message displayed when
   *   the number of words is under the configured maximum, `maxlength`. This
   *   message is displayed visually and through assistive technologies. The
   *   component will replace the `%{count}` placeholder with the number of
   *   remaining words. This is a [pluralised list of
   *   messages](https://frontend.design-system.service.gov.uk/localise-govuk-frontend).
   * @property {string} [wordsAtLimit] - Message displayed when the number of
   *   words reaches the configured maximum, `maxlength`. This message is
   *   displayed visually and through assistive technologies.
   * @property {TranslationPluralForms} [wordsOverLimit] - Message displayed when
   *   the number of words is over the configured maximum, `maxlength`. This
   *   message is displayed visually and through assistive technologies. The
   *   component will replace the `%{count}` placeholder with the number of
   *   remaining words. This is a [pluralised list of
   *   messages](https://frontend.design-system.service.gov.uk/localise-govuk-frontend).
   * @property {TranslationPluralForms} [textareaDescription] - Message made
   *   available to assistive technologies, if none is already present in the
   *   HTML, to describe that the component accepts only a limited amount of
   *   content. It is visible on the page when JavaScript is unavailable. The
   *   component will replace the `%{count}` placeholder with the value of the
   *   `maxlength` or `maxwords` parameter.
   */

  /**
   * @import { Schema } from '../../common/configuration.mjs'
   * @import { TranslationPluralForms } from '../../i18n.mjs'
   */
  CharacterCount.moduleName = 'govuk-character-count';
  CharacterCount.defaults = Object.freeze({
    threshold: 0,
    i18n: {
      charactersUnderLimit: {
        one: 'You have %{count} character remaining',
        other: 'You have %{count} characters remaining'
      },
      charactersAtLimit: 'You have 0 characters remaining',
      charactersOverLimit: {
        one: 'You have %{count} character too many',
        other: 'You have %{count} characters too many'
      },
      wordsUnderLimit: {
        one: 'You have %{count} word remaining',
        other: 'You have %{count} words remaining'
      },
      wordsAtLimit: 'You have 0 words remaining',
      wordsOverLimit: {
        one: 'You have %{count} word too many',
        other: 'You have %{count} words too many'
      },
      textareaDescription: {
        other: ''
      }
    }
  });
  CharacterCount.schema = Object.freeze({
    properties: {
      i18n: {
        type: 'object'
      },
      maxwords: {
        type: 'number'
      },
      maxlength: {
        type: 'number'
      },
      threshold: {
        type: 'number'
      }
    },
    anyOf: [{
      required: ['maxwords'],
      errorMessage: 'Either "maxlength" or "maxwords" must be provided'
    }, {
      required: ['maxlength'],
      errorMessage: 'Either "maxlength" or "maxwords" must be provided'
    }]
  });

  /**
   * Checkboxes component
   *
   * @preserve
   */
  class Checkboxes extends Component {
    /**
     * Checkboxes can be associated with a 'conditionally revealed' content block
     * – for example, a checkbox for 'Phone' could reveal an additional form field
     * for the user to enter their phone number.
     *
     * These associations are made using a `data-aria-controls` attribute, which
     * is promoted to an aria-controls attribute during initialisation.
     *
     * We also need to restore the state of any conditional reveals on the page
     * (for example if the user has navigated back), and set up event handlers to
     * keep the reveal in sync with the checkbox state.
     *
     * @param {Element | null} $root - HTML element to use for checkboxes
     */
    constructor($root) {
      super($root);
      this.$inputs = void 0;
      const $inputs = this.$root.querySelectorAll('input[type="checkbox"]');
      if (!$inputs.length) {
        throw new ElementError({
          component: Checkboxes,
          identifier: 'Form inputs (`<input type="checkbox">`)'
        });
      }
      this.$inputs = $inputs;
      this.$inputs.forEach($input => {
        const targetId = $input.getAttribute('data-aria-controls');
        if (!targetId) {
          return;
        }
        if (!document.getElementById(targetId)) {
          throw new ElementError({
            component: Checkboxes,
            identifier: `Conditional reveal (\`id="${targetId}"\`)`
          });
        }
        $input.setAttribute('aria-controls', targetId);
        $input.removeAttribute('data-aria-controls');
      });
      window.addEventListener('pageshow', () => this.syncAllConditionalReveals());
      this.syncAllConditionalReveals();
      this.$root.addEventListener('click', event => this.handleClick(event));
    }
    syncAllConditionalReveals() {
      this.$inputs.forEach($input => this.syncConditionalRevealWithInputState($input));
    }
    syncConditionalRevealWithInputState($input) {
      const targetId = $input.getAttribute('aria-controls');
      if (!targetId) {
        return;
      }
      const $target = document.getElementById(targetId);
      if ($target != null && $target.classList.contains('govuk-checkboxes__conditional')) {
        const inputIsChecked = $input.checked;
        $input.setAttribute('aria-expanded', inputIsChecked.toString());
        $target.classList.toggle('govuk-checkboxes__conditional--hidden', !inputIsChecked);
      }
    }
    unCheckAllInputsExcept($input) {
      const allInputsWithSameName = document.querySelectorAll(`input[type="checkbox"][name="${$input.name}"]`);
      allInputsWithSameName.forEach($inputWithSameName => {
        const hasSameFormOwner = $input.form === $inputWithSameName.form;
        if (hasSameFormOwner && $inputWithSameName !== $input) {
          $inputWithSameName.checked = false;
          this.syncConditionalRevealWithInputState($inputWithSameName);
        }
      });
    }
    unCheckExclusiveInputs($input) {
      const allInputsWithSameNameAndExclusiveBehaviour = document.querySelectorAll(`input[data-behaviour="exclusive"][type="checkbox"][name="${$input.name}"]`);
      allInputsWithSameNameAndExclusiveBehaviour.forEach($exclusiveInput => {
        const hasSameFormOwner = $input.form === $exclusiveInput.form;
        if (hasSameFormOwner) {
          $exclusiveInput.checked = false;
          this.syncConditionalRevealWithInputState($exclusiveInput);
        }
      });
    }
    handleClick(event) {
      const $clickedInput = event.target;
      if (!($clickedInput instanceof HTMLInputElement) || $clickedInput.type !== 'checkbox') {
        return;
      }
      const hasAriaControls = $clickedInput.getAttribute('aria-controls');
      if (hasAriaControls) {
        this.syncConditionalRevealWithInputState($clickedInput);
      }
      if (!$clickedInput.checked) {
        return;
      }
      const hasBehaviourExclusive = $clickedInput.getAttribute('data-behaviour') === 'exclusive';
      if (hasBehaviourExclusive) {
        this.unCheckAllInputsExcept($clickedInput);
      } else {
        this.unCheckExclusiveInputs($clickedInput);
      }
    }
  }
  Checkboxes.moduleName = 'govuk-checkboxes';

  /**
   * Error summary component
   *
   * Takes focus on initialisation for accessible announcement, unless disabled in
   * configuration.
   *
   * @preserve
   * @augments ConfigurableComponent<ErrorSummaryConfig>
   */
  class ErrorSummary extends ConfigurableComponent {
    /**
     * @param {Element | null} $root - HTML element to use for error summary
     * @param {ErrorSummaryConfig} [config] - Error summary config
     */
    constructor($root, config = {}) {
      super($root, config);
      if (!this.config.disableAutoFocus) {
        setFocus(this.$root);
      }
      this.$root.addEventListener('click', event => this.handleClick(event));
    }
    handleClick(event) {
      const $target = event.target;
      if ($target && this.focusTarget($target)) {
        event.preventDefault();
      }
    }
    focusTarget($target) {
      if (!($target instanceof HTMLAnchorElement)) {
        return false;
      }
      const inputId = getFragmentFromUrl($target.href);
      if (!inputId) {
        return false;
      }
      const $input = document.getElementById(inputId);
      if (!$input) {
        return false;
      }
      const $legendOrLabel = this.getAssociatedLegendOrLabel($input);
      if (!$legendOrLabel) {
        return false;
      }
      $legendOrLabel.scrollIntoView();
      $input.focus({
        preventScroll: true
      });
      return true;
    }
    getAssociatedLegendOrLabel($input) {
      var _document$querySelect;
      const $fieldset = $input.closest('fieldset');
      if ($fieldset) {
        const $legends = $fieldset.getElementsByTagName('legend');
        if ($legends.length) {
          const $candidateLegend = $legends[0];
          if ($input instanceof HTMLInputElement && ($input.type === 'checkbox' || $input.type === 'radio')) {
            return $candidateLegend;
          }
          const legendTop = $candidateLegend.getBoundingClientRect().top;
          const inputRect = $input.getBoundingClientRect();
          if (inputRect.height && window.innerHeight) {
            const inputBottom = inputRect.top + inputRect.height;
            if (inputBottom - legendTop < window.innerHeight / 2) {
              return $candidateLegend;
            }
          }
        }
      }
      return (_document$querySelect = document.querySelector(`label[for='${$input.getAttribute('id')}']`)) != null ? _document$querySelect : $input.closest('label');
    }
  }

  /**
   * Error summary config
   *
   * @typedef {object} ErrorSummaryConfig
   * @property {boolean} [disableAutoFocus=false] - If set to `true` the error
   *   summary will not be focussed when the page loads.
   */

  /**
   * @import { Schema } from '../../common/configuration.mjs'
   */
  ErrorSummary.moduleName = 'govuk-error-summary';
  ErrorSummary.defaults = Object.freeze({
    disableAutoFocus: false
  });
  ErrorSummary.schema = Object.freeze({
    properties: {
      disableAutoFocus: {
        type: 'boolean'
      }
    }
  });

  /**
   * Exit this page component
   *
   * @preserve
   * @augments ConfigurableComponent<ExitThisPageConfig>
   */
  class ExitThisPage extends ConfigurableComponent {
    /**
     * @param {Element | null} $root - HTML element that wraps the Exit This Page button
     * @param {ExitThisPageConfig} [config] - Exit This Page config
     */
    constructor($root, config = {}) {
      super($root, config);
      this.i18n = void 0;
      this.$button = void 0;
      this.$skiplinkButton = null;
      this.$updateSpan = null;
      this.$indicatorContainer = null;
      this.$overlay = null;
      this.keypressCounter = 0;
      this.lastKeyWasModified = false;
      this.timeoutTime = 5000;
      this.keypressTimeoutId = null;
      this.timeoutMessageId = null;
      const $button = this.$root.querySelector('.govuk-exit-this-page__button');
      if (!($button instanceof HTMLAnchorElement)) {
        throw new ElementError({
          component: ExitThisPage,
          element: $button,
          expectedType: 'HTMLAnchorElement',
          identifier: 'Button (`.govuk-exit-this-page__button`)'
        });
      }
      this.i18n = new I18n(this.config.i18n);
      this.$button = $button;
      const $skiplinkButton = document.querySelector('.govuk-js-exit-this-page-skiplink');
      if ($skiplinkButton instanceof HTMLAnchorElement) {
        this.$skiplinkButton = $skiplinkButton;
      }
      this.buildIndicator();
      this.initUpdateSpan();
      this.initButtonClickHandler();
      if (!('govukFrontendExitThisPageKeypress' in document.body.dataset)) {
        document.addEventListener('keyup', this.handleKeypress.bind(this), true);
        document.body.dataset.govukFrontendExitThisPageKeypress = 'true';
      }
      window.addEventListener('pageshow', this.resetPage.bind(this));
    }
    initUpdateSpan() {
      this.$updateSpan = document.createElement('span');
      this.$updateSpan.setAttribute('role', 'status');
      this.$updateSpan.className = 'govuk-visually-hidden';
      this.$root.appendChild(this.$updateSpan);
    }
    initButtonClickHandler() {
      this.$button.addEventListener('click', this.handleClick.bind(this));
      if (this.$skiplinkButton) {
        this.$skiplinkButton.addEventListener('click', this.handleClick.bind(this));
      }
    }
    buildIndicator() {
      this.$indicatorContainer = document.createElement('div');
      this.$indicatorContainer.className = 'govuk-exit-this-page__indicator';
      this.$indicatorContainer.setAttribute('aria-hidden', 'true');
      for (let i = 0; i < 3; i++) {
        const $indicator = document.createElement('div');
        $indicator.className = 'govuk-exit-this-page__indicator-light';
        this.$indicatorContainer.appendChild($indicator);
      }
      this.$button.appendChild(this.$indicatorContainer);
    }
    updateIndicator() {
      if (!this.$indicatorContainer) {
        return;
      }
      this.$indicatorContainer.classList.toggle('govuk-exit-this-page__indicator--visible', this.keypressCounter > 0);
      const $indicators = this.$indicatorContainer.querySelectorAll('.govuk-exit-this-page__indicator-light');
      $indicators.forEach(($indicator, index) => {
        $indicator.classList.toggle('govuk-exit-this-page__indicator-light--on', index < this.keypressCounter);
      });
    }
    exitPage() {
      if (!this.$updateSpan) {
        return;
      }
      this.$updateSpan.textContent = '';
      document.body.classList.add('govuk-exit-this-page-hide-content');
      this.$overlay = document.createElement('div');
      this.$overlay.className = 'govuk-exit-this-page-overlay';
      this.$overlay.setAttribute('role', 'alert');
      document.body.appendChild(this.$overlay);
      this.$overlay.textContent = this.i18n.t('activated');
      window.location.href = this.$button.href;
    }
    handleClick(event) {
      event.preventDefault();
      this.exitPage();
    }
    handleKeypress(event) {
      if (!this.$updateSpan) {
        return;
      }
      if (event.key === 'Shift' && !this.lastKeyWasModified) {
        this.keypressCounter += 1;
        this.updateIndicator();
        if (this.timeoutMessageId) {
          window.clearTimeout(this.timeoutMessageId);
          this.timeoutMessageId = null;
        }
        if (this.keypressCounter >= 3) {
          this.keypressCounter = 0;
          if (this.keypressTimeoutId) {
            window.clearTimeout(this.keypressTimeoutId);
            this.keypressTimeoutId = null;
          }
          this.exitPage();
        } else {
          if (this.keypressCounter === 1) {
            this.$updateSpan.textContent = this.i18n.t('pressTwoMoreTimes');
          } else {
            this.$updateSpan.textContent = this.i18n.t('pressOneMoreTime');
          }
        }
        this.setKeypressTimer();
      } else if (this.keypressTimeoutId) {
        this.resetKeypressTimer();
      }
      this.lastKeyWasModified = event.shiftKey;
    }
    setKeypressTimer() {
      if (this.keypressTimeoutId) {
        window.clearTimeout(this.keypressTimeoutId);
      }
      this.keypressTimeoutId = window.setTimeout(this.resetKeypressTimer.bind(this), this.timeoutTime);
    }
    resetKeypressTimer() {
      if (!this.$updateSpan) {
        return;
      }
      if (this.keypressTimeoutId) {
        window.clearTimeout(this.keypressTimeoutId);
        this.keypressTimeoutId = null;
      }
      const $updateSpan = this.$updateSpan;
      this.keypressCounter = 0;
      $updateSpan.textContent = this.i18n.t('timedOut');
      this.timeoutMessageId = window.setTimeout(() => {
        $updateSpan.textContent = '';
      }, this.timeoutTime);
      this.updateIndicator();
    }
    resetPage() {
      document.body.classList.remove('govuk-exit-this-page-hide-content');
      if (this.$overlay) {
        this.$overlay.remove();
        this.$overlay = null;
      }
      if (this.$updateSpan) {
        this.$updateSpan.setAttribute('role', 'status');
        this.$updateSpan.textContent = '';
      }
      this.updateIndicator();
      if (this.keypressTimeoutId) {
        window.clearTimeout(this.keypressTimeoutId);
      }
      if (this.timeoutMessageId) {
        window.clearTimeout(this.timeoutMessageId);
      }
    }
  }

  /**
   * Exit this Page config
   *
   * @see {@link ExitThisPage.defaults}
   * @typedef {object} ExitThisPageConfig
   * @property {ExitThisPageTranslations} [i18n=ExitThisPage.defaults.i18n] - Exit this page translations
   */

  /**
   * Exit this Page translations
   *
   * @see {@link ExitThisPage.defaults.i18n}
   * @typedef {object} ExitThisPageTranslations
   *
   * Messages used by the component programatically inserted text, including
   * overlay text and screen reader announcements.
   * @property {string} [activated] - Screen reader announcement for when EtP
   *   keypress functionality has been successfully activated.
   * @property {string} [timedOut] - Screen reader announcement for when the EtP
   *   keypress functionality has timed out.
   * @property {string} [pressTwoMoreTimes] - Screen reader announcement informing
   *   the user they must press the activation key two more times.
   * @property {string} [pressOneMoreTime] - Screen reader announcement informing
   *   the user they must press the activation key one more time.
   */

  /**
   * @import { Schema } from '../../common/configuration.mjs'
   */
  ExitThisPage.moduleName = 'govuk-exit-this-page';
  ExitThisPage.defaults = Object.freeze({
    i18n: {
      activated: 'Loading.',
      timedOut: 'Exit this page expired.',
      pressTwoMoreTimes: 'Shift, press 2 more times to exit.',
      pressOneMoreTime: 'Shift, press 1 more time to exit.'
    }
  });
  ExitThisPage.schema = Object.freeze({
    properties: {
      i18n: {
        type: 'object'
      }
    }
  });

  /**
   * File upload component
   *
   * @preserve
   * @augments ConfigurableComponent<FileUploadConfig>
   */
  class FileUpload extends ConfigurableComponent {
    /**
     * @param {Element | null} $root - File input element
     * @param {FileUploadConfig} [config] - File Upload config
     */
    constructor($root, config = {}) {
      super($root, config);
      this.$input = void 0;
      this.$button = void 0;
      this.$status = void 0;
      this.i18n = void 0;
      this.id = void 0;
      this.$announcements = void 0;
      this.enteredAnotherElement = void 0;
      const $input = this.$root.querySelector('input');
      if ($input === null) {
        throw new ElementError({
          component: FileUpload,
          identifier: 'File inputs (`<input type="file">`)'
        });
      }
      if ($input.type !== 'file') {
        throw new ElementError(formatErrorMessage(FileUpload, 'File input (`<input type="file">`) attribute (`type`) is not `file`'));
      }
      this.$input = $input;
      this.$input.setAttribute('hidden', 'true');
      if (!this.$input.id) {
        throw new ElementError({
          component: FileUpload,
          identifier: 'File input (`<input type="file">`) attribute (`id`)'
        });
      }
      this.id = this.$input.id;
      this.i18n = new I18n(this.config.i18n, {
        locale: closestAttributeValue(this.$root, 'lang')
      });
      const $label = this.findLabel();
      if (!$label.id) {
        $label.id = `${this.id}-label`;
      }
      this.$input.id = `${this.id}-input`;
      const $button = document.createElement('button');
      $button.classList.add('govuk-file-upload-button');
      $button.type = 'button';
      $button.id = this.id;
      $button.classList.add('govuk-file-upload-button--empty');
      const ariaDescribedBy = this.$input.getAttribute('aria-describedby');
      if (ariaDescribedBy) {
        $button.setAttribute('aria-describedby', ariaDescribedBy);
      }
      const $status = document.createElement('span');
      $status.className = 'govuk-body govuk-file-upload-button__status';
      $status.setAttribute('aria-live', 'polite');
      $status.innerText = this.i18n.t('noFileChosen');
      $button.appendChild($status);
      const commaSpan = document.createElement('span');
      commaSpan.className = 'govuk-visually-hidden';
      commaSpan.innerText = ', ';
      commaSpan.id = `${this.id}-comma`;
      $button.appendChild(commaSpan);
      const containerSpan = document.createElement('span');
      containerSpan.className = 'govuk-file-upload-button__pseudo-button-container';
      const buttonSpan = document.createElement('span');
      buttonSpan.className = 'govuk-button govuk-button--secondary govuk-file-upload-button__pseudo-button';
      buttonSpan.innerText = this.i18n.t('chooseFilesButton');
      containerSpan.appendChild(buttonSpan);
      containerSpan.insertAdjacentText('beforeend', ' ');
      const instructionSpan = document.createElement('span');
      instructionSpan.className = 'govuk-body govuk-file-upload-button__instruction';
      instructionSpan.innerText = this.i18n.t('dropInstruction');
      containerSpan.appendChild(instructionSpan);
      $button.appendChild(containerSpan);
      $button.setAttribute('aria-labelledby', `${$label.id} ${commaSpan.id} ${$button.id}`);
      $button.addEventListener('click', this.onClick.bind(this));
      $button.addEventListener('dragover', event => {
        event.preventDefault();
      });
      this.$root.insertAdjacentElement('afterbegin', $button);
      this.$input.setAttribute('tabindex', '-1');
      this.$input.setAttribute('aria-hidden', 'true');
      this.$button = $button;
      this.$status = $status;
      this.$input.addEventListener('change', this.onChange.bind(this));
      this.updateDisabledState();
      this.observeDisabledState();
      this.$announcements = document.createElement('span');
      this.$announcements.classList.add('govuk-file-upload-announcements');
      this.$announcements.classList.add('govuk-visually-hidden');
      this.$announcements.setAttribute('aria-live', 'assertive');
      this.$root.insertAdjacentElement('afterend', this.$announcements);
      this.$button.addEventListener('drop', this.onDrop.bind(this));
      document.addEventListener('dragenter', this.updateDropzoneVisibility.bind(this));
      document.addEventListener('dragenter', () => {
        this.enteredAnotherElement = true;
      });
      document.addEventListener('dragleave', () => {
        if (!this.enteredAnotherElement && !this.$button.disabled) {
          this.hideDraggingState();
          this.$announcements.innerText = this.i18n.t('leftDropZone');
        }
        this.enteredAnotherElement = false;
      });
    }
    updateDropzoneVisibility(event) {
      if (this.$button.disabled) return;
      if (event.target instanceof Node) {
        if (this.$root.contains(event.target)) {
          if (event.dataTransfer && isContainingFiles(event.dataTransfer)) {
            if (!this.$button.classList.contains('govuk-file-upload-button--dragging')) {
              this.showDraggingState();
              this.$announcements.innerText = this.i18n.t('enteredDropZone');
            }
          }
        } else {
          if (this.$button.classList.contains('govuk-file-upload-button--dragging')) {
            this.hideDraggingState();
            this.$announcements.innerText = this.i18n.t('leftDropZone');
          }
        }
      }
    }
    showDraggingState() {
      this.$button.classList.add('govuk-file-upload-button--dragging');
    }
    hideDraggingState() {
      this.$button.classList.remove('govuk-file-upload-button--dragging');
    }
    onDrop(event) {
      event.preventDefault();
      if (event.dataTransfer && isContainingFiles(event.dataTransfer)) {
        this.$input.files = event.dataTransfer.files;
        this.$input.dispatchEvent(new CustomEvent('change'));
        this.hideDraggingState();
      }
    }
    onChange() {
      const fileCount = this.$input.files.length;
      if (fileCount === 0) {
        this.$status.innerText = this.i18n.t('noFileChosen');
        this.$button.classList.add('govuk-file-upload-button--empty');
      } else {
        if (fileCount === 1) {
          this.$status.innerText = this.$input.files[0].name;
        } else {
          this.$status.innerText = this.i18n.t('multipleFilesChosen', {
            count: fileCount
          });
        }
        this.$button.classList.remove('govuk-file-upload-button--empty');
      }
    }
    findLabel() {
      const $label = document.querySelector(`label[for="${this.$input.id}"]`);
      if (!$label) {
        throw new ElementError({
          component: FileUpload,
          identifier: `Field label (\`<label for=${this.$input.id}>\`)`
        });
      }
      return $label;
    }
    onClick() {
      this.$input.click();
    }
    observeDisabledState() {
      const observer = new MutationObserver(mutationList => {
        for (const mutation of mutationList) {
          if (mutation.type === 'attributes' && mutation.attributeName === 'disabled') {
            this.updateDisabledState();
          }
        }
      });
      observer.observe(this.$input, {
        attributes: true
      });
    }
    updateDisabledState() {
      this.$button.disabled = this.$input.disabled;
      this.$root.classList.toggle('govuk-drop-zone--disabled', this.$button.disabled);
    }
  }
  FileUpload.moduleName = 'govuk-file-upload';
  FileUpload.defaults = Object.freeze({
    i18n: {
      chooseFilesButton: 'Choose file',
      dropInstruction: 'or drop file',
      noFileChosen: 'No file chosen',
      multipleFilesChosen: {
        one: '%{count} file chosen',
        other: '%{count} files chosen'
      },
      enteredDropZone: 'Entered drop zone',
      leftDropZone: 'Left drop zone'
    }
  });
  FileUpload.schema = Object.freeze({
    properties: {
      i18n: {
        type: 'object'
      }
    }
  });
  function isContainingFiles(dataTransfer) {
    const hasNoTypesInfo = dataTransfer.types.length === 0;
    const isDraggingFiles = dataTransfer.types.some(type => type === 'Files');
    return hasNoTypesInfo || isDraggingFiles;
  }

  /**
   * @typedef {HTMLInputElement & {files: FileList}} HTMLFileInputElement
   */

  /**
   * File upload config
   *
   * @see {@link FileUpload.defaults}
   * @typedef {object} FileUploadConfig
   * @property {FileUploadTranslations} [i18n=FileUpload.defaults.i18n] - File upload translations
   */

  /**
   * File upload translations
   *
   * @see {@link FileUpload.defaults.i18n}
   * @typedef {object} FileUploadTranslations
   *
   * Messages used by the component
   * @property {string} [chooseFile] - The text of the button that opens the file picker
   * @property {string} [dropInstruction] - The text informing users they can drop files
   * @property {TranslationPluralForms} [multipleFilesChosen] - The text displayed when multiple files
   *   have been chosen by the user
   * @property {string} [noFileChosen] - The text to displayed when no file has been chosen by the user
   * @property {string} [enteredDropZone] - The text announced by assistive technology
   *   when user drags files and enters the drop zone
   * @property {string} [leftDropZone] - The text announced by assistive technology
   *   when user drags files and leaves the drop zone without dropping
   */

  /**
   * @import { Schema } from '../../common/configuration.mjs'
   * @import { TranslationPluralForms } from '../../i18n.mjs'
   */

  /**
   * Header component
   *
   * @preserve
   */
  class Header extends Component {
    /**
     * Apply a matchMedia for desktop which will trigger a state sync if the
     * browser viewport moves between states.
     *
     * @param {Element | null} $root - HTML element to use for header
     */
    constructor($root) {
      super($root);
      this.$menuButton = void 0;
      this.$menu = void 0;
      this.menuIsOpen = false;
      this.mql = null;
      const $menuButton = this.$root.querySelector('.govuk-js-header-toggle');
      if (!$menuButton) {
        return this;
      }
      this.$root.classList.add('govuk-header--with-js-navigation');
      const menuId = $menuButton.getAttribute('aria-controls');
      if (!menuId) {
        throw new ElementError({
          component: Header,
          identifier: 'Navigation button (`<button class="govuk-js-header-toggle">`) attribute (`aria-controls`)'
        });
      }
      const $menu = document.getElementById(menuId);
      if (!$menu) {
        throw new ElementError({
          component: Header,
          element: $menu,
          identifier: `Navigation (\`<ul id="${menuId}">\`)`
        });
      }
      this.$menu = $menu;
      this.$menuButton = $menuButton;
      this.setupResponsiveChecks();
      this.$menuButton.addEventListener('click', () => this.handleMenuButtonClick());
    }
    setupResponsiveChecks() {
      const breakpoint = getBreakpoint('desktop');
      if (!breakpoint.value) {
        throw new ElementError({
          component: Header,
          identifier: `CSS custom property (\`${breakpoint.property}\`) on pseudo-class \`:root\``
        });
      }
      this.mql = window.matchMedia(`(min-width: ${breakpoint.value})`);
      if ('addEventListener' in this.mql) {
        this.mql.addEventListener('change', () => this.checkMode());
      } else {
        this.mql.addListener(() => this.checkMode());
      }
      this.checkMode();
    }
    checkMode() {
      if (!this.mql || !this.$menu || !this.$menuButton) {
        return;
      }
      if (this.mql.matches) {
        this.$menu.removeAttribute('hidden');
        this.$menuButton.setAttribute('hidden', '');
      } else {
        this.$menuButton.removeAttribute('hidden');
        this.$menuButton.setAttribute('aria-expanded', this.menuIsOpen.toString());
        if (this.menuIsOpen) {
          this.$menu.removeAttribute('hidden');
        } else {
          this.$menu.setAttribute('hidden', '');
        }
      }
    }
    handleMenuButtonClick() {
      this.menuIsOpen = !this.menuIsOpen;
      this.checkMode();
    }
  }
  Header.moduleName = 'govuk-header';

  /**
   * Notification Banner component
   *
   * @preserve
   * @augments ConfigurableComponent<NotificationBannerConfig>
   */
  class NotificationBanner extends ConfigurableComponent {
    /**
     * @param {Element | null} $root - HTML element to use for notification banner
     * @param {NotificationBannerConfig} [config] - Notification banner config
     */
    constructor($root, config = {}) {
      super($root, config);
      if (this.$root.getAttribute('role') === 'alert' && !this.config.disableAutoFocus) {
        setFocus(this.$root);
      }
    }
  }

  /**
   * Notification banner config
   *
   * @typedef {object} NotificationBannerConfig
   * @property {boolean} [disableAutoFocus=false] - If set to `true` the
   *   notification banner will not be focussed when the page loads. This only
   *   applies if the component has a `role` of `alert` – in other cases the
   *   component will not be focused on page load, regardless of this option.
   */

  /**
   * @import { Schema } from '../../common/configuration.mjs'
   */
  NotificationBanner.moduleName = 'govuk-notification-banner';
  NotificationBanner.defaults = Object.freeze({
    disableAutoFocus: false
  });
  NotificationBanner.schema = Object.freeze({
    properties: {
      disableAutoFocus: {
        type: 'boolean'
      }
    }
  });

  /**
   * Password input component
   *
   * @preserve
   * @augments ConfigurableComponent<PasswordInputConfig>
   */
  class PasswordInput extends ConfigurableComponent {
    /**
     * @param {Element | null} $root - HTML element to use for password input
     * @param {PasswordInputConfig} [config] - Password input config
     */
    constructor($root, config = {}) {
      super($root, config);
      this.i18n = void 0;
      this.$input = void 0;
      this.$showHideButton = void 0;
      this.$screenReaderStatusMessage = void 0;
      const $input = this.$root.querySelector('.govuk-js-password-input-input');
      if (!($input instanceof HTMLInputElement)) {
        throw new ElementError({
          component: PasswordInput,
          element: $input,
          expectedType: 'HTMLInputElement',
          identifier: 'Form field (`.govuk-js-password-input-input`)'
        });
      }
      if ($input.type !== 'password') {
        throw new ElementError('Password input: Form field (`.govuk-js-password-input-input`) must be of type `password`.');
      }
      const $showHideButton = this.$root.querySelector('.govuk-js-password-input-toggle');
      if (!($showHideButton instanceof HTMLButtonElement)) {
        throw new ElementError({
          component: PasswordInput,
          element: $showHideButton,
          expectedType: 'HTMLButtonElement',
          identifier: 'Button (`.govuk-js-password-input-toggle`)'
        });
      }
      if ($showHideButton.type !== 'button') {
        throw new ElementError('Password input: Button (`.govuk-js-password-input-toggle`) must be of type `button`.');
      }
      this.$input = $input;
      this.$showHideButton = $showHideButton;
      this.i18n = new I18n(this.config.i18n, {
        locale: closestAttributeValue(this.$root, 'lang')
      });
      this.$showHideButton.removeAttribute('hidden');
      const $screenReaderStatusMessage = document.createElement('div');
      $screenReaderStatusMessage.className = 'govuk-password-input__sr-status govuk-visually-hidden';
      $screenReaderStatusMessage.setAttribute('aria-live', 'polite');
      this.$screenReaderStatusMessage = $screenReaderStatusMessage;
      this.$input.insertAdjacentElement('afterend', $screenReaderStatusMessage);
      this.$showHideButton.addEventListener('click', this.toggle.bind(this));
      if (this.$input.form) {
        this.$input.form.addEventListener('submit', () => this.hide());
      }
      window.addEventListener('pageshow', event => {
        if (event.persisted && this.$input.type !== 'password') {
          this.hide();
        }
      });
      this.hide();
    }
    toggle(event) {
      event.preventDefault();
      if (this.$input.type === 'password') {
        this.show();
        return;
      }
      this.hide();
    }
    show() {
      this.setType('text');
    }
    hide() {
      this.setType('password');
    }
    setType(type) {
      if (type === this.$input.type) {
        return;
      }
      this.$input.setAttribute('type', type);
      const isHidden = type === 'password';
      const prefixButton = isHidden ? 'show' : 'hide';
      const prefixStatus = isHidden ? 'passwordHidden' : 'passwordShown';
      this.$showHideButton.innerText = this.i18n.t(`${prefixButton}Password`);
      this.$showHideButton.setAttribute('aria-label', this.i18n.t(`${prefixButton}PasswordAriaLabel`));
      this.$screenReaderStatusMessage.innerText = this.i18n.t(`${prefixStatus}Announcement`);
    }
  }

  /**
   * Password input config
   *
   * @typedef {object} PasswordInputConfig
   * @property {PasswordInputTranslations} [i18n=PasswordInput.defaults.i18n] - Password input translations
   */

  /**
   * Password input translations
   *
   * @see {@link PasswordInput.defaults.i18n}
   * @typedef {object} PasswordInputTranslations
   *
   * Messages displayed to the user indicating the state of the show/hide toggle.
   * @property {string} [showPassword] - Visible text of the button when the
   *   password is currently hidden. Plain text only.
   * @property {string} [hidePassword] - Visible text of the button when the
   *   password is currently visible. Plain text only.
   * @property {string} [showPasswordAriaLabel] - aria-label of the button when
   *   the password is currently hidden. Plain text only.
   * @property {string} [hidePasswordAriaLabel] - aria-label of the button when
   *   the password is currently visible. Plain text only.
   * @property {string} [passwordShownAnnouncement] - Screen reader
   *   announcement to make when the password has just become visible.
   *   Plain text only.
   * @property {string} [passwordHiddenAnnouncement] - Screen reader
   *   announcement to make when the password has just been hidden.
   *   Plain text only.
   */

  /**
   * @import { Schema } from '../../common/configuration.mjs'
   */
  PasswordInput.moduleName = 'govuk-password-input';
  PasswordInput.defaults = Object.freeze({
    i18n: {
      showPassword: 'Show',
      hidePassword: 'Hide',
      showPasswordAriaLabel: 'Show password',
      hidePasswordAriaLabel: 'Hide password',
      passwordShownAnnouncement: 'Your password is visible',
      passwordHiddenAnnouncement: 'Your password is hidden'
    }
  });
  PasswordInput.schema = Object.freeze({
    properties: {
      i18n: {
        type: 'object'
      }
    }
  });

  /**
   * Radios component
   *
   * @preserve
   */
  class Radios extends Component {
    /**
     * Radios can be associated with a 'conditionally revealed' content block –
     * for example, a radio for 'Phone' could reveal an additional form field for
     * the user to enter their phone number.
     *
     * These associations are made using a `data-aria-controls` attribute, which
     * is promoted to an aria-controls attribute during initialisation.
     *
     * We also need to restore the state of any conditional reveals on the page
     * (for example if the user has navigated back), and set up event handlers to
     * keep the reveal in sync with the radio state.
     *
     * @param {Element | null} $root - HTML element to use for radios
     */
    constructor($root) {
      super($root);
      this.$inputs = void 0;
      const $inputs = this.$root.querySelectorAll('input[type="radio"]');
      if (!$inputs.length) {
        throw new ElementError({
          component: Radios,
          identifier: 'Form inputs (`<input type="radio">`)'
        });
      }
      this.$inputs = $inputs;
      this.$inputs.forEach($input => {
        const targetId = $input.getAttribute('data-aria-controls');
        if (!targetId) {
          return;
        }
        if (!document.getElementById(targetId)) {
          throw new ElementError({
            component: Radios,
            identifier: `Conditional reveal (\`id="${targetId}"\`)`
          });
        }
        $input.setAttribute('aria-controls', targetId);
        $input.removeAttribute('data-aria-controls');
      });
      window.addEventListener('pageshow', () => this.syncAllConditionalReveals());
      this.syncAllConditionalReveals();
      this.$root.addEventListener('click', event => this.handleClick(event));
    }
    syncAllConditionalReveals() {
      this.$inputs.forEach($input => this.syncConditionalRevealWithInputState($input));
    }
    syncConditionalRevealWithInputState($input) {
      const targetId = $input.getAttribute('aria-controls');
      if (!targetId) {
        return;
      }
      const $target = document.getElementById(targetId);
      if ($target != null && $target.classList.contains('govuk-radios__conditional')) {
        const inputIsChecked = $input.checked;
        $input.setAttribute('aria-expanded', inputIsChecked.toString());
        $target.classList.toggle('govuk-radios__conditional--hidden', !inputIsChecked);
      }
    }
    handleClick(event) {
      const $clickedInput = event.target;
      if (!($clickedInput instanceof HTMLInputElement) || $clickedInput.type !== 'radio') {
        return;
      }
      const $allInputs = document.querySelectorAll('input[type="radio"][aria-controls]');
      const $clickedInputForm = $clickedInput.form;
      const $clickedInputName = $clickedInput.name;
      $allInputs.forEach($input => {
        const hasSameFormOwner = $input.form === $clickedInputForm;
        const hasSameName = $input.name === $clickedInputName;
        if (hasSameName && hasSameFormOwner) {
          this.syncConditionalRevealWithInputState($input);
        }
      });
    }
  }
  Radios.moduleName = 'govuk-radios';

  /**
   * Service Navigation component
   *
   * @preserve
   */
  class ServiceNavigation extends Component {
    /**
     * @param {Element | null} $root - HTML element to use for header
     */
    constructor($root) {
      super($root);
      this.$menuButton = void 0;
      this.$menu = void 0;
      this.menuIsOpen = false;
      this.mql = null;
      const $menuButton = this.$root.querySelector('.govuk-js-service-navigation-toggle');
      if (!$menuButton) {
        return this;
      }
      const menuId = $menuButton.getAttribute('aria-controls');
      if (!menuId) {
        throw new ElementError({
          component: ServiceNavigation,
          identifier: 'Navigation button (`<button class="govuk-js-service-navigation-toggle">`) attribute (`aria-controls`)'
        });
      }
      const $menu = document.getElementById(menuId);
      if (!$menu) {
        throw new ElementError({
          component: ServiceNavigation,
          element: $menu,
          identifier: `Navigation (\`<ul id="${menuId}">\`)`
        });
      }
      this.$menu = $menu;
      this.$menuButton = $menuButton;
      this.setupResponsiveChecks();
      this.$menuButton.addEventListener('click', () => this.handleMenuButtonClick());
    }
    setupResponsiveChecks() {
      const breakpoint = getBreakpoint('tablet');
      if (!breakpoint.value) {
        throw new ElementError({
          component: ServiceNavigation,
          identifier: `CSS custom property (\`${breakpoint.property}\`) on pseudo-class \`:root\``
        });
      }
      this.mql = window.matchMedia(`(min-width: ${breakpoint.value})`);
      if ('addEventListener' in this.mql) {
        this.mql.addEventListener('change', () => this.checkMode());
      } else {
        this.mql.addListener(() => this.checkMode());
      }
      this.checkMode();
    }
    checkMode() {
      if (!this.mql || !this.$menu || !this.$menuButton) {
        return;
      }
      if (this.mql.matches) {
        this.$menu.removeAttribute('hidden');
        this.$menuButton.setAttribute('hidden', '');
      } else {
        this.$menuButton.removeAttribute('hidden');
        this.$menuButton.setAttribute('aria-expanded', this.menuIsOpen.toString());
        if (this.menuIsOpen) {
          this.$menu.removeAttribute('hidden');
        } else {
          this.$menu.setAttribute('hidden', '');
        }
      }
    }
    handleMenuButtonClick() {
      this.menuIsOpen = !this.menuIsOpen;
      this.checkMode();
    }
  }
  ServiceNavigation.moduleName = 'govuk-service-navigation';

  /**
   * Skip link component
   *
   * @preserve
   * @augments Component<HTMLAnchorElement>
   */
  class SkipLink extends Component {
    /**
     * @param {Element | null} $root - HTML element to use for skip link
     * @throws {ElementError} when $root is not set or the wrong type
     * @throws {ElementError} when $root.hash does not contain a hash
     * @throws {ElementError} when the linked element is missing or the wrong type
     */
    constructor($root) {
      var _this$$root$getAttrib;
      super($root);
      const hash = this.$root.hash;
      const href = (_this$$root$getAttrib = this.$root.getAttribute('href')) != null ? _this$$root$getAttrib : '';
      let url;
      try {
        url = new window.URL(this.$root.href);
      } catch (error) {
        throw new ElementError(`Skip link: Target link (\`href="${href}"\`) is invalid`);
      }
      if (url.origin !== window.location.origin || url.pathname !== window.location.pathname) {
        return;
      }
      const linkedElementId = getFragmentFromUrl(hash);
      if (!linkedElementId) {
        throw new ElementError(`Skip link: Target link (\`href="${href}"\`) has no hash fragment`);
      }
      const $linkedElement = document.getElementById(linkedElementId);
      if (!$linkedElement) {
        throw new ElementError({
          component: SkipLink,
          element: $linkedElement,
          identifier: `Target content (\`id="${linkedElementId}"\`)`
        });
      }
      this.$root.addEventListener('click', () => setFocus($linkedElement, {
        onBeforeFocus() {
          $linkedElement.classList.add('govuk-skip-link-focused-element');
        },
        onBlur() {
          $linkedElement.classList.remove('govuk-skip-link-focused-element');
        }
      }));
    }
  }
  SkipLink.elementType = HTMLAnchorElement;
  SkipLink.moduleName = 'govuk-skip-link';

  /**
   * Tabs component
   *
   * @preserve
   */
  class Tabs extends Component {
    /**
     * @param {Element | null} $root - HTML element to use for tabs
     */
    constructor($root) {
      super($root);
      this.$tabs = void 0;
      this.$tabList = void 0;
      this.$tabListItems = void 0;
      this.jsHiddenClass = 'govuk-tabs__panel--hidden';
      this.changingHash = false;
      this.boundTabClick = void 0;
      this.boundTabKeydown = void 0;
      this.boundOnHashChange = void 0;
      this.mql = null;
      const $tabs = this.$root.querySelectorAll('a.govuk-tabs__tab');
      if (!$tabs.length) {
        throw new ElementError({
          component: Tabs,
          identifier: 'Links (`<a class="govuk-tabs__tab">`)'
        });
      }
      this.$tabs = $tabs;
      this.boundTabClick = this.onTabClick.bind(this);
      this.boundTabKeydown = this.onTabKeydown.bind(this);
      this.boundOnHashChange = this.onHashChange.bind(this);
      const $tabList = this.$root.querySelector('.govuk-tabs__list');
      const $tabListItems = this.$root.querySelectorAll('li.govuk-tabs__list-item');
      if (!$tabList) {
        throw new ElementError({
          component: Tabs,
          identifier: 'List (`<ul class="govuk-tabs__list">`)'
        });
      }
      if (!$tabListItems.length) {
        throw new ElementError({
          component: Tabs,
          identifier: 'List items (`<li class="govuk-tabs__list-item">`)'
        });
      }
      this.$tabList = $tabList;
      this.$tabListItems = $tabListItems;
      this.setupResponsiveChecks();
    }
    setupResponsiveChecks() {
      const breakpoint = getBreakpoint('tablet');
      if (!breakpoint.value) {
        throw new ElementError({
          component: Tabs,
          identifier: `CSS custom property (\`${breakpoint.property}\`) on pseudo-class \`:root\``
        });
      }
      this.mql = window.matchMedia(`(min-width: ${breakpoint.value})`);
      if ('addEventListener' in this.mql) {
        this.mql.addEventListener('change', () => this.checkMode());
      } else {
        this.mql.addListener(() => this.checkMode());
      }
      this.checkMode();
    }
    checkMode() {
      var _this$mql;
      if ((_this$mql = this.mql) != null && _this$mql.matches) {
        this.setup();
      } else {
        this.teardown();
      }
    }
    setup() {
      var _this$getTab;
      this.$tabList.setAttribute('role', 'tablist');
      this.$tabListItems.forEach($item => {
        $item.setAttribute('role', 'presentation');
      });
      this.$tabs.forEach($tab => {
        this.setAttributes($tab);
        $tab.addEventListener('click', this.boundTabClick, true);
        $tab.addEventListener('keydown', this.boundTabKeydown, true);
        this.hideTab($tab);
      });
      const $activeTab = (_this$getTab = this.getTab(window.location.hash)) != null ? _this$getTab : this.$tabs[0];
      this.showTab($activeTab);
      window.addEventListener('hashchange', this.boundOnHashChange, true);
    }
    teardown() {
      this.$tabList.removeAttribute('role');
      this.$tabListItems.forEach($item => {
        $item.removeAttribute('role');
      });
      this.$tabs.forEach($tab => {
        $tab.removeEventListener('click', this.boundTabClick, true);
        $tab.removeEventListener('keydown', this.boundTabKeydown, true);
        this.unsetAttributes($tab);
      });
      window.removeEventListener('hashchange', this.boundOnHashChange, true);
    }
    onHashChange() {
      const hash = window.location.hash;
      const $tabWithHash = this.getTab(hash);
      if (!$tabWithHash) {
        return;
      }
      if (this.changingHash) {
        this.changingHash = false;
        return;
      }
      const $previousTab = this.getCurrentTab();
      if (!$previousTab) {
        return;
      }
      this.hideTab($previousTab);
      this.showTab($tabWithHash);
      $tabWithHash.focus();
    }
    hideTab($tab) {
      this.unhighlightTab($tab);
      this.hidePanel($tab);
    }
    showTab($tab) {
      this.highlightTab($tab);
      this.showPanel($tab);
    }
    getTab(hash) {
      return this.$root.querySelector(`a.govuk-tabs__tab[href="${hash}"]`);
    }
    setAttributes($tab) {
      const panelId = getFragmentFromUrl($tab.href);
      if (!panelId) {
        return;
      }
      $tab.setAttribute('id', `tab_${panelId}`);
      $tab.setAttribute('role', 'tab');
      $tab.setAttribute('aria-controls', panelId);
      $tab.setAttribute('aria-selected', 'false');
      $tab.setAttribute('tabindex', '-1');
      const $panel = this.getPanel($tab);
      if (!$panel) {
        return;
      }
      $panel.setAttribute('role', 'tabpanel');
      $panel.setAttribute('aria-labelledby', $tab.id);
      $panel.classList.add(this.jsHiddenClass);
    }
    unsetAttributes($tab) {
      $tab.removeAttribute('id');
      $tab.removeAttribute('role');
      $tab.removeAttribute('aria-controls');
      $tab.removeAttribute('aria-selected');
      $tab.removeAttribute('tabindex');
      const $panel = this.getPanel($tab);
      if (!$panel) {
        return;
      }
      $panel.removeAttribute('role');
      $panel.removeAttribute('aria-labelledby');
      $panel.classList.remove(this.jsHiddenClass);
    }
    onTabClick(event) {
      const $currentTab = this.getCurrentTab();
      const $nextTab = event.currentTarget;
      if (!$currentTab || !($nextTab instanceof HTMLAnchorElement)) {
        return;
      }
      event.preventDefault();
      this.hideTab($currentTab);
      this.showTab($nextTab);
      this.createHistoryEntry($nextTab);
    }
    createHistoryEntry($tab) {
      const $panel = this.getPanel($tab);
      if (!$panel) {
        return;
      }
      const panelId = $panel.id;
      $panel.id = '';
      this.changingHash = true;
      window.location.hash = panelId;
      $panel.id = panelId;
    }
    onTabKeydown(event) {
      switch (event.key) {
        case 'ArrowLeft':
        case 'Left':
          this.activatePreviousTab();
          event.preventDefault();
          break;
        case 'ArrowRight':
        case 'Right':
          this.activateNextTab();
          event.preventDefault();
          break;
      }
    }
    activateNextTab() {
      const $currentTab = this.getCurrentTab();
      if (!($currentTab != null && $currentTab.parentElement)) {
        return;
      }
      const $nextTabListItem = $currentTab.parentElement.nextElementSibling;
      if (!$nextTabListItem) {
        return;
      }
      const $nextTab = $nextTabListItem.querySelector('a.govuk-tabs__tab');
      if (!$nextTab) {
        return;
      }
      this.hideTab($currentTab);
      this.showTab($nextTab);
      $nextTab.focus();
      this.createHistoryEntry($nextTab);
    }
    activatePreviousTab() {
      const $currentTab = this.getCurrentTab();
      if (!($currentTab != null && $currentTab.parentElement)) {
        return;
      }
      const $previousTabListItem = $currentTab.parentElement.previousElementSibling;
      if (!$previousTabListItem) {
        return;
      }
      const $previousTab = $previousTabListItem.querySelector('a.govuk-tabs__tab');
      if (!$previousTab) {
        return;
      }
      this.hideTab($currentTab);
      this.showTab($previousTab);
      $previousTab.focus();
      this.createHistoryEntry($previousTab);
    }
    getPanel($tab) {
      const panelId = getFragmentFromUrl($tab.href);
      if (!panelId) {
        return null;
      }
      return this.$root.querySelector(`#${panelId}`);
    }
    showPanel($tab) {
      const $panel = this.getPanel($tab);
      if (!$panel) {
        return;
      }
      $panel.classList.remove(this.jsHiddenClass);
    }
    hidePanel($tab) {
      const $panel = this.getPanel($tab);
      if (!$panel) {
        return;
      }
      $panel.classList.add(this.jsHiddenClass);
    }
    unhighlightTab($tab) {
      if (!$tab.parentElement) {
        return;
      }
      $tab.setAttribute('aria-selected', 'false');
      $tab.parentElement.classList.remove('govuk-tabs__list-item--selected');
      $tab.setAttribute('tabindex', '-1');
    }
    highlightTab($tab) {
      if (!$tab.parentElement) {
        return;
      }
      $tab.setAttribute('aria-selected', 'true');
      $tab.parentElement.classList.add('govuk-tabs__list-item--selected');
      $tab.setAttribute('tabindex', '0');
    }
    getCurrentTab() {
      return this.$root.querySelector('.govuk-tabs__list-item--selected a.govuk-tabs__tab');
    }
  }
  Tabs.moduleName = 'govuk-tabs';

  /**
   * Initialise all components
   *
   * Use the `data-module` attributes to find, instantiate and init all of the
   * components provided as part of GOV.UK Frontend.
   *
   * @param {Config & { scope?: Element, onError?: OnErrorCallback<CompatibleClass> }} [config] - Config for all components (with optional scope)
   */
  function initAll(config) {
    var _config$scope;
    config = typeof config !== 'undefined' ? config : {};
    if (!isSupported()) {
      if (config.onError) {
        config.onError(new SupportError(), {
          config
        });
      } else {
        console.log(new SupportError());
      }
      return;
    }
    const components = [[Accordion, config.accordion], [Button, config.button], [CharacterCount, config.characterCount], [Checkboxes], [ErrorSummary, config.errorSummary], [ExitThisPage, config.exitThisPage], [FileUpload, config.fileUpload], [Header], [NotificationBanner, config.notificationBanner], [PasswordInput, config.passwordInput], [Radios], [ServiceNavigation], [SkipLink], [Tabs]];
    const options = {
      scope: (_config$scope = config.scope) != null ? _config$scope : document,
      onError: config.onError
    };
    components.forEach(([Component, config]) => {
      createAll(Component, config, options);
    });
  }

  /**
   * Create all instances of a specific component on the page
   *
   * Uses the `data-module` attribute to find all elements matching the specified
   * component on the page, creating instances of the component object for each
   * of them.
   *
   * Any component errors will be caught and logged to the console.
   *
   * @template {CompatibleClass} ComponentClass
   * @param {ComponentClass} Component - class of the component to create
   * @param {ComponentConfig<ComponentClass>} [config] - Config supplied to component
   * @param {OnErrorCallback<ComponentClass> | Element | Document | CreateAllOptions<ComponentClass> } [createAllOptions] - options for createAll including scope of the document to search within and callback function if error throw by component on init
   * @returns {Array<InstanceType<ComponentClass>>} - array of instantiated components
   */
  function createAll(Component, config, createAllOptions) {
    let $scope = document;
    let onError;
    if (typeof createAllOptions === 'object') {
      var _createAllOptions$sco;
      createAllOptions = createAllOptions;
      $scope = (_createAllOptions$sco = createAllOptions.scope) != null ? _createAllOptions$sco : $scope;
      onError = createAllOptions.onError;
    }
    if (typeof createAllOptions === 'function') {
      onError = createAllOptions;
    }
    if (createAllOptions instanceof HTMLElement) {
      $scope = createAllOptions;
    }
    const $elements = $scope.querySelectorAll(`[data-module="${Component.moduleName}"]`);
    if (!isSupported()) {
      if (onError) {
        onError(new SupportError(), {
          component: Component,
          config
        });
      } else {
        console.log(new SupportError());
      }
      return [];
    }
    return Array.from($elements).map($element => {
      try {
        return typeof config !== 'undefined' ? new Component($element, config) : new Component($element);
      } catch (error) {
        if (onError) {
          onError(error, {
            element: $element,
            component: Component,
            config
          });
        } else {
          console.log(error);
        }
        return null;
      }
    }).filter(Boolean);
  }
  /**
   * @typedef {{new (...args: any[]): any, moduleName: string}} CompatibleClass
   */
  /**
   * Config for all components via `initAll()`
   *
   * @typedef {object} Config
   * @property {AccordionConfig} [accordion] - Accordion config
   * @property {ButtonConfig} [button] - Button config
   * @property {CharacterCountConfig} [characterCount] - Character Count config
   * @property {ErrorSummaryConfig} [errorSummary] - Error Summary config
   * @property {ExitThisPageConfig} [exitThisPage] - Exit This Page config
   * @property {FileUploadConfig} [fileUpload] - File Upload config
   * @property {NotificationBannerConfig} [notificationBanner] - Notification Banner config
   * @property {PasswordInputConfig} [passwordInput] - Password input config
   */
  /**
   * Config for individual components
   *
   * @import { AccordionConfig } from './components/accordion/accordion.mjs'
   * @import { ButtonConfig } from './components/button/button.mjs'
   * @import { CharacterCountConfig } from './components/character-count/character-count.mjs'
   * @import { ErrorSummaryConfig } from './components/error-summary/error-summary.mjs'
   * @import { ExitThisPageConfig } from './components/exit-this-page/exit-this-page.mjs'
   * @import { NotificationBannerConfig } from './components/notification-banner/notification-banner.mjs'
   * @import { PasswordInputConfig } from './components/password-input/password-input.mjs'
   * @import { FileUploadConfig } from './components/file-upload/file-upload.mjs'
   */
  /**
   * Component config keys, e.g. `accordion` and `characterCount`
   *
   * @typedef {keyof Config} ConfigKey
   */
  /**
   * @template {CompatibleClass} ComponentClass
   * @typedef {ConstructorParameters<ComponentClass>[1]} ComponentConfig
   */
  /**
   * @template {CompatibleClass} ComponentClass
   * @typedef {object} ErrorContext
   * @property {Element} [element] - Element used for component module initialisation
   * @property {ComponentClass} [component] - Class of component
   * @property {ComponentConfig<ComponentClass>} config - Config supplied to component
   */
  /**
   * @template {CompatibleClass} ComponentClass
   * @callback OnErrorCallback
   * @param {unknown} error - Thrown error
   * @param {ErrorContext<ComponentClass>} context - Object containing the element, component class and configuration
   */
  /**
   * @template {CompatibleClass} ComponentClass
   * @typedef {object} CreateAllOptions
   * @property {Element | Document} [scope] - scope of the document to search within
   * @property {OnErrorCallback<ComponentClass>} [onError] - callback function if error throw by component on init
   */

  exports.Accordion = Accordion;
  exports.Button = Button;
  exports.CharacterCount = CharacterCount;
  exports.Checkboxes = Checkboxes;
  exports.Component = Component;
  exports.ConfigurableComponent = ConfigurableComponent;
  exports.ErrorSummary = ErrorSummary;
  exports.ExitThisPage = ExitThisPage;
  exports.FileUpload = FileUpload;
  exports.Header = Header;
  exports.NotificationBanner = NotificationBanner;
  exports.PasswordInput = PasswordInput;
  exports.Radios = Radios;
  exports.ServiceNavigation = ServiceNavigation;
  exports.SkipLink = SkipLink;
  exports.Tabs = Tabs;
  exports.createAll = createAll;
  exports.initAll = initAll;
  exports.isSupported = isSupported;
  exports.version = version;

}));


},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhc3NldHMvanMvbWFpbi5qcyIsIm5vZGVfbW9kdWxlcy9nb3Z1ay1mcm9udGVuZC9kaXN0L2dvdnVrL2FsbC5idW5kbGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiJ3VzZSBzdHJpY3QnXG5cbmNvbnN0IEdPVlVLRnJvbnRlbmQgPSByZXF1aXJlKCdnb3Z1ay1mcm9udGVuZCcpXG5HT1ZVS0Zyb250ZW5kLmluaXRBbGwoKVxuIiwiKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcbiAgdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gZmFjdG9yeShleHBvcnRzKSA6XG4gIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShbJ2V4cG9ydHMnXSwgZmFjdG9yeSkgOlxuICAoZ2xvYmFsID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsVGhpcyA6IGdsb2JhbCB8fCBzZWxmLCBmYWN0b3J5KGdsb2JhbC5HT1ZVS0Zyb250ZW5kID0gZ2xvYmFsLkdPVlVLRnJvbnRlbmQgfHwge30pKTtcbn0pKHRoaXMsIChmdW5jdGlvbiAoZXhwb3J0cykgeyAndXNlIHN0cmljdCc7XG5cbiAgY29uc3QgdmVyc2lvbiA9ICc1LjEwLjInO1xuXG4gIGZ1bmN0aW9uIGdldEZyYWdtZW50RnJvbVVybCh1cmwpIHtcbiAgICBpZiAoIXVybC5pbmNsdWRlcygnIycpKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICByZXR1cm4gdXJsLnNwbGl0KCcjJykucG9wKCk7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0QnJlYWtwb2ludChuYW1lKSB7XG4gICAgY29uc3QgcHJvcGVydHkgPSBgLS1nb3Z1ay1mcm9udGVuZC1icmVha3BvaW50LSR7bmFtZX1gO1xuICAgIGNvbnN0IHZhbHVlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5KTtcbiAgICByZXR1cm4ge1xuICAgICAgcHJvcGVydHksXG4gICAgICB2YWx1ZTogdmFsdWUgfHwgdW5kZWZpbmVkXG4gICAgfTtcbiAgfVxuICBmdW5jdGlvbiBzZXRGb2N1cygkZWxlbWVudCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgdmFyIF9vcHRpb25zJG9uQmVmb3JlRm9jdTtcbiAgICBjb25zdCBpc0ZvY3VzYWJsZSA9ICRlbGVtZW50LmdldEF0dHJpYnV0ZSgndGFiaW5kZXgnKTtcbiAgICBpZiAoIWlzRm9jdXNhYmxlKSB7XG4gICAgICAkZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uRm9jdXMoKSB7XG4gICAgICAkZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgb25CbHVyLCB7XG4gICAgICAgIG9uY2U6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBvbkJsdXIoKSB7XG4gICAgICB2YXIgX29wdGlvbnMkb25CbHVyO1xuICAgICAgKF9vcHRpb25zJG9uQmx1ciA9IG9wdGlvbnMub25CbHVyKSA9PSBudWxsIHx8IF9vcHRpb25zJG9uQmx1ci5jYWxsKCRlbGVtZW50KTtcbiAgICAgIGlmICghaXNGb2N1c2FibGUpIHtcbiAgICAgICAgJGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCd0YWJpbmRleCcpO1xuICAgICAgfVxuICAgIH1cbiAgICAkZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIG9uRm9jdXMsIHtcbiAgICAgIG9uY2U6IHRydWVcbiAgICB9KTtcbiAgICAoX29wdGlvbnMkb25CZWZvcmVGb2N1ID0gb3B0aW9ucy5vbkJlZm9yZUZvY3VzKSA9PSBudWxsIHx8IF9vcHRpb25zJG9uQmVmb3JlRm9jdS5jYWxsKCRlbGVtZW50KTtcbiAgICAkZWxlbWVudC5mb2N1cygpO1xuICB9XG4gIGZ1bmN0aW9uIGlzSW5pdGlhbGlzZWQoJHJvb3QsIG1vZHVsZU5hbWUpIHtcbiAgICByZXR1cm4gJHJvb3QgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiAkcm9vdC5oYXNBdHRyaWJ1dGUoYGRhdGEtJHttb2R1bGVOYW1lfS1pbml0YCk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIEdPVi5VSyBGcm9udGVuZCBpcyBzdXBwb3J0ZWQgb24gdGhpcyBwYWdlXG4gICAqXG4gICAqIFNvbWUgYnJvd3NlcnMgd2lsbCBsb2FkIGFuZCBydW4gb3VyIEphdmFTY3JpcHQgYnV0IEdPVi5VSyBGcm9udGVuZFxuICAgKiB3b24ndCBiZSBzdXBwb3J0ZWQuXG4gICAqXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnQgfCBudWxsfSBbJHNjb3BlXSAtIChpbnRlcm5hbCkgYDxib2R5PmAgSFRNTCBlbGVtZW50IGNoZWNrZWQgZm9yIGJyb3dzZXIgc3VwcG9ydFxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gV2hldGhlciBHT1YuVUsgRnJvbnRlbmQgaXMgc3VwcG9ydGVkIG9uIHRoaXMgcGFnZVxuICAgKi9cbiAgZnVuY3Rpb24gaXNTdXBwb3J0ZWQoJHNjb3BlID0gZG9jdW1lbnQuYm9keSkge1xuICAgIGlmICghJHNjb3BlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiAkc2NvcGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdnb3Z1ay1mcm9udGVuZC1zdXBwb3J0ZWQnKTtcbiAgfVxuICBmdW5jdGlvbiBpc0FycmF5KG9wdGlvbikge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KG9wdGlvbik7XG4gIH1cbiAgZnVuY3Rpb24gaXNPYmplY3Qob3B0aW9uKSB7XG4gICAgcmV0dXJuICEhb3B0aW9uICYmIHR5cGVvZiBvcHRpb24gPT09ICdvYmplY3QnICYmICFpc0FycmF5KG9wdGlvbik7XG4gIH1cbiAgZnVuY3Rpb24gZm9ybWF0RXJyb3JNZXNzYWdlKENvbXBvbmVudCwgbWVzc2FnZSkge1xuICAgIHJldHVybiBgJHtDb21wb25lbnQubW9kdWxlTmFtZX06ICR7bWVzc2FnZX1gO1xuICB9XG4gIC8qKlxuICAgKiBAdHlwZWRlZiBDb21wb25lbnRXaXRoTW9kdWxlTmFtZVxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gbW9kdWxlTmFtZSAtIE5hbWUgb2YgdGhlIGNvbXBvbmVudFxuICAgKi9cbiAgLyoqXG4gICAqIEBpbXBvcnQgeyBPYmplY3ROZXN0ZWQgfSBmcm9tICcuL2NvbmZpZ3VyYXRpb24ubWpzJ1xuICAgKi9cblxuICBjbGFzcyBHT1ZVS0Zyb250ZW5kRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgICAgc3VwZXIoLi4uYXJncyk7XG4gICAgICB0aGlzLm5hbWUgPSAnR09WVUtGcm9udGVuZEVycm9yJztcbiAgICB9XG4gIH1cbiAgY2xhc3MgU3VwcG9ydEVycm9yIGV4dGVuZHMgR09WVUtGcm9udGVuZEVycm9yIHtcbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgR09WLlVLIEZyb250ZW5kIGlzIHN1cHBvcnRlZCBvbiB0aGlzIHBhZ2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnQgfCBudWxsfSBbJHNjb3BlXSAtIEhUTUwgZWxlbWVudCBgPGJvZHk+YCBjaGVja2VkIGZvciBicm93c2VyIHN1cHBvcnRcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcigkc2NvcGUgPSBkb2N1bWVudC5ib2R5KSB7XG4gICAgICBjb25zdCBzdXBwb3J0TWVzc2FnZSA9ICdub01vZHVsZScgaW4gSFRNTFNjcmlwdEVsZW1lbnQucHJvdG90eXBlID8gJ0dPVi5VSyBGcm9udGVuZCBpbml0aWFsaXNlZCB3aXRob3V0IGA8Ym9keSBjbGFzcz1cImdvdnVrLWZyb250ZW5kLXN1cHBvcnRlZFwiPmAgZnJvbSB0ZW1wbGF0ZSBgPHNjcmlwdD5gIHNuaXBwZXQnIDogJ0dPVi5VSyBGcm9udGVuZCBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3Nlcic7XG4gICAgICBzdXBlcigkc2NvcGUgPyBzdXBwb3J0TWVzc2FnZSA6ICdHT1YuVUsgRnJvbnRlbmQgaW5pdGlhbGlzZWQgd2l0aG91dCBgPHNjcmlwdCB0eXBlPVwibW9kdWxlXCI+YCcpO1xuICAgICAgdGhpcy5uYW1lID0gJ1N1cHBvcnRFcnJvcic7XG4gICAgfVxuICB9XG4gIGNsYXNzIENvbmZpZ0Vycm9yIGV4dGVuZHMgR09WVUtGcm9udGVuZEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7XG4gICAgICBzdXBlciguLi5hcmdzKTtcbiAgICAgIHRoaXMubmFtZSA9ICdDb25maWdFcnJvcic7XG4gICAgfVxuICB9XG4gIGNsYXNzIEVsZW1lbnRFcnJvciBleHRlbmRzIEdPVlVLRnJvbnRlbmRFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZU9yT3B0aW9ucykge1xuICAgICAgbGV0IG1lc3NhZ2UgPSB0eXBlb2YgbWVzc2FnZU9yT3B0aW9ucyA9PT0gJ3N0cmluZycgPyBtZXNzYWdlT3JPcHRpb25zIDogJyc7XG4gICAgICBpZiAodHlwZW9mIG1lc3NhZ2VPck9wdGlvbnMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBjb21wb25lbnQsXG4gICAgICAgICAgaWRlbnRpZmllcixcbiAgICAgICAgICBlbGVtZW50LFxuICAgICAgICAgIGV4cGVjdGVkVHlwZVxuICAgICAgICB9ID0gbWVzc2FnZU9yT3B0aW9ucztcbiAgICAgICAgbWVzc2FnZSA9IGlkZW50aWZpZXI7XG4gICAgICAgIG1lc3NhZ2UgKz0gZWxlbWVudCA/IGAgaXMgbm90IG9mIHR5cGUgJHtleHBlY3RlZFR5cGUgIT0gbnVsbCA/IGV4cGVjdGVkVHlwZSA6ICdIVE1MRWxlbWVudCd9YCA6ICcgbm90IGZvdW5kJztcbiAgICAgICAgbWVzc2FnZSA9IGZvcm1hdEVycm9yTWVzc2FnZShjb21wb25lbnQsIG1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICB0aGlzLm5hbWUgPSAnRWxlbWVudEVycm9yJztcbiAgICB9XG4gIH1cbiAgY2xhc3MgSW5pdEVycm9yIGV4dGVuZHMgR09WVUtGcm9udGVuZEVycm9yIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wb25lbnRPck1lc3NhZ2UpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0eXBlb2YgY29tcG9uZW50T3JNZXNzYWdlID09PSAnc3RyaW5nJyA/IGNvbXBvbmVudE9yTWVzc2FnZSA6IGZvcm1hdEVycm9yTWVzc2FnZShjb21wb25lbnRPck1lc3NhZ2UsIGBSb290IGVsZW1lbnQgKFxcYCRyb290XFxgKSBhbHJlYWR5IGluaXRpYWxpc2VkYCk7XG4gICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgIHRoaXMubmFtZSA9ICdJbml0RXJyb3InO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogQGltcG9ydCB7IENvbXBvbmVudFdpdGhNb2R1bGVOYW1lIH0gZnJvbSAnLi4vY29tbW9uL2luZGV4Lm1qcydcbiAgICovXG5cbiAgY2xhc3MgQ29tcG9uZW50IHtcbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSByb290IGVsZW1lbnQgb2YgdGhlIGNvbXBvbmVudFxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqIEByZXR1cm5zIHtSb290RWxlbWVudFR5cGV9IC0gdGhlIHJvb3QgZWxlbWVudCBvZiBjb21wb25lbnRcbiAgICAgKi9cbiAgICBnZXQgJHJvb3QoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fJHJvb3Q7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKCRyb290KSB7XG4gICAgICB0aGlzLl8kcm9vdCA9IHZvaWQgMDtcbiAgICAgIGNvbnN0IGNoaWxkQ29uc3RydWN0b3IgPSB0aGlzLmNvbnN0cnVjdG9yO1xuICAgICAgaWYgKHR5cGVvZiBjaGlsZENvbnN0cnVjdG9yLm1vZHVsZU5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBJbml0RXJyb3IoYFxcYG1vZHVsZU5hbWVcXGAgbm90IGRlZmluZWQgaW4gY29tcG9uZW50YCk7XG4gICAgICB9XG4gICAgICBpZiAoISgkcm9vdCBpbnN0YW5jZW9mIGNoaWxkQ29uc3RydWN0b3IuZWxlbWVudFR5cGUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGVsZW1lbnQ6ICRyb290LFxuICAgICAgICAgIGNvbXBvbmVudDogY2hpbGRDb25zdHJ1Y3RvcixcbiAgICAgICAgICBpZGVudGlmaWVyOiAnUm9vdCBlbGVtZW50IChgJHJvb3RgKScsXG4gICAgICAgICAgZXhwZWN0ZWRUeXBlOiBjaGlsZENvbnN0cnVjdG9yLmVsZW1lbnRUeXBlLm5hbWVcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl8kcm9vdCA9ICRyb290O1xuICAgICAgfVxuICAgICAgY2hpbGRDb25zdHJ1Y3Rvci5jaGVja1N1cHBvcnQoKTtcbiAgICAgIHRoaXMuY2hlY2tJbml0aWFsaXNlZCgpO1xuICAgICAgY29uc3QgbW9kdWxlTmFtZSA9IGNoaWxkQ29uc3RydWN0b3IubW9kdWxlTmFtZTtcbiAgICAgIHRoaXMuJHJvb3Quc2V0QXR0cmlidXRlKGBkYXRhLSR7bW9kdWxlTmFtZX0taW5pdGAsICcnKTtcbiAgICB9XG4gICAgY2hlY2tJbml0aWFsaXNlZCgpIHtcbiAgICAgIGNvbnN0IGNvbnN0cnVjdG9yID0gdGhpcy5jb25zdHJ1Y3RvcjtcbiAgICAgIGNvbnN0IG1vZHVsZU5hbWUgPSBjb25zdHJ1Y3Rvci5tb2R1bGVOYW1lO1xuICAgICAgaWYgKG1vZHVsZU5hbWUgJiYgaXNJbml0aWFsaXNlZCh0aGlzLiRyb290LCBtb2R1bGVOYW1lKSkge1xuICAgICAgICB0aHJvdyBuZXcgSW5pdEVycm9yKGNvbnN0cnVjdG9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc3RhdGljIGNoZWNrU3VwcG9ydCgpIHtcbiAgICAgIGlmICghaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICB0aHJvdyBuZXcgU3VwcG9ydEVycm9yKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIENoaWxkQ2xhc3NcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IG1vZHVsZU5hbWUgLSBUaGUgbW9kdWxlIG5hbWUgdGhhdCdsbCBiZSBsb29rZWQgZm9yIGluIHRoZSBET00gd2hlbiBpbml0aWFsaXNpbmcgdGhlIGNvbXBvbmVudFxuICAgKi9cblxuICAvKipcbiAgICogQHR5cGVkZWYge3R5cGVvZiBDb21wb25lbnQgJiBDaGlsZENsYXNzfSBDaGlsZENsYXNzQ29uc3RydWN0b3JcbiAgICovXG4gIENvbXBvbmVudC5lbGVtZW50VHlwZSA9IEhUTUxFbGVtZW50O1xuXG4gIGNvbnN0IGNvbmZpZ092ZXJyaWRlID0gU3ltYm9sLmZvcignY29uZmlnT3ZlcnJpZGUnKTtcbiAgY2xhc3MgQ29uZmlndXJhYmxlQ29tcG9uZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICBbY29uZmlnT3ZlcnJpZGVdKHBhcmFtKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgcm9vdCBlbGVtZW50IG9mIHRoZSBjb21wb25lbnRcbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKiBAcmV0dXJucyB7Q29uZmlndXJhdGlvblR5cGV9IC0gdGhlIHJvb3QgZWxlbWVudCBvZiBjb21wb25lbnRcbiAgICAgKi9cbiAgICBnZXQgY29uZmlnKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcbiAgICB9XG4gICAgY29uc3RydWN0b3IoJHJvb3QsIGNvbmZpZykge1xuICAgICAgc3VwZXIoJHJvb3QpO1xuICAgICAgdGhpcy5fY29uZmlnID0gdm9pZCAwO1xuICAgICAgY29uc3QgY2hpbGRDb25zdHJ1Y3RvciA9IHRoaXMuY29uc3RydWN0b3I7XG4gICAgICBpZiAoIWlzT2JqZWN0KGNoaWxkQ29uc3RydWN0b3IuZGVmYXVsdHMpKSB7XG4gICAgICAgIHRocm93IG5ldyBDb25maWdFcnJvcihmb3JtYXRFcnJvck1lc3NhZ2UoY2hpbGRDb25zdHJ1Y3RvciwgJ0NvbmZpZyBwYXNzZWQgYXMgcGFyYW1ldGVyIGludG8gY29uc3RydWN0b3IgYnV0IG5vIGRlZmF1bHRzIGRlZmluZWQnKSk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhc2V0Q29uZmlnID0gbm9ybWFsaXNlRGF0YXNldChjaGlsZENvbnN0cnVjdG9yLCB0aGlzLl8kcm9vdC5kYXRhc2V0KTtcbiAgICAgIHRoaXMuX2NvbmZpZyA9IG1lcmdlQ29uZmlncyhjaGlsZENvbnN0cnVjdG9yLmRlZmF1bHRzLCBjb25maWcgIT0gbnVsbCA/IGNvbmZpZyA6IHt9LCB0aGlzW2NvbmZpZ092ZXJyaWRlXShkYXRhc2V0Q29uZmlnKSwgZGF0YXNldENvbmZpZyk7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIG5vcm1hbGlzZVN0cmluZyh2YWx1ZSwgcHJvcGVydHkpIHtcbiAgICBjb25zdCB0cmltbWVkVmFsdWUgPSB2YWx1ZSA/IHZhbHVlLnRyaW0oKSA6ICcnO1xuICAgIGxldCBvdXRwdXQ7XG4gICAgbGV0IG91dHB1dFR5cGUgPSBwcm9wZXJ0eSA9PSBudWxsID8gdm9pZCAwIDogcHJvcGVydHkudHlwZTtcbiAgICBpZiAoIW91dHB1dFR5cGUpIHtcbiAgICAgIGlmIChbJ3RydWUnLCAnZmFsc2UnXS5pbmNsdWRlcyh0cmltbWVkVmFsdWUpKSB7XG4gICAgICAgIG91dHB1dFR5cGUgPSAnYm9vbGVhbic7XG4gICAgICB9XG4gICAgICBpZiAodHJpbW1lZFZhbHVlLmxlbmd0aCA+IDAgJiYgaXNGaW5pdGUoTnVtYmVyKHRyaW1tZWRWYWx1ZSkpKSB7XG4gICAgICAgIG91dHB1dFR5cGUgPSAnbnVtYmVyJztcbiAgICAgIH1cbiAgICB9XG4gICAgc3dpdGNoIChvdXRwdXRUeXBlKSB7XG4gICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgb3V0cHV0ID0gdHJpbW1lZFZhbHVlID09PSAndHJ1ZSc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgb3V0cHV0ID0gTnVtYmVyKHRyaW1tZWRWYWx1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgb3V0cHV0ID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBvdXRwdXQ7XG4gIH1cbiAgZnVuY3Rpb24gbm9ybWFsaXNlRGF0YXNldChDb21wb25lbnQsIGRhdGFzZXQpIHtcbiAgICBpZiAoIWlzT2JqZWN0KENvbXBvbmVudC5zY2hlbWEpKSB7XG4gICAgICB0aHJvdyBuZXcgQ29uZmlnRXJyb3IoZm9ybWF0RXJyb3JNZXNzYWdlKENvbXBvbmVudCwgJ0NvbmZpZyBwYXNzZWQgYXMgcGFyYW1ldGVyIGludG8gY29uc3RydWN0b3IgYnV0IG5vIHNjaGVtYSBkZWZpbmVkJykpO1xuICAgIH1cbiAgICBjb25zdCBvdXQgPSB7fTtcbiAgICBjb25zdCBlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMoQ29tcG9uZW50LnNjaGVtYS5wcm9wZXJ0aWVzKTtcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgIGNvbnN0IFtuYW1lc3BhY2UsIHByb3BlcnR5XSA9IGVudHJ5O1xuICAgICAgY29uc3QgZmllbGQgPSBuYW1lc3BhY2UudG9TdHJpbmcoKTtcbiAgICAgIGlmIChmaWVsZCBpbiBkYXRhc2V0KSB7XG4gICAgICAgIG91dFtmaWVsZF0gPSBub3JtYWxpc2VTdHJpbmcoZGF0YXNldFtmaWVsZF0sIHByb3BlcnR5KTtcbiAgICAgIH1cbiAgICAgIGlmICgocHJvcGVydHkgPT0gbnVsbCA/IHZvaWQgMCA6IHByb3BlcnR5LnR5cGUpID09PSAnb2JqZWN0Jykge1xuICAgICAgICBvdXRbZmllbGRdID0gZXh0cmFjdENvbmZpZ0J5TmFtZXNwYWNlKENvbXBvbmVudC5zY2hlbWEsIGRhdGFzZXQsIG5hbWVzcGFjZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cbiAgZnVuY3Rpb24gbWVyZ2VDb25maWdzKC4uLmNvbmZpZ09iamVjdHMpIHtcbiAgICBjb25zdCBmb3JtYXR0ZWRDb25maWdPYmplY3QgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGNvbmZpZ09iamVjdCBvZiBjb25maWdPYmplY3RzKSB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhjb25maWdPYmplY3QpKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbiA9IGZvcm1hdHRlZENvbmZpZ09iamVjdFtrZXldO1xuICAgICAgICBjb25zdCBvdmVycmlkZSA9IGNvbmZpZ09iamVjdFtrZXldO1xuICAgICAgICBpZiAoaXNPYmplY3Qob3B0aW9uKSAmJiBpc09iamVjdChvdmVycmlkZSkpIHtcbiAgICAgICAgICBmb3JtYXR0ZWRDb25maWdPYmplY3Rba2V5XSA9IG1lcmdlQ29uZmlncyhvcHRpb24sIG92ZXJyaWRlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb3JtYXR0ZWRDb25maWdPYmplY3Rba2V5XSA9IG92ZXJyaWRlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmb3JtYXR0ZWRDb25maWdPYmplY3Q7XG4gIH1cbiAgZnVuY3Rpb24gdmFsaWRhdGVDb25maWcoc2NoZW1hLCBjb25maWcpIHtcbiAgICBjb25zdCB2YWxpZGF0aW9uRXJyb3JzID0gW107XG4gICAgZm9yIChjb25zdCBbbmFtZSwgY29uZGl0aW9uc10gb2YgT2JqZWN0LmVudHJpZXMoc2NoZW1hKSkge1xuICAgICAgY29uc3QgZXJyb3JzID0gW107XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25kaXRpb25zKSkge1xuICAgICAgICBmb3IgKGNvbnN0IHtcbiAgICAgICAgICByZXF1aXJlZCxcbiAgICAgICAgICBlcnJvck1lc3NhZ2VcbiAgICAgICAgfSBvZiBjb25kaXRpb25zKSB7XG4gICAgICAgICAgaWYgKCFyZXF1aXJlZC5ldmVyeShrZXkgPT4gISFjb25maWdba2V5XSkpIHtcbiAgICAgICAgICAgIGVycm9ycy5wdXNoKGVycm9yTWVzc2FnZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChuYW1lID09PSAnYW55T2YnICYmICEoY29uZGl0aW9ucy5sZW5ndGggLSBlcnJvcnMubGVuZ3RoID49IDEpKSB7XG4gICAgICAgICAgdmFsaWRhdGlvbkVycm9ycy5wdXNoKC4uLmVycm9ycyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZhbGlkYXRpb25FcnJvcnM7XG4gIH1cbiAgZnVuY3Rpb24gZXh0cmFjdENvbmZpZ0J5TmFtZXNwYWNlKHNjaGVtYSwgZGF0YXNldCwgbmFtZXNwYWNlKSB7XG4gICAgY29uc3QgcHJvcGVydHkgPSBzY2hlbWEucHJvcGVydGllc1tuYW1lc3BhY2VdO1xuICAgIGlmICgocHJvcGVydHkgPT0gbnVsbCA/IHZvaWQgMCA6IHByb3BlcnR5LnR5cGUpICE9PSAnb2JqZWN0Jykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBuZXdPYmplY3QgPSB7XG4gICAgICBbbmFtZXNwYWNlXToge31cbiAgICB9O1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGFzZXQpKSB7XG4gICAgICBsZXQgY3VycmVudCA9IG5ld09iamVjdDtcbiAgICAgIGNvbnN0IGtleVBhcnRzID0ga2V5LnNwbGl0KCcuJyk7XG4gICAgICBmb3IgKGNvbnN0IFtpbmRleCwgbmFtZV0gb2Yga2V5UGFydHMuZW50cmllcygpKSB7XG4gICAgICAgIGlmIChpc09iamVjdChjdXJyZW50KSkge1xuICAgICAgICAgIGlmIChpbmRleCA8IGtleVBhcnRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgIGlmICghaXNPYmplY3QoY3VycmVudFtuYW1lXSkpIHtcbiAgICAgICAgICAgICAgY3VycmVudFtuYW1lXSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnRbbmFtZV07XG4gICAgICAgICAgfSBlbHNlIGlmIChrZXkgIT09IG5hbWVzcGFjZSkge1xuICAgICAgICAgICAgY3VycmVudFtuYW1lXSA9IG5vcm1hbGlzZVN0cmluZyh2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdPYmplY3RbbmFtZXNwYWNlXTtcbiAgfVxuICAvKipcbiAgICogU2NoZW1hIGZvciBjb21wb25lbnQgY29uZmlnXG4gICAqXG4gICAqIEB0ZW1wbGF0ZSB7UGFydGlhbDxSZWNvcmQ8a2V5b2YgQ29uZmlndXJhdGlvblR5cGUsIHVua25vd24+Pn0gQ29uZmlndXJhdGlvblR5cGVcbiAgICogQHR5cGVkZWYge29iamVjdH0gU2NoZW1hXG4gICAqIEBwcm9wZXJ0eSB7UmVjb3JkPGtleW9mIENvbmZpZ3VyYXRpb25UeXBlLCBTY2hlbWFQcm9wZXJ0eSB8IHVuZGVmaW5lZD59IHByb3BlcnRpZXMgLSBTY2hlbWEgcHJvcGVydGllc1xuICAgKiBAcHJvcGVydHkge1NjaGVtYUNvbmRpdGlvbjxDb25maWd1cmF0aW9uVHlwZT5bXX0gW2FueU9mXSAtIExpc3Qgb2Ygc2NoZW1hIGNvbmRpdGlvbnNcbiAgICovXG4gIC8qKlxuICAgKiBTY2hlbWEgcHJvcGVydHkgZm9yIGNvbXBvbmVudCBjb25maWdcbiAgICpcbiAgICogQHR5cGVkZWYge29iamVjdH0gU2NoZW1hUHJvcGVydHlcbiAgICogQHByb3BlcnR5IHsnc3RyaW5nJyB8ICdib29sZWFuJyB8ICdudW1iZXInIHwgJ29iamVjdCd9IHR5cGUgLSBQcm9wZXJ0eSB0eXBlXG4gICAqL1xuICAvKipcbiAgICogU2NoZW1hIGNvbmRpdGlvbiBmb3IgY29tcG9uZW50IGNvbmZpZ1xuICAgKlxuICAgKiBAdGVtcGxhdGUge1BhcnRpYWw8UmVjb3JkPGtleW9mIENvbmZpZ3VyYXRpb25UeXBlLCB1bmtub3duPj59IENvbmZpZ3VyYXRpb25UeXBlXG4gICAqIEB0eXBlZGVmIHtvYmplY3R9IFNjaGVtYUNvbmRpdGlvblxuICAgKiBAcHJvcGVydHkgeyhrZXlvZiBDb25maWd1cmF0aW9uVHlwZSlbXX0gcmVxdWlyZWQgLSBMaXN0IG9mIHJlcXVpcmVkIGNvbmZpZyBmaWVsZHNcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGVycm9yTWVzc2FnZSAtIEVycm9yIG1lc3NhZ2Ugd2hlbiByZXF1aXJlZCBjb25maWcgZmllbGRzIG5vdCBwcm92aWRlZFxuICAgKi9cbiAgLyoqXG4gICAqIEB0ZW1wbGF0ZSB7UGFydGlhbDxSZWNvcmQ8a2V5b2YgQ29uZmlndXJhdGlvblR5cGUsIHVua25vd24+Pn0gW0NvbmZpZ3VyYXRpb25UeXBlPU9iamVjdE5lc3RlZF1cbiAgICogQHR5cGVkZWYgQ2hpbGRDbGFzc1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gbW9kdWxlTmFtZSAtIFRoZSBtb2R1bGUgbmFtZSB0aGF0J2xsIGJlIGxvb2tlZCBmb3IgaW4gdGhlIERPTSB3aGVuIGluaXRpYWxpc2luZyB0aGUgY29tcG9uZW50XG4gICAqIEBwcm9wZXJ0eSB7U2NoZW1hPENvbmZpZ3VyYXRpb25UeXBlPn0gW3NjaGVtYV0gLSBUaGUgc2NoZW1hIG9mIHRoZSBjb21wb25lbnQgY29uZmlndXJhdGlvblxuICAgKiBAcHJvcGVydHkge0NvbmZpZ3VyYXRpb25UeXBlfSBbZGVmYXVsdHNdIC0gVGhlIGRlZmF1bHQgdmFsdWVzIG9mIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBjb21wb25lbnRcbiAgICovXG4gIC8qKlxuICAgKiBAdGVtcGxhdGUge1BhcnRpYWw8UmVjb3JkPGtleW9mIENvbmZpZ3VyYXRpb25UeXBlLCB1bmtub3duPj59IFtDb25maWd1cmF0aW9uVHlwZT1PYmplY3ROZXN0ZWRdXG4gICAqIEB0eXBlZGVmIHt0eXBlb2YgQ29tcG9uZW50ICYgQ2hpbGRDbGFzczxDb25maWd1cmF0aW9uVHlwZT59IENoaWxkQ2xhc3NDb25zdHJ1Y3RvcjxDb25maWd1cmF0aW9uVHlwZT5cbiAgICovXG5cbiAgY2xhc3MgSTE4biB7XG4gICAgY29uc3RydWN0b3IodHJhbnNsYXRpb25zID0ge30sIGNvbmZpZyA9IHt9KSB7XG4gICAgICB2YXIgX2NvbmZpZyRsb2NhbGU7XG4gICAgICB0aGlzLnRyYW5zbGF0aW9ucyA9IHZvaWQgMDtcbiAgICAgIHRoaXMubG9jYWxlID0gdm9pZCAwO1xuICAgICAgdGhpcy50cmFuc2xhdGlvbnMgPSB0cmFuc2xhdGlvbnM7XG4gICAgICB0aGlzLmxvY2FsZSA9IChfY29uZmlnJGxvY2FsZSA9IGNvbmZpZy5sb2NhbGUpICE9IG51bGwgPyBfY29uZmlnJGxvY2FsZSA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nIHx8ICdlbic7XG4gICAgfVxuICAgIHQobG9va3VwS2V5LCBvcHRpb25zKSB7XG4gICAgICBpZiAoIWxvb2t1cEtleSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2kxOG46IGxvb2t1cCBrZXkgbWlzc2luZycpO1xuICAgICAgfVxuICAgICAgbGV0IHRyYW5zbGF0aW9uID0gdGhpcy50cmFuc2xhdGlvbnNbbG9va3VwS2V5XTtcbiAgICAgIGlmICh0eXBlb2YgKG9wdGlvbnMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdGlvbnMuY291bnQpID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgdHJhbnNsYXRpb24gPT09ICdvYmplY3QnKSB7XG4gICAgICAgIGNvbnN0IHRyYW5zbGF0aW9uUGx1cmFsRm9ybSA9IHRyYW5zbGF0aW9uW3RoaXMuZ2V0UGx1cmFsU3VmZml4KGxvb2t1cEtleSwgb3B0aW9ucy5jb3VudCldO1xuICAgICAgICBpZiAodHJhbnNsYXRpb25QbHVyYWxGb3JtKSB7XG4gICAgICAgICAgdHJhbnNsYXRpb24gPSB0cmFuc2xhdGlvblBsdXJhbEZvcm07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgdHJhbnNsYXRpb24gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGlmICh0cmFuc2xhdGlvbi5tYXRjaCgvJXsoLlxcUyspfS8pKSB7XG4gICAgICAgICAgaWYgKCFvcHRpb25zKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2kxOG46IGNhbm5vdCByZXBsYWNlIHBsYWNlaG9sZGVycyBpbiBzdHJpbmcgaWYgbm8gb3B0aW9uIGRhdGEgcHJvdmlkZWQnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRoaXMucmVwbGFjZVBsYWNlaG9sZGVycyh0cmFuc2xhdGlvbiwgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRyYW5zbGF0aW9uO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGxvb2t1cEtleTtcbiAgICB9XG4gICAgcmVwbGFjZVBsYWNlaG9sZGVycyh0cmFuc2xhdGlvblN0cmluZywgb3B0aW9ucykge1xuICAgICAgY29uc3QgZm9ybWF0dGVyID0gSW50bC5OdW1iZXJGb3JtYXQuc3VwcG9ydGVkTG9jYWxlc09mKHRoaXMubG9jYWxlKS5sZW5ndGggPyBuZXcgSW50bC5OdW1iZXJGb3JtYXQodGhpcy5sb2NhbGUpIDogdW5kZWZpbmVkO1xuICAgICAgcmV0dXJuIHRyYW5zbGF0aW9uU3RyaW5nLnJlcGxhY2UoLyV7KC5cXFMrKX0vZywgZnVuY3Rpb24gKHBsYWNlaG9sZGVyV2l0aEJyYWNlcywgcGxhY2Vob2xkZXJLZXkpIHtcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvcHRpb25zLCBwbGFjZWhvbGRlcktleSkpIHtcbiAgICAgICAgICBjb25zdCBwbGFjZWhvbGRlclZhbHVlID0gb3B0aW9uc1twbGFjZWhvbGRlcktleV07XG4gICAgICAgICAgaWYgKHBsYWNlaG9sZGVyVmFsdWUgPT09IGZhbHNlIHx8IHR5cGVvZiBwbGFjZWhvbGRlclZhbHVlICE9PSAnbnVtYmVyJyAmJiB0eXBlb2YgcGxhY2Vob2xkZXJWYWx1ZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHR5cGVvZiBwbGFjZWhvbGRlclZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlciA/IGZvcm1hdHRlci5mb3JtYXQocGxhY2Vob2xkZXJWYWx1ZSkgOiBgJHtwbGFjZWhvbGRlclZhbHVlfWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBwbGFjZWhvbGRlclZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgaTE4bjogbm8gZGF0YSBmb3VuZCB0byByZXBsYWNlICR7cGxhY2Vob2xkZXJXaXRoQnJhY2VzfSBwbGFjZWhvbGRlciBpbiBzdHJpbmdgKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBoYXNJbnRsUGx1cmFsUnVsZXNTdXBwb3J0KCkge1xuICAgICAgcmV0dXJuIEJvb2xlYW4oJ1BsdXJhbFJ1bGVzJyBpbiB3aW5kb3cuSW50bCAmJiBJbnRsLlBsdXJhbFJ1bGVzLnN1cHBvcnRlZExvY2FsZXNPZih0aGlzLmxvY2FsZSkubGVuZ3RoKTtcbiAgICB9XG4gICAgZ2V0UGx1cmFsU3VmZml4KGxvb2t1cEtleSwgY291bnQpIHtcbiAgICAgIGNvdW50ID0gTnVtYmVyKGNvdW50KTtcbiAgICAgIGlmICghaXNGaW5pdGUoY291bnQpKSB7XG4gICAgICAgIHJldHVybiAnb3RoZXInO1xuICAgICAgfVxuICAgICAgY29uc3QgdHJhbnNsYXRpb24gPSB0aGlzLnRyYW5zbGF0aW9uc1tsb29rdXBLZXldO1xuICAgICAgY29uc3QgcHJlZmVycmVkRm9ybSA9IHRoaXMuaGFzSW50bFBsdXJhbFJ1bGVzU3VwcG9ydCgpID8gbmV3IEludGwuUGx1cmFsUnVsZXModGhpcy5sb2NhbGUpLnNlbGVjdChjb3VudCkgOiB0aGlzLnNlbGVjdFBsdXJhbEZvcm1Vc2luZ0ZhbGxiYWNrUnVsZXMoY291bnQpO1xuICAgICAgaWYgKHR5cGVvZiB0cmFuc2xhdGlvbiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgaWYgKHByZWZlcnJlZEZvcm0gaW4gdHJhbnNsYXRpb24pIHtcbiAgICAgICAgICByZXR1cm4gcHJlZmVycmVkRm9ybTtcbiAgICAgICAgfSBlbHNlIGlmICgnb3RoZXInIGluIHRyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGBpMThuOiBNaXNzaW5nIHBsdXJhbCBmb3JtIFwiLiR7cHJlZmVycmVkRm9ybX1cIiBmb3IgXCIke3RoaXMubG9jYWxlfVwiIGxvY2FsZS4gRmFsbGluZyBiYWNrIHRvIFwiLm90aGVyXCIuYCk7XG4gICAgICAgICAgcmV0dXJuICdvdGhlcic7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgaTE4bjogUGx1cmFsIGZvcm0gXCIub3RoZXJcIiBpcyByZXF1aXJlZCBmb3IgXCIke3RoaXMubG9jYWxlfVwiIGxvY2FsZWApO1xuICAgIH1cbiAgICBzZWxlY3RQbHVyYWxGb3JtVXNpbmdGYWxsYmFja1J1bGVzKGNvdW50KSB7XG4gICAgICBjb3VudCA9IE1hdGguYWJzKE1hdGguZmxvb3IoY291bnQpKTtcbiAgICAgIGNvbnN0IHJ1bGVzZXQgPSB0aGlzLmdldFBsdXJhbFJ1bGVzRm9yTG9jYWxlKCk7XG4gICAgICBpZiAocnVsZXNldCkge1xuICAgICAgICByZXR1cm4gSTE4bi5wbHVyYWxSdWxlc1tydWxlc2V0XShjb3VudCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ290aGVyJztcbiAgICB9XG4gICAgZ2V0UGx1cmFsUnVsZXNGb3JMb2NhbGUoKSB7XG4gICAgICBjb25zdCBsb2NhbGVTaG9ydCA9IHRoaXMubG9jYWxlLnNwbGl0KCctJylbMF07XG4gICAgICBmb3IgKGNvbnN0IHBsdXJhbFJ1bGUgaW4gSTE4bi5wbHVyYWxSdWxlc01hcCkge1xuICAgICAgICBjb25zdCBsYW5ndWFnZXMgPSBJMThuLnBsdXJhbFJ1bGVzTWFwW3BsdXJhbFJ1bGVdO1xuICAgICAgICBpZiAobGFuZ3VhZ2VzLmluY2x1ZGVzKHRoaXMubG9jYWxlKSB8fCBsYW5ndWFnZXMuaW5jbHVkZXMobG9jYWxlU2hvcnQpKSB7XG4gICAgICAgICAgcmV0dXJuIHBsdXJhbFJ1bGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgSTE4bi5wbHVyYWxSdWxlc01hcCA9IHtcbiAgICBhcmFiaWM6IFsnYXInXSxcbiAgICBjaGluZXNlOiBbJ215JywgJ3poJywgJ2lkJywgJ2phJywgJ2p2JywgJ2tvJywgJ21zJywgJ3RoJywgJ3ZpJ10sXG4gICAgZnJlbmNoOiBbJ2h5JywgJ2JuJywgJ2ZyJywgJ2d1JywgJ2hpJywgJ2ZhJywgJ3BhJywgJ3p1J10sXG4gICAgZ2VybWFuOiBbJ2FmJywgJ3NxJywgJ2F6JywgJ2V1JywgJ2JnJywgJ2NhJywgJ2RhJywgJ25sJywgJ2VuJywgJ2V0JywgJ2ZpJywgJ2thJywgJ2RlJywgJ2VsJywgJ2h1JywgJ2xiJywgJ25vJywgJ3NvJywgJ3N3JywgJ3N2JywgJ3RhJywgJ3RlJywgJ3RyJywgJ3VyJ10sXG4gICAgaXJpc2g6IFsnZ2EnXSxcbiAgICBydXNzaWFuOiBbJ3J1JywgJ3VrJ10sXG4gICAgc2NvdHRpc2g6IFsnZ2QnXSxcbiAgICBzcGFuaXNoOiBbJ3B0LVBUJywgJ2l0JywgJ2VzJ10sXG4gICAgd2Vsc2g6IFsnY3knXVxuICB9O1xuICBJMThuLnBsdXJhbFJ1bGVzID0ge1xuICAgIGFyYWJpYyhuKSB7XG4gICAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICByZXR1cm4gJ3plcm8nO1xuICAgICAgfVxuICAgICAgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuICdvbmUnO1xuICAgICAgfVxuICAgICAgaWYgKG4gPT09IDIpIHtcbiAgICAgICAgcmV0dXJuICd0d28nO1xuICAgICAgfVxuICAgICAgaWYgKG4gJSAxMDAgPj0gMyAmJiBuICUgMTAwIDw9IDEwKSB7XG4gICAgICAgIHJldHVybiAnZmV3JztcbiAgICAgIH1cbiAgICAgIGlmIChuICUgMTAwID49IDExICYmIG4gJSAxMDAgPD0gOTkpIHtcbiAgICAgICAgcmV0dXJuICdtYW55JztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnb3RoZXInO1xuICAgIH0sXG4gICAgY2hpbmVzZSgpIHtcbiAgICAgIHJldHVybiAnb3RoZXInO1xuICAgIH0sXG4gICAgZnJlbmNoKG4pIHtcbiAgICAgIHJldHVybiBuID09PSAwIHx8IG4gPT09IDEgPyAnb25lJyA6ICdvdGhlcic7XG4gICAgfSxcbiAgICBnZXJtYW4obikge1xuICAgICAgcmV0dXJuIG4gPT09IDEgPyAnb25lJyA6ICdvdGhlcic7XG4gICAgfSxcbiAgICBpcmlzaChuKSB7XG4gICAgICBpZiAobiA9PT0gMSkge1xuICAgICAgICByZXR1cm4gJ29uZSc7XG4gICAgICB9XG4gICAgICBpZiAobiA9PT0gMikge1xuICAgICAgICByZXR1cm4gJ3R3byc7XG4gICAgICB9XG4gICAgICBpZiAobiA+PSAzICYmIG4gPD0gNikge1xuICAgICAgICByZXR1cm4gJ2Zldyc7XG4gICAgICB9XG4gICAgICBpZiAobiA+PSA3ICYmIG4gPD0gMTApIHtcbiAgICAgICAgcmV0dXJuICdtYW55JztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnb3RoZXInO1xuICAgIH0sXG4gICAgcnVzc2lhbihuKSB7XG4gICAgICBjb25zdCBsYXN0VHdvID0gbiAlIDEwMDtcbiAgICAgIGNvbnN0IGxhc3QgPSBsYXN0VHdvICUgMTA7XG4gICAgICBpZiAobGFzdCA9PT0gMSAmJiBsYXN0VHdvICE9PSAxMSkge1xuICAgICAgICByZXR1cm4gJ29uZSc7XG4gICAgICB9XG4gICAgICBpZiAobGFzdCA+PSAyICYmIGxhc3QgPD0gNCAmJiAhKGxhc3RUd28gPj0gMTIgJiYgbGFzdFR3byA8PSAxNCkpIHtcbiAgICAgICAgcmV0dXJuICdmZXcnO1xuICAgICAgfVxuICAgICAgaWYgKGxhc3QgPT09IDAgfHwgbGFzdCA+PSA1ICYmIGxhc3QgPD0gOSB8fCBsYXN0VHdvID49IDExICYmIGxhc3RUd28gPD0gMTQpIHtcbiAgICAgICAgcmV0dXJuICdtYW55JztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnb3RoZXInO1xuICAgIH0sXG4gICAgc2NvdHRpc2gobikge1xuICAgICAgaWYgKG4gPT09IDEgfHwgbiA9PT0gMTEpIHtcbiAgICAgICAgcmV0dXJuICdvbmUnO1xuICAgICAgfVxuICAgICAgaWYgKG4gPT09IDIgfHwgbiA9PT0gMTIpIHtcbiAgICAgICAgcmV0dXJuICd0d28nO1xuICAgICAgfVxuICAgICAgaWYgKG4gPj0gMyAmJiBuIDw9IDEwIHx8IG4gPj0gMTMgJiYgbiA8PSAxOSkge1xuICAgICAgICByZXR1cm4gJ2Zldyc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ290aGVyJztcbiAgICB9LFxuICAgIHNwYW5pc2gobikge1xuICAgICAgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuICdvbmUnO1xuICAgICAgfVxuICAgICAgaWYgKG4gJSAxMDAwMDAwID09PSAwICYmIG4gIT09IDApIHtcbiAgICAgICAgcmV0dXJuICdtYW55JztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnb3RoZXInO1xuICAgIH0sXG4gICAgd2Vsc2gobikge1xuICAgICAgaWYgKG4gPT09IDApIHtcbiAgICAgICAgcmV0dXJuICd6ZXJvJztcbiAgICAgIH1cbiAgICAgIGlmIChuID09PSAxKSB7XG4gICAgICAgIHJldHVybiAnb25lJztcbiAgICAgIH1cbiAgICAgIGlmIChuID09PSAyKSB7XG4gICAgICAgIHJldHVybiAndHdvJztcbiAgICAgIH1cbiAgICAgIGlmIChuID09PSAzKSB7XG4gICAgICAgIHJldHVybiAnZmV3JztcbiAgICAgIH1cbiAgICAgIGlmIChuID09PSA2KSB7XG4gICAgICAgIHJldHVybiAnbWFueSc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ290aGVyJztcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEFjY29yZGlvbiBjb21wb25lbnRcbiAgICpcbiAgICogVGhpcyBhbGxvd3MgYSBjb2xsZWN0aW9uIG9mIHNlY3Rpb25zIHRvIGJlIGNvbGxhcHNlZCBieSBkZWZhdWx0LCBzaG93aW5nIG9ubHlcbiAgICogdGhlaXIgaGVhZGVycy4gU2VjdGlvbnMgY2FuIGJlIGV4cGFuZGVkIG9yIGNvbGxhcHNlZCBpbmRpdmlkdWFsbHkgYnkgY2xpY2tpbmdcbiAgICogdGhlaXIgaGVhZGVycy4gQSBcIlNob3cgYWxsIHNlY3Rpb25zXCIgYnV0dG9uIGlzIGFsc28gYWRkZWQgdG8gdGhlIHRvcCBvZiB0aGVcbiAgICogYWNjb3JkaW9uLCB3aGljaCBzd2l0Y2hlcyB0byBcIkhpZGUgYWxsIHNlY3Rpb25zXCIgd2hlbiBhbGwgdGhlIHNlY3Rpb25zIGFyZVxuICAgKiBleHBhbmRlZC5cbiAgICpcbiAgICogVGhlIHN0YXRlIG9mIGVhY2ggc2VjdGlvbiBpcyBzYXZlZCB0byB0aGUgRE9NIHZpYSB0aGUgYGFyaWEtZXhwYW5kZWRgXG4gICAqIGF0dHJpYnV0ZSwgd2hpY2ggYWxzbyBwcm92aWRlcyBhY2Nlc3NpYmlsaXR5LlxuICAgKlxuICAgKiBAcHJlc2VydmVcbiAgICogQGF1Z21lbnRzIENvbmZpZ3VyYWJsZUNvbXBvbmVudDxBY2NvcmRpb25Db25maWc+XG4gICAqL1xuICBjbGFzcyBBY2NvcmRpb24gZXh0ZW5kcyBDb25maWd1cmFibGVDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudCB8IG51bGx9ICRyb290IC0gSFRNTCBlbGVtZW50IHRvIHVzZSBmb3IgYWNjb3JkaW9uXG4gICAgICogQHBhcmFtIHtBY2NvcmRpb25Db25maWd9IFtjb25maWddIC0gQWNjb3JkaW9uIGNvbmZpZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCRyb290LCBjb25maWcgPSB7fSkge1xuICAgICAgc3VwZXIoJHJvb3QsIGNvbmZpZyk7XG4gICAgICB0aGlzLmkxOG4gPSB2b2lkIDA7XG4gICAgICB0aGlzLmNvbnRyb2xzQ2xhc3MgPSAnZ292dWstYWNjb3JkaW9uX19jb250cm9scyc7XG4gICAgICB0aGlzLnNob3dBbGxDbGFzcyA9ICdnb3Z1ay1hY2NvcmRpb25fX3Nob3ctYWxsJztcbiAgICAgIHRoaXMuc2hvd0FsbFRleHRDbGFzcyA9ICdnb3Z1ay1hY2NvcmRpb25fX3Nob3ctYWxsLXRleHQnO1xuICAgICAgdGhpcy5zZWN0aW9uQ2xhc3MgPSAnZ292dWstYWNjb3JkaW9uX19zZWN0aW9uJztcbiAgICAgIHRoaXMuc2VjdGlvbkV4cGFuZGVkQ2xhc3MgPSAnZ292dWstYWNjb3JkaW9uX19zZWN0aW9uLS1leHBhbmRlZCc7XG4gICAgICB0aGlzLnNlY3Rpb25CdXR0b25DbGFzcyA9ICdnb3Z1ay1hY2NvcmRpb25fX3NlY3Rpb24tYnV0dG9uJztcbiAgICAgIHRoaXMuc2VjdGlvbkhlYWRlckNsYXNzID0gJ2dvdnVrLWFjY29yZGlvbl9fc2VjdGlvbi1oZWFkZXInO1xuICAgICAgdGhpcy5zZWN0aW9uSGVhZGluZ0NsYXNzID0gJ2dvdnVrLWFjY29yZGlvbl9fc2VjdGlvbi1oZWFkaW5nJztcbiAgICAgIHRoaXMuc2VjdGlvbkhlYWRpbmdEaXZpZGVyQ2xhc3MgPSAnZ292dWstYWNjb3JkaW9uX19zZWN0aW9uLWhlYWRpbmctZGl2aWRlcic7XG4gICAgICB0aGlzLnNlY3Rpb25IZWFkaW5nVGV4dENsYXNzID0gJ2dvdnVrLWFjY29yZGlvbl9fc2VjdGlvbi1oZWFkaW5nLXRleHQnO1xuICAgICAgdGhpcy5zZWN0aW9uSGVhZGluZ1RleHRGb2N1c0NsYXNzID0gJ2dvdnVrLWFjY29yZGlvbl9fc2VjdGlvbi1oZWFkaW5nLXRleHQtZm9jdXMnO1xuICAgICAgdGhpcy5zZWN0aW9uU2hvd0hpZGVUb2dnbGVDbGFzcyA9ICdnb3Z1ay1hY2NvcmRpb25fX3NlY3Rpb24tdG9nZ2xlJztcbiAgICAgIHRoaXMuc2VjdGlvblNob3dIaWRlVG9nZ2xlRm9jdXNDbGFzcyA9ICdnb3Z1ay1hY2NvcmRpb25fX3NlY3Rpb24tdG9nZ2xlLWZvY3VzJztcbiAgICAgIHRoaXMuc2VjdGlvblNob3dIaWRlVGV4dENsYXNzID0gJ2dvdnVrLWFjY29yZGlvbl9fc2VjdGlvbi10b2dnbGUtdGV4dCc7XG4gICAgICB0aGlzLnVwQ2hldnJvbkljb25DbGFzcyA9ICdnb3Z1ay1hY2NvcmRpb24tbmF2X19jaGV2cm9uJztcbiAgICAgIHRoaXMuZG93bkNoZXZyb25JY29uQ2xhc3MgPSAnZ292dWstYWNjb3JkaW9uLW5hdl9fY2hldnJvbi0tZG93bic7XG4gICAgICB0aGlzLnNlY3Rpb25TdW1tYXJ5Q2xhc3MgPSAnZ292dWstYWNjb3JkaW9uX19zZWN0aW9uLXN1bW1hcnknO1xuICAgICAgdGhpcy5zZWN0aW9uU3VtbWFyeUZvY3VzQ2xhc3MgPSAnZ292dWstYWNjb3JkaW9uX19zZWN0aW9uLXN1bW1hcnktZm9jdXMnO1xuICAgICAgdGhpcy5zZWN0aW9uQ29udGVudENsYXNzID0gJ2dvdnVrLWFjY29yZGlvbl9fc2VjdGlvbi1jb250ZW50JztcbiAgICAgIHRoaXMuJHNlY3Rpb25zID0gdm9pZCAwO1xuICAgICAgdGhpcy4kc2hvd0FsbEJ1dHRvbiA9IG51bGw7XG4gICAgICB0aGlzLiRzaG93QWxsSWNvbiA9IG51bGw7XG4gICAgICB0aGlzLiRzaG93QWxsVGV4dCA9IG51bGw7XG4gICAgICB0aGlzLmkxOG4gPSBuZXcgSTE4bih0aGlzLmNvbmZpZy5pMThuKTtcbiAgICAgIGNvbnN0ICRzZWN0aW9ucyA9IHRoaXMuJHJvb3QucXVlcnlTZWxlY3RvckFsbChgLiR7dGhpcy5zZWN0aW9uQ2xhc3N9YCk7XG4gICAgICBpZiAoISRzZWN0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVsZW1lbnRFcnJvcih7XG4gICAgICAgICAgY29tcG9uZW50OiBBY2NvcmRpb24sXG4gICAgICAgICAgaWRlbnRpZmllcjogYFNlY3Rpb25zIChcXGA8ZGl2IGNsYXNzPVwiJHt0aGlzLnNlY3Rpb25DbGFzc31cIj5cXGApYFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuJHNlY3Rpb25zID0gJHNlY3Rpb25zO1xuICAgICAgdGhpcy5pbml0Q29udHJvbHMoKTtcbiAgICAgIHRoaXMuaW5pdFNlY3Rpb25IZWFkZXJzKCk7XG4gICAgICB0aGlzLnVwZGF0ZVNob3dBbGxCdXR0b24odGhpcy5hcmVBbGxTZWN0aW9uc09wZW4oKSk7XG4gICAgfVxuICAgIGluaXRDb250cm9scygpIHtcbiAgICAgIHRoaXMuJHNob3dBbGxCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgIHRoaXMuJHNob3dBbGxCdXR0b24uc2V0QXR0cmlidXRlKCd0eXBlJywgJ2J1dHRvbicpO1xuICAgICAgdGhpcy4kc2hvd0FsbEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgdGhpcy5zaG93QWxsQ2xhc3MpO1xuICAgICAgdGhpcy4kc2hvd0FsbEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKTtcbiAgICAgIHRoaXMuJHNob3dBbGxJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgdGhpcy4kc2hvd0FsbEljb24uY2xhc3NMaXN0LmFkZCh0aGlzLnVwQ2hldnJvbkljb25DbGFzcyk7XG4gICAgICB0aGlzLiRzaG93QWxsQnV0dG9uLmFwcGVuZENoaWxkKHRoaXMuJHNob3dBbGxJY29uKTtcbiAgICAgIGNvbnN0ICRhY2NvcmRpb25Db250cm9scyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgJGFjY29yZGlvbkNvbnRyb2xzLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCB0aGlzLmNvbnRyb2xzQ2xhc3MpO1xuICAgICAgJGFjY29yZGlvbkNvbnRyb2xzLmFwcGVuZENoaWxkKHRoaXMuJHNob3dBbGxCdXR0b24pO1xuICAgICAgdGhpcy4kcm9vdC5pbnNlcnRCZWZvcmUoJGFjY29yZGlvbkNvbnRyb2xzLCB0aGlzLiRyb290LmZpcnN0Q2hpbGQpO1xuICAgICAgdGhpcy4kc2hvd0FsbFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICB0aGlzLiRzaG93QWxsVGV4dC5jbGFzc0xpc3QuYWRkKHRoaXMuc2hvd0FsbFRleHRDbGFzcyk7XG4gICAgICB0aGlzLiRzaG93QWxsQnV0dG9uLmFwcGVuZENoaWxkKHRoaXMuJHNob3dBbGxUZXh0KTtcbiAgICAgIHRoaXMuJHNob3dBbGxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLm9uU2hvd09ySGlkZUFsbFRvZ2dsZSgpKTtcbiAgICAgIGlmICgnb25iZWZvcmVtYXRjaCcgaW4gZG9jdW1lbnQpIHtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JlbWF0Y2gnLCBldmVudCA9PiB0aGlzLm9uQmVmb3JlTWF0Y2goZXZlbnQpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaW5pdFNlY3Rpb25IZWFkZXJzKCkge1xuICAgICAgdGhpcy4kc2VjdGlvbnMuZm9yRWFjaCgoJHNlY3Rpb24sIGkpID0+IHtcbiAgICAgICAgY29uc3QgJGhlYWRlciA9ICRzZWN0aW9uLnF1ZXJ5U2VsZWN0b3IoYC4ke3RoaXMuc2VjdGlvbkhlYWRlckNsYXNzfWApO1xuICAgICAgICBpZiAoISRoZWFkZXIpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICAgIGNvbXBvbmVudDogQWNjb3JkaW9uLFxuICAgICAgICAgICAgaWRlbnRpZmllcjogYFNlY3Rpb24gaGVhZGVycyAoXFxgPGRpdiBjbGFzcz1cIiR7dGhpcy5zZWN0aW9uSGVhZGVyQ2xhc3N9XCI+XFxgKWBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvbnN0cnVjdEhlYWRlck1hcmt1cCgkaGVhZGVyLCBpKTtcbiAgICAgICAgdGhpcy5zZXRFeHBhbmRlZCh0aGlzLmlzRXhwYW5kZWQoJHNlY3Rpb24pLCAkc2VjdGlvbik7XG4gICAgICAgICRoZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLm9uU2VjdGlvblRvZ2dsZSgkc2VjdGlvbikpO1xuICAgICAgICB0aGlzLnNldEluaXRpYWxTdGF0ZSgkc2VjdGlvbik7XG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3RydWN0SGVhZGVyTWFya3VwKCRoZWFkZXIsIGluZGV4KSB7XG4gICAgICBjb25zdCAkc3BhbiA9ICRoZWFkZXIucXVlcnlTZWxlY3RvcihgLiR7dGhpcy5zZWN0aW9uQnV0dG9uQ2xhc3N9YCk7XG4gICAgICBjb25zdCAkaGVhZGluZyA9ICRoZWFkZXIucXVlcnlTZWxlY3RvcihgLiR7dGhpcy5zZWN0aW9uSGVhZGluZ0NsYXNzfWApO1xuICAgICAgY29uc3QgJHN1bW1hcnkgPSAkaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoYC4ke3RoaXMuc2VjdGlvblN1bW1hcnlDbGFzc31gKTtcbiAgICAgIGlmICghJGhlYWRpbmcpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVsZW1lbnRFcnJvcih7XG4gICAgICAgICAgY29tcG9uZW50OiBBY2NvcmRpb24sXG4gICAgICAgICAgaWRlbnRpZmllcjogYFNlY3Rpb24gaGVhZGluZyAoXFxgLiR7dGhpcy5zZWN0aW9uSGVhZGluZ0NsYXNzfVxcYClgXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKCEkc3Bhbikge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICBjb21wb25lbnQ6IEFjY29yZGlvbixcbiAgICAgICAgICBpZGVudGlmaWVyOiBgU2VjdGlvbiBidXR0b24gcGxhY2Vob2xkZXIgKFxcYDxzcGFuIGNsYXNzPVwiJHt0aGlzLnNlY3Rpb25CdXR0b25DbGFzc31cIj5cXGApYFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0ICRidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgICRidXR0b24uc2V0QXR0cmlidXRlKCd0eXBlJywgJ2J1dHRvbicpO1xuICAgICAgJGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBgJHt0aGlzLiRyb290LmlkfS1jb250ZW50LSR7aW5kZXggKyAxfWApO1xuICAgICAgZm9yIChjb25zdCBhdHRyIG9mIEFycmF5LmZyb20oJHNwYW4uYXR0cmlidXRlcykpIHtcbiAgICAgICAgaWYgKGF0dHIubmFtZSAhPT0gJ2lkJykge1xuICAgICAgICAgICRidXR0b24uc2V0QXR0cmlidXRlKGF0dHIubmFtZSwgYXR0ci52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0ICRoZWFkaW5nVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICRoZWFkaW5nVGV4dC5jbGFzc0xpc3QuYWRkKHRoaXMuc2VjdGlvbkhlYWRpbmdUZXh0Q2xhc3MpO1xuICAgICAgJGhlYWRpbmdUZXh0LmlkID0gJHNwYW4uaWQ7XG4gICAgICBjb25zdCAkaGVhZGluZ1RleHRGb2N1cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICRoZWFkaW5nVGV4dEZvY3VzLmNsYXNzTGlzdC5hZGQodGhpcy5zZWN0aW9uSGVhZGluZ1RleHRGb2N1c0NsYXNzKTtcbiAgICAgICRoZWFkaW5nVGV4dC5hcHBlbmRDaGlsZCgkaGVhZGluZ1RleHRGb2N1cyk7XG4gICAgICBBcnJheS5mcm9tKCRzcGFuLmNoaWxkTm9kZXMpLmZvckVhY2goJGNoaWxkID0+ICRoZWFkaW5nVGV4dEZvY3VzLmFwcGVuZENoaWxkKCRjaGlsZCkpO1xuICAgICAgY29uc3QgJHNob3dIaWRlVG9nZ2xlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgJHNob3dIaWRlVG9nZ2xlLmNsYXNzTGlzdC5hZGQodGhpcy5zZWN0aW9uU2hvd0hpZGVUb2dnbGVDbGFzcyk7XG4gICAgICAkc2hvd0hpZGVUb2dnbGUuc2V0QXR0cmlidXRlKCdkYXRhLW5vc25pcHBldCcsICcnKTtcbiAgICAgIGNvbnN0ICRzaG93SGlkZVRvZ2dsZUZvY3VzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgJHNob3dIaWRlVG9nZ2xlRm9jdXMuY2xhc3NMaXN0LmFkZCh0aGlzLnNlY3Rpb25TaG93SGlkZVRvZ2dsZUZvY3VzQ2xhc3MpO1xuICAgICAgJHNob3dIaWRlVG9nZ2xlLmFwcGVuZENoaWxkKCRzaG93SGlkZVRvZ2dsZUZvY3VzKTtcbiAgICAgIGNvbnN0ICRzaG93SGlkZVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICBjb25zdCAkc2hvd0hpZGVJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgJHNob3dIaWRlSWNvbi5jbGFzc0xpc3QuYWRkKHRoaXMudXBDaGV2cm9uSWNvbkNsYXNzKTtcbiAgICAgICRzaG93SGlkZVRvZ2dsZUZvY3VzLmFwcGVuZENoaWxkKCRzaG93SGlkZUljb24pO1xuICAgICAgJHNob3dIaWRlVGV4dC5jbGFzc0xpc3QuYWRkKHRoaXMuc2VjdGlvblNob3dIaWRlVGV4dENsYXNzKTtcbiAgICAgICRzaG93SGlkZVRvZ2dsZUZvY3VzLmFwcGVuZENoaWxkKCRzaG93SGlkZVRleHQpO1xuICAgICAgJGJ1dHRvbi5hcHBlbmRDaGlsZCgkaGVhZGluZ1RleHQpO1xuICAgICAgJGJ1dHRvbi5hcHBlbmRDaGlsZCh0aGlzLmdldEJ1dHRvblB1bmN0dWF0aW9uRWwoKSk7XG4gICAgICBpZiAoJHN1bW1hcnkpIHtcbiAgICAgICAgY29uc3QgJHN1bW1hcnlTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICBjb25zdCAkc3VtbWFyeVNwYW5Gb2N1cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgJHN1bW1hcnlTcGFuRm9jdXMuY2xhc3NMaXN0LmFkZCh0aGlzLnNlY3Rpb25TdW1tYXJ5Rm9jdXNDbGFzcyk7XG4gICAgICAgICRzdW1tYXJ5U3Bhbi5hcHBlbmRDaGlsZCgkc3VtbWFyeVNwYW5Gb2N1cyk7XG4gICAgICAgIGZvciAoY29uc3QgYXR0ciBvZiBBcnJheS5mcm9tKCRzdW1tYXJ5LmF0dHJpYnV0ZXMpKSB7XG4gICAgICAgICAgJHN1bW1hcnlTcGFuLnNldEF0dHJpYnV0ZShhdHRyLm5hbWUsIGF0dHIudmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIEFycmF5LmZyb20oJHN1bW1hcnkuY2hpbGROb2RlcykuZm9yRWFjaCgkY2hpbGQgPT4gJHN1bW1hcnlTcGFuRm9jdXMuYXBwZW5kQ2hpbGQoJGNoaWxkKSk7XG4gICAgICAgICRzdW1tYXJ5LnJlbW92ZSgpO1xuICAgICAgICAkYnV0dG9uLmFwcGVuZENoaWxkKCRzdW1tYXJ5U3Bhbik7XG4gICAgICAgICRidXR0b24uYXBwZW5kQ2hpbGQodGhpcy5nZXRCdXR0b25QdW5jdHVhdGlvbkVsKCkpO1xuICAgICAgfVxuICAgICAgJGJ1dHRvbi5hcHBlbmRDaGlsZCgkc2hvd0hpZGVUb2dnbGUpO1xuICAgICAgJGhlYWRpbmcucmVtb3ZlQ2hpbGQoJHNwYW4pO1xuICAgICAgJGhlYWRpbmcuYXBwZW5kQ2hpbGQoJGJ1dHRvbik7XG4gICAgfVxuICAgIG9uQmVmb3JlTWF0Y2goZXZlbnQpIHtcbiAgICAgIGNvbnN0ICRmcmFnbWVudCA9IGV2ZW50LnRhcmdldDtcbiAgICAgIGlmICghKCRmcmFnbWVudCBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0ICRzZWN0aW9uID0gJGZyYWdtZW50LmNsb3Nlc3QoYC4ke3RoaXMuc2VjdGlvbkNsYXNzfWApO1xuICAgICAgaWYgKCRzZWN0aW9uKSB7XG4gICAgICAgIHRoaXMuc2V0RXhwYW5kZWQodHJ1ZSwgJHNlY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgICBvblNlY3Rpb25Ub2dnbGUoJHNlY3Rpb24pIHtcbiAgICAgIGNvbnN0IG5vd0V4cGFuZGVkID0gIXRoaXMuaXNFeHBhbmRlZCgkc2VjdGlvbik7XG4gICAgICB0aGlzLnNldEV4cGFuZGVkKG5vd0V4cGFuZGVkLCAkc2VjdGlvbik7XG4gICAgICB0aGlzLnN0b3JlU3RhdGUoJHNlY3Rpb24sIG5vd0V4cGFuZGVkKTtcbiAgICB9XG4gICAgb25TaG93T3JIaWRlQWxsVG9nZ2xlKCkge1xuICAgICAgY29uc3Qgbm93RXhwYW5kZWQgPSAhdGhpcy5hcmVBbGxTZWN0aW9uc09wZW4oKTtcbiAgICAgIHRoaXMuJHNlY3Rpb25zLmZvckVhY2goJHNlY3Rpb24gPT4ge1xuICAgICAgICB0aGlzLnNldEV4cGFuZGVkKG5vd0V4cGFuZGVkLCAkc2VjdGlvbik7XG4gICAgICAgIHRoaXMuc3RvcmVTdGF0ZSgkc2VjdGlvbiwgbm93RXhwYW5kZWQpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnVwZGF0ZVNob3dBbGxCdXR0b24obm93RXhwYW5kZWQpO1xuICAgIH1cbiAgICBzZXRFeHBhbmRlZChleHBhbmRlZCwgJHNlY3Rpb24pIHtcbiAgICAgIGNvbnN0ICRzaG93SGlkZUljb24gPSAkc2VjdGlvbi5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLnVwQ2hldnJvbkljb25DbGFzc31gKTtcbiAgICAgIGNvbnN0ICRzaG93SGlkZVRleHQgPSAkc2VjdGlvbi5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLnNlY3Rpb25TaG93SGlkZVRleHRDbGFzc31gKTtcbiAgICAgIGNvbnN0ICRidXR0b24gPSAkc2VjdGlvbi5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLnNlY3Rpb25CdXR0b25DbGFzc31gKTtcbiAgICAgIGNvbnN0ICRjb250ZW50ID0gJHNlY3Rpb24ucXVlcnlTZWxlY3RvcihgLiR7dGhpcy5zZWN0aW9uQ29udGVudENsYXNzfWApO1xuICAgICAgaWYgKCEkY29udGVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICBjb21wb25lbnQ6IEFjY29yZGlvbixcbiAgICAgICAgICBpZGVudGlmaWVyOiBgU2VjdGlvbiBjb250ZW50IChcXGA8ZGl2IGNsYXNzPVwiJHt0aGlzLnNlY3Rpb25Db250ZW50Q2xhc3N9XCI+XFxgKWBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoISRzaG93SGlkZUljb24gfHwgISRzaG93SGlkZVRleHQgfHwgISRidXR0b24pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgbmV3QnV0dG9uVGV4dCA9IGV4cGFuZGVkID8gdGhpcy5pMThuLnQoJ2hpZGVTZWN0aW9uJykgOiB0aGlzLmkxOG4udCgnc2hvd1NlY3Rpb24nKTtcbiAgICAgICRzaG93SGlkZVRleHQudGV4dENvbnRlbnQgPSBuZXdCdXR0b25UZXh0O1xuICAgICAgJGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBgJHtleHBhbmRlZH1gKTtcbiAgICAgIGNvbnN0IGFyaWFMYWJlbFBhcnRzID0gW107XG4gICAgICBjb25zdCAkaGVhZGluZ1RleHQgPSAkc2VjdGlvbi5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLnNlY3Rpb25IZWFkaW5nVGV4dENsYXNzfWApO1xuICAgICAgaWYgKCRoZWFkaW5nVGV4dCkge1xuICAgICAgICBhcmlhTGFiZWxQYXJ0cy5wdXNoKGAkeyRoZWFkaW5nVGV4dC50ZXh0Q29udGVudH1gLnRyaW0oKSk7XG4gICAgICB9XG4gICAgICBjb25zdCAkc3VtbWFyeSA9ICRzZWN0aW9uLnF1ZXJ5U2VsZWN0b3IoYC4ke3RoaXMuc2VjdGlvblN1bW1hcnlDbGFzc31gKTtcbiAgICAgIGlmICgkc3VtbWFyeSkge1xuICAgICAgICBhcmlhTGFiZWxQYXJ0cy5wdXNoKGAkeyRzdW1tYXJ5LnRleHRDb250ZW50fWAudHJpbSgpKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGFyaWFMYWJlbE1lc3NhZ2UgPSBleHBhbmRlZCA/IHRoaXMuaTE4bi50KCdoaWRlU2VjdGlvbkFyaWFMYWJlbCcpIDogdGhpcy5pMThuLnQoJ3Nob3dTZWN0aW9uQXJpYUxhYmVsJyk7XG4gICAgICBhcmlhTGFiZWxQYXJ0cy5wdXNoKGFyaWFMYWJlbE1lc3NhZ2UpO1xuICAgICAgJGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBhcmlhTGFiZWxQYXJ0cy5qb2luKCcgLCAnKSk7XG4gICAgICBpZiAoZXhwYW5kZWQpIHtcbiAgICAgICAgJGNvbnRlbnQucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgJHNlY3Rpb24uY2xhc3NMaXN0LmFkZCh0aGlzLnNlY3Rpb25FeHBhbmRlZENsYXNzKTtcbiAgICAgICAgJHNob3dIaWRlSWNvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuZG93bkNoZXZyb25JY29uQ2xhc3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGNvbnRlbnQuc2V0QXR0cmlidXRlKCdoaWRkZW4nLCAndW50aWwtZm91bmQnKTtcbiAgICAgICAgJHNlY3Rpb24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLnNlY3Rpb25FeHBhbmRlZENsYXNzKTtcbiAgICAgICAgJHNob3dIaWRlSWNvbi5jbGFzc0xpc3QuYWRkKHRoaXMuZG93bkNoZXZyb25JY29uQ2xhc3MpO1xuICAgICAgfVxuICAgICAgdGhpcy51cGRhdGVTaG93QWxsQnV0dG9uKHRoaXMuYXJlQWxsU2VjdGlvbnNPcGVuKCkpO1xuICAgIH1cbiAgICBpc0V4cGFuZGVkKCRzZWN0aW9uKSB7XG4gICAgICByZXR1cm4gJHNlY3Rpb24uY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMuc2VjdGlvbkV4cGFuZGVkQ2xhc3MpO1xuICAgIH1cbiAgICBhcmVBbGxTZWN0aW9uc09wZW4oKSB7XG4gICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLiRzZWN0aW9ucykuZXZlcnkoJHNlY3Rpb24gPT4gdGhpcy5pc0V4cGFuZGVkKCRzZWN0aW9uKSk7XG4gICAgfVxuICAgIHVwZGF0ZVNob3dBbGxCdXR0b24oZXhwYW5kZWQpIHtcbiAgICAgIGlmICghdGhpcy4kc2hvd0FsbEJ1dHRvbiB8fCAhdGhpcy4kc2hvd0FsbFRleHQgfHwgIXRoaXMuJHNob3dBbGxJY29uKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuJHNob3dBbGxCdXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgZXhwYW5kZWQudG9TdHJpbmcoKSk7XG4gICAgICB0aGlzLiRzaG93QWxsVGV4dC50ZXh0Q29udGVudCA9IGV4cGFuZGVkID8gdGhpcy5pMThuLnQoJ2hpZGVBbGxTZWN0aW9ucycpIDogdGhpcy5pMThuLnQoJ3Nob3dBbGxTZWN0aW9ucycpO1xuICAgICAgdGhpcy4kc2hvd0FsbEljb24uY2xhc3NMaXN0LnRvZ2dsZSh0aGlzLmRvd25DaGV2cm9uSWNvbkNsYXNzLCAhZXhwYW5kZWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgaWRlbnRpZmllciBmb3IgYSBzZWN0aW9uXG4gICAgICpcbiAgICAgKiBXZSBuZWVkIGEgdW5pcXVlIHdheSBvZiBpZGVudGlmeWluZyBlYWNoIGNvbnRlbnQgaW4gdGhlIEFjY29yZGlvbi5cbiAgICAgKiBTaW5jZSBhbiBgI2lkYCBzaG91bGQgYmUgdW5pcXVlIGFuZCBhbiBgaWRgIGlzIHJlcXVpcmVkIGZvciBgYXJpYS1gXG4gICAgICogYXR0cmlidXRlcyBgaWRgIGNhbiBiZSBzYWZlbHkgdXNlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gJHNlY3Rpb24gLSBTZWN0aW9uIGVsZW1lbnRcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nIHwgdW5kZWZpbmVkIHwgbnVsbH0gSWRlbnRpZmllciBmb3Igc2VjdGlvblxuICAgICAqL1xuICAgIGdldElkZW50aWZpZXIoJHNlY3Rpb24pIHtcbiAgICAgIGNvbnN0ICRidXR0b24gPSAkc2VjdGlvbi5xdWVyeVNlbGVjdG9yKGAuJHt0aGlzLnNlY3Rpb25CdXR0b25DbGFzc31gKTtcbiAgICAgIHJldHVybiAkYnV0dG9uID09IG51bGwgPyB2b2lkIDAgOiAkYnV0dG9uLmdldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycpO1xuICAgIH1cbiAgICBzdG9yZVN0YXRlKCRzZWN0aW9uLCBpc0V4cGFuZGVkKSB7XG4gICAgICBpZiAoIXRoaXMuY29uZmlnLnJlbWVtYmVyRXhwYW5kZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgaWQgPSB0aGlzLmdldElkZW50aWZpZXIoJHNlY3Rpb24pO1xuICAgICAgaWYgKGlkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0oaWQsIGlzRXhwYW5kZWQudG9TdHJpbmcoKSk7XG4gICAgICAgIH0gY2F0Y2ggKGV4Y2VwdGlvbikge31cbiAgICAgIH1cbiAgICB9XG4gICAgc2V0SW5pdGlhbFN0YXRlKCRzZWN0aW9uKSB7XG4gICAgICBpZiAoIXRoaXMuY29uZmlnLnJlbWVtYmVyRXhwYW5kZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgaWQgPSB0aGlzLmdldElkZW50aWZpZXIoJHNlY3Rpb24pO1xuICAgICAgaWYgKGlkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgc3RhdGUgPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShpZCk7XG4gICAgICAgICAgaWYgKHN0YXRlICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnNldEV4cGFuZGVkKHN0YXRlID09PSAndHJ1ZScsICRzZWN0aW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGV4Y2VwdGlvbikge31cbiAgICAgIH1cbiAgICB9XG4gICAgZ2V0QnV0dG9uUHVuY3R1YXRpb25FbCgpIHtcbiAgICAgIGNvbnN0ICRwdW5jdHVhdGlvbkVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgJHB1bmN0dWF0aW9uRWwuY2xhc3NMaXN0LmFkZCgnZ292dWstdmlzdWFsbHktaGlkZGVuJywgdGhpcy5zZWN0aW9uSGVhZGluZ0RpdmlkZXJDbGFzcyk7XG4gICAgICAkcHVuY3R1YXRpb25FbC50ZXh0Q29udGVudCA9ICcsICc7XG4gICAgICByZXR1cm4gJHB1bmN0dWF0aW9uRWw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFjY29yZGlvbiBjb25maWdcbiAgICpcbiAgICogQHNlZSB7QGxpbmsgQWNjb3JkaW9uLmRlZmF1bHRzfVxuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBBY2NvcmRpb25Db25maWdcbiAgICogQHByb3BlcnR5IHtBY2NvcmRpb25UcmFuc2xhdGlvbnN9IFtpMThuPUFjY29yZGlvbi5kZWZhdWx0cy5pMThuXSAtIEFjY29yZGlvbiB0cmFuc2xhdGlvbnNcbiAgICogQHByb3BlcnR5IHtib29sZWFufSBbcmVtZW1iZXJFeHBhbmRlZF0gLSBXaGV0aGVyIHRoZSBleHBhbmRlZCBhbmQgY29sbGFwc2VkXG4gICAqICAgc3RhdGUgb2YgZWFjaCBzZWN0aW9uIGlzIHJlbWVtYmVyZWQgYW5kIHJlc3RvcmVkIHdoZW4gbmF2aWdhdGluZy5cbiAgICovXG5cbiAgLyoqXG4gICAqIEFjY29yZGlvbiB0cmFuc2xhdGlvbnNcbiAgICpcbiAgICogQHNlZSB7QGxpbmsgQWNjb3JkaW9uLmRlZmF1bHRzLmkxOG59XG4gICAqIEB0eXBlZGVmIHtvYmplY3R9IEFjY29yZGlvblRyYW5zbGF0aW9uc1xuICAgKlxuICAgKiBNZXNzYWdlcyB1c2VkIGJ5IHRoZSBjb21wb25lbnQgZm9yIHRoZSBsYWJlbHMgb2YgaXRzIGJ1dHRvbnMuIFRoaXMgaW5jbHVkZXNcbiAgICogdGhlIHZpc2libGUgdGV4dCBzaG93biBvbiBzY3JlZW4sIGFuZCB0ZXh0IHRvIGhlbHAgYXNzaXN0aXZlIHRlY2hub2xvZ3kgdXNlcnNcbiAgICogZm9yIHRoZSBidXR0b25zIHRvZ2dsaW5nIGVhY2ggc2VjdGlvbi5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtoaWRlQWxsU2VjdGlvbnNdIC0gVGhlIHRleHQgY29udGVudCBmb3IgdGhlICdIaWRlIGFsbFxuICAgKiAgIHNlY3Rpb25zJyBidXR0b24sIHVzZWQgd2hlbiBhdCBsZWFzdCBvbmUgc2VjdGlvbiBpcyBleHBhbmRlZC5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtoaWRlU2VjdGlvbl0gLSBUaGUgdGV4dCBjb250ZW50IGZvciB0aGUgJ0hpZGUnXG4gICAqICAgYnV0dG9uLCB1c2VkIHdoZW4gYSBzZWN0aW9uIGlzIGV4cGFuZGVkLlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW2hpZGVTZWN0aW9uQXJpYUxhYmVsXSAtIFRoZSB0ZXh0IGNvbnRlbnQgYXBwZW5kZWQgdG8gdGhlXG4gICAqICAgJ0hpZGUnIGJ1dHRvbidzIGFjY2Vzc2libGUgbmFtZSB3aGVuIGEgc2VjdGlvbiBpcyBleHBhbmRlZC5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtzaG93QWxsU2VjdGlvbnNdIC0gVGhlIHRleHQgY29udGVudCBmb3IgdGhlICdTaG93IGFsbFxuICAgKiAgIHNlY3Rpb25zJyBidXR0b24sIHVzZWQgd2hlbiBhbGwgc2VjdGlvbnMgYXJlIGNvbGxhcHNlZC5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtzaG93U2VjdGlvbl0gLSBUaGUgdGV4dCBjb250ZW50IGZvciB0aGUgJ1Nob3cnXG4gICAqICAgYnV0dG9uLCB1c2VkIHdoZW4gYSBzZWN0aW9uIGlzIGNvbGxhcHNlZC5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtzaG93U2VjdGlvbkFyaWFMYWJlbF0gLSBUaGUgdGV4dCBjb250ZW50IGFwcGVuZGVkIHRvIHRoZVxuICAgKiAgICdTaG93JyBidXR0b24ncyBhY2Nlc3NpYmxlIG5hbWUgd2hlbiBhIHNlY3Rpb24gaXMgZXhwYW5kZWQuXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAaW1wb3J0IHsgU2NoZW1hIH0gZnJvbSAnLi4vLi4vY29tbW9uL2NvbmZpZ3VyYXRpb24ubWpzJ1xuICAgKi9cbiAgQWNjb3JkaW9uLm1vZHVsZU5hbWUgPSAnZ292dWstYWNjb3JkaW9uJztcbiAgQWNjb3JkaW9uLmRlZmF1bHRzID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgaTE4bjoge1xuICAgICAgaGlkZUFsbFNlY3Rpb25zOiAnSGlkZSBhbGwgc2VjdGlvbnMnLFxuICAgICAgaGlkZVNlY3Rpb246ICdIaWRlJyxcbiAgICAgIGhpZGVTZWN0aW9uQXJpYUxhYmVsOiAnSGlkZSB0aGlzIHNlY3Rpb24nLFxuICAgICAgc2hvd0FsbFNlY3Rpb25zOiAnU2hvdyBhbGwgc2VjdGlvbnMnLFxuICAgICAgc2hvd1NlY3Rpb246ICdTaG93JyxcbiAgICAgIHNob3dTZWN0aW9uQXJpYUxhYmVsOiAnU2hvdyB0aGlzIHNlY3Rpb24nXG4gICAgfSxcbiAgICByZW1lbWJlckV4cGFuZGVkOiB0cnVlXG4gIH0pO1xuICBBY2NvcmRpb24uc2NoZW1hID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgcHJvcGVydGllczoge1xuICAgICAgaTE4bjoge1xuICAgICAgICB0eXBlOiAnb2JqZWN0J1xuICAgICAgfSxcbiAgICAgIHJlbWVtYmVyRXhwYW5kZWQ6IHtcbiAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBERUJPVU5DRV9USU1FT1VUX0lOX1NFQ09ORFMgPSAxO1xuXG4gIC8qKlxuICAgKiBKYXZhU2NyaXB0IGVuaGFuY2VtZW50cyBmb3IgdGhlIEJ1dHRvbiBjb21wb25lbnRcbiAgICpcbiAgICogQHByZXNlcnZlXG4gICAqIEBhdWdtZW50cyBDb25maWd1cmFibGVDb21wb25lbnQ8QnV0dG9uQ29uZmlnPlxuICAgKi9cbiAgY2xhc3MgQnV0dG9uIGV4dGVuZHMgQ29uZmlndXJhYmxlQ29tcG9uZW50IHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnQgfCBudWxsfSAkcm9vdCAtIEhUTUwgZWxlbWVudCB0byB1c2UgZm9yIGJ1dHRvblxuICAgICAqIEBwYXJhbSB7QnV0dG9uQ29uZmlnfSBbY29uZmlnXSAtIEJ1dHRvbiBjb25maWdcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcigkcm9vdCwgY29uZmlnID0ge30pIHtcbiAgICAgIHN1cGVyKCRyb290LCBjb25maWcpO1xuICAgICAgdGhpcy5kZWJvdW5jZUZvcm1TdWJtaXRUaW1lciA9IG51bGw7XG4gICAgICB0aGlzLiRyb290LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBldmVudCA9PiB0aGlzLmhhbmRsZUtleURvd24oZXZlbnQpKTtcbiAgICAgIHRoaXMuJHJvb3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB0aGlzLmRlYm91bmNlKGV2ZW50KSk7XG4gICAgfVxuICAgIGhhbmRsZUtleURvd24oZXZlbnQpIHtcbiAgICAgIGNvbnN0ICR0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICBpZiAoZXZlbnQua2V5ICE9PSAnICcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKCR0YXJnZXQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiAkdGFyZ2V0LmdldEF0dHJpYnV0ZSgncm9sZScpID09PSAnYnV0dG9uJykge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAkdGFyZ2V0LmNsaWNrKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGRlYm91bmNlKGV2ZW50KSB7XG4gICAgICBpZiAoIXRoaXMuY29uZmlnLnByZXZlbnREb3VibGVDbGljaykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5kZWJvdW5jZUZvcm1TdWJtaXRUaW1lcikge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB0aGlzLmRlYm91bmNlRm9ybVN1Ym1pdFRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmRlYm91bmNlRm9ybVN1Ym1pdFRpbWVyID0gbnVsbDtcbiAgICAgIH0sIERFQk9VTkNFX1RJTUVPVVRfSU5fU0VDT05EUyAqIDEwMDApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBCdXR0b24gY29uZmlnXG4gICAqXG4gICAqIEB0eXBlZGVmIHtvYmplY3R9IEJ1dHRvbkNvbmZpZ1xuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtwcmV2ZW50RG91YmxlQ2xpY2s9ZmFsc2VdIC0gUHJldmVudCBhY2NpZGVudGFsIGRvdWJsZVxuICAgKiAgIGNsaWNrcyBvbiBzdWJtaXQgYnV0dG9ucyBmcm9tIHN1Ym1pdHRpbmcgZm9ybXMgbXVsdGlwbGUgdGltZXMuXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAaW1wb3J0IHsgU2NoZW1hIH0gZnJvbSAnLi4vLi4vY29tbW9uL2NvbmZpZ3VyYXRpb24ubWpzJ1xuICAgKi9cbiAgQnV0dG9uLm1vZHVsZU5hbWUgPSAnZ292dWstYnV0dG9uJztcbiAgQnV0dG9uLmRlZmF1bHRzID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgcHJldmVudERvdWJsZUNsaWNrOiBmYWxzZVxuICB9KTtcbiAgQnV0dG9uLnNjaGVtYSA9IE9iamVjdC5mcmVlemUoe1xuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgIHByZXZlbnREb3VibGVDbGljazoge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIGNsb3Nlc3RBdHRyaWJ1dGVWYWx1ZSgkZWxlbWVudCwgYXR0cmlidXRlTmFtZSkge1xuICAgIGNvbnN0ICRjbG9zZXN0RWxlbWVudFdpdGhBdHRyaWJ1dGUgPSAkZWxlbWVudC5jbG9zZXN0KGBbJHthdHRyaWJ1dGVOYW1lfV1gKTtcbiAgICByZXR1cm4gJGNsb3Nlc3RFbGVtZW50V2l0aEF0dHJpYnV0ZSA/ICRjbG9zZXN0RWxlbWVudFdpdGhBdHRyaWJ1dGUuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpIDogbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFyYWN0ZXIgY291bnQgY29tcG9uZW50XG4gICAqXG4gICAqIFRyYWNrcyB0aGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgb3Igd29yZHMgaW4gdGhlIGAuZ292dWstanMtY2hhcmFjdGVyLWNvdW50YFxuICAgKiBgPHRleHRhcmVhPmAgaW5zaWRlIHRoZSBlbGVtZW50LiBEaXNwbGF5cyBhIG1lc3NhZ2Ugd2l0aCB0aGUgcmVtYWluaW5nIG51bWJlclxuICAgKiBvZiBjaGFyYWN0ZXJzL3dvcmRzIGF2YWlsYWJsZSwgb3IgdGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzL3dvcmRzIGluIGV4Y2Vzcy5cbiAgICpcbiAgICogWW91IGNhbiBjb25maWd1cmUgdGhlIG1lc3NhZ2UgdG8gb25seSBhcHBlYXIgYWZ0ZXIgYSBjZXJ0YWluIHBlcmNlbnRhZ2VcbiAgICogb2YgdGhlIGF2YWlsYWJsZSBjaGFyYWN0ZXJzL3dvcmRzIGhhcyBiZWVuIGVudGVyZWQuXG4gICAqXG4gICAqIEBwcmVzZXJ2ZVxuICAgKiBAYXVnbWVudHMgQ29uZmlndXJhYmxlQ29tcG9uZW50PENoYXJhY3RlckNvdW50Q29uZmlnPlxuICAgKi9cbiAgY2xhc3MgQ2hhcmFjdGVyQ291bnQgZXh0ZW5kcyBDb25maWd1cmFibGVDb21wb25lbnQge1xuICAgIFtjb25maWdPdmVycmlkZV0oZGF0YXNldENvbmZpZykge1xuICAgICAgbGV0IGNvbmZpZ092ZXJyaWRlcyA9IHt9O1xuICAgICAgaWYgKCdtYXh3b3JkcycgaW4gZGF0YXNldENvbmZpZyB8fCAnbWF4bGVuZ3RoJyBpbiBkYXRhc2V0Q29uZmlnKSB7XG4gICAgICAgIGNvbmZpZ092ZXJyaWRlcyA9IHtcbiAgICAgICAgICBtYXhsZW5ndGg6IHVuZGVmaW5lZCxcbiAgICAgICAgICBtYXh3b3JkczogdW5kZWZpbmVkXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gY29uZmlnT3ZlcnJpZGVzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudCB8IG51bGx9ICRyb290IC0gSFRNTCBlbGVtZW50IHRvIHVzZSBmb3IgY2hhcmFjdGVyIGNvdW50XG4gICAgICogQHBhcmFtIHtDaGFyYWN0ZXJDb3VudENvbmZpZ30gW2NvbmZpZ10gLSBDaGFyYWN0ZXIgY291bnQgY29uZmlnXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoJHJvb3QsIGNvbmZpZyA9IHt9KSB7XG4gICAgICB2YXIgX3JlZiwgX3RoaXMkY29uZmlnJG1heHdvcmRzO1xuICAgICAgc3VwZXIoJHJvb3QsIGNvbmZpZyk7XG4gICAgICB0aGlzLiR0ZXh0YXJlYSA9IHZvaWQgMDtcbiAgICAgIHRoaXMuJHZpc2libGVDb3VudE1lc3NhZ2UgPSB2b2lkIDA7XG4gICAgICB0aGlzLiRzY3JlZW5SZWFkZXJDb3VudE1lc3NhZ2UgPSB2b2lkIDA7XG4gICAgICB0aGlzLmxhc3RJbnB1dFRpbWVzdGFtcCA9IG51bGw7XG4gICAgICB0aGlzLmxhc3RJbnB1dFZhbHVlID0gJyc7XG4gICAgICB0aGlzLnZhbHVlQ2hlY2tlciA9IG51bGw7XG4gICAgICB0aGlzLmkxOG4gPSB2b2lkIDA7XG4gICAgICB0aGlzLm1heExlbmd0aCA9IHZvaWQgMDtcbiAgICAgIGNvbnN0ICR0ZXh0YXJlYSA9IHRoaXMuJHJvb3QucXVlcnlTZWxlY3RvcignLmdvdnVrLWpzLWNoYXJhY3Rlci1jb3VudCcpO1xuICAgICAgaWYgKCEoJHRleHRhcmVhIGluc3RhbmNlb2YgSFRNTFRleHRBcmVhRWxlbWVudCB8fCAkdGV4dGFyZWEgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSkge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICBjb21wb25lbnQ6IENoYXJhY3RlckNvdW50LFxuICAgICAgICAgIGVsZW1lbnQ6ICR0ZXh0YXJlYSxcbiAgICAgICAgICBleHBlY3RlZFR5cGU6ICdIVE1MVGV4dGFyZWFFbGVtZW50IG9yIEhUTUxJbnB1dEVsZW1lbnQnLFxuICAgICAgICAgIGlkZW50aWZpZXI6ICdGb3JtIGZpZWxkIChgLmdvdnVrLWpzLWNoYXJhY3Rlci1jb3VudGApJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRlQ29uZmlnKENoYXJhY3RlckNvdW50LnNjaGVtYSwgdGhpcy5jb25maWcpO1xuICAgICAgaWYgKGVycm9yc1swXSkge1xuICAgICAgICB0aHJvdyBuZXcgQ29uZmlnRXJyb3IoZm9ybWF0RXJyb3JNZXNzYWdlKENoYXJhY3RlckNvdW50LCBlcnJvcnNbMF0pKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaTE4biA9IG5ldyBJMThuKHRoaXMuY29uZmlnLmkxOG4sIHtcbiAgICAgICAgbG9jYWxlOiBjbG9zZXN0QXR0cmlidXRlVmFsdWUodGhpcy4kcm9vdCwgJ2xhbmcnKVxuICAgICAgfSk7XG4gICAgICB0aGlzLm1heExlbmd0aCA9IChfcmVmID0gKF90aGlzJGNvbmZpZyRtYXh3b3JkcyA9IHRoaXMuY29uZmlnLm1heHdvcmRzKSAhPSBudWxsID8gX3RoaXMkY29uZmlnJG1heHdvcmRzIDogdGhpcy5jb25maWcubWF4bGVuZ3RoKSAhPSBudWxsID8gX3JlZiA6IEluZmluaXR5O1xuICAgICAgdGhpcy4kdGV4dGFyZWEgPSAkdGV4dGFyZWE7XG4gICAgICBjb25zdCB0ZXh0YXJlYURlc2NyaXB0aW9uSWQgPSBgJHt0aGlzLiR0ZXh0YXJlYS5pZH0taW5mb2A7XG4gICAgICBjb25zdCAkdGV4dGFyZWFEZXNjcmlwdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRleHRhcmVhRGVzY3JpcHRpb25JZCk7XG4gICAgICBpZiAoISR0ZXh0YXJlYURlc2NyaXB0aW9uKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGNvbXBvbmVudDogQ2hhcmFjdGVyQ291bnQsXG4gICAgICAgICAgZWxlbWVudDogJHRleHRhcmVhRGVzY3JpcHRpb24sXG4gICAgICAgICAgaWRlbnRpZmllcjogYENvdW50IG1lc3NhZ2UgKFxcYGlkPVwiJHt0ZXh0YXJlYURlc2NyaXB0aW9uSWR9XCJcXGApYFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuJGVycm9yTWVzc2FnZSA9IHRoaXMuJHJvb3QucXVlcnlTZWxlY3RvcignLmdvdnVrLWVycm9yLW1lc3NhZ2UnKTtcbiAgICAgIGlmIChgJHskdGV4dGFyZWFEZXNjcmlwdGlvbi50ZXh0Q29udGVudH1gLm1hdGNoKC9eXFxzKiQvKSkge1xuICAgICAgICAkdGV4dGFyZWFEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHRoaXMuaTE4bi50KCd0ZXh0YXJlYURlc2NyaXB0aW9uJywge1xuICAgICAgICAgIGNvdW50OiB0aGlzLm1heExlbmd0aFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuJHRleHRhcmVhLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJlbmQnLCAkdGV4dGFyZWFEZXNjcmlwdGlvbik7XG4gICAgICBjb25zdCAkc2NyZWVuUmVhZGVyQ291bnRNZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAkc2NyZWVuUmVhZGVyQ291bnRNZXNzYWdlLmNsYXNzTmFtZSA9ICdnb3Z1ay1jaGFyYWN0ZXItY291bnRfX3NyLXN0YXR1cyBnb3Z1ay12aXN1YWxseS1oaWRkZW4nO1xuICAgICAgJHNjcmVlblJlYWRlckNvdW50TWVzc2FnZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGl2ZScsICdwb2xpdGUnKTtcbiAgICAgIHRoaXMuJHNjcmVlblJlYWRlckNvdW50TWVzc2FnZSA9ICRzY3JlZW5SZWFkZXJDb3VudE1lc3NhZ2U7XG4gICAgICAkdGV4dGFyZWFEZXNjcmlwdGlvbi5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyZW5kJywgJHNjcmVlblJlYWRlckNvdW50TWVzc2FnZSk7XG4gICAgICBjb25zdCAkdmlzaWJsZUNvdW50TWVzc2FnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgJHZpc2libGVDb3VudE1lc3NhZ2UuY2xhc3NOYW1lID0gJHRleHRhcmVhRGVzY3JpcHRpb24uY2xhc3NOYW1lO1xuICAgICAgJHZpc2libGVDb3VudE1lc3NhZ2UuY2xhc3NMaXN0LmFkZCgnZ292dWstY2hhcmFjdGVyLWNvdW50X19zdGF0dXMnKTtcbiAgICAgICR2aXNpYmxlQ291bnRNZXNzYWdlLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgdGhpcy4kdmlzaWJsZUNvdW50TWVzc2FnZSA9ICR2aXNpYmxlQ291bnRNZXNzYWdlO1xuICAgICAgJHRleHRhcmVhRGVzY3JpcHRpb24uaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmVuZCcsICR2aXNpYmxlQ291bnRNZXNzYWdlKTtcbiAgICAgICR0ZXh0YXJlYURlc2NyaXB0aW9uLmNsYXNzTGlzdC5hZGQoJ2dvdnVrLXZpc3VhbGx5LWhpZGRlbicpO1xuICAgICAgdGhpcy4kdGV4dGFyZWEucmVtb3ZlQXR0cmlidXRlKCdtYXhsZW5ndGgnKTtcbiAgICAgIHRoaXMuYmluZENoYW5nZUV2ZW50cygpO1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BhZ2VzaG93JywgKCkgPT4gdGhpcy51cGRhdGVDb3VudE1lc3NhZ2UoKSk7XG4gICAgICB0aGlzLnVwZGF0ZUNvdW50TWVzc2FnZSgpO1xuICAgIH1cbiAgICBiaW5kQ2hhbmdlRXZlbnRzKCkge1xuICAgICAgdGhpcy4kdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoKSA9PiB0aGlzLmhhbmRsZUtleVVwKCkpO1xuICAgICAgdGhpcy4kdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PiB0aGlzLmhhbmRsZUZvY3VzKCkpO1xuICAgICAgdGhpcy4kdGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHRoaXMuaGFuZGxlQmx1cigpKTtcbiAgICB9XG4gICAgaGFuZGxlS2V5VXAoKSB7XG4gICAgICB0aGlzLnVwZGF0ZVZpc2libGVDb3VudE1lc3NhZ2UoKTtcbiAgICAgIHRoaXMubGFzdElucHV0VGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICB9XG4gICAgaGFuZGxlRm9jdXMoKSB7XG4gICAgICB0aGlzLnZhbHVlQ2hlY2tlciA9IHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5sYXN0SW5wdXRUaW1lc3RhbXAgfHwgRGF0ZS5ub3coKSAtIDUwMCA+PSB0aGlzLmxhc3RJbnB1dFRpbWVzdGFtcCkge1xuICAgICAgICAgIHRoaXMudXBkYXRlSWZWYWx1ZUNoYW5nZWQoKTtcbiAgICAgICAgfVxuICAgICAgfSwgMTAwMCk7XG4gICAgfVxuICAgIGhhbmRsZUJsdXIoKSB7XG4gICAgICBpZiAodGhpcy52YWx1ZUNoZWNrZXIpIHtcbiAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy52YWx1ZUNoZWNrZXIpO1xuICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVJZlZhbHVlQ2hhbmdlZCgpIHtcbiAgICAgIGlmICh0aGlzLiR0ZXh0YXJlYS52YWx1ZSAhPT0gdGhpcy5sYXN0SW5wdXRWYWx1ZSkge1xuICAgICAgICB0aGlzLmxhc3RJbnB1dFZhbHVlID0gdGhpcy4kdGV4dGFyZWEudmFsdWU7XG4gICAgICAgIHRoaXMudXBkYXRlQ291bnRNZXNzYWdlKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUNvdW50TWVzc2FnZSgpIHtcbiAgICAgIHRoaXMudXBkYXRlVmlzaWJsZUNvdW50TWVzc2FnZSgpO1xuICAgICAgdGhpcy51cGRhdGVTY3JlZW5SZWFkZXJDb3VudE1lc3NhZ2UoKTtcbiAgICB9XG4gICAgdXBkYXRlVmlzaWJsZUNvdW50TWVzc2FnZSgpIHtcbiAgICAgIGNvbnN0IHJlbWFpbmluZ051bWJlciA9IHRoaXMubWF4TGVuZ3RoIC0gdGhpcy5jb3VudCh0aGlzLiR0ZXh0YXJlYS52YWx1ZSk7XG4gICAgICBjb25zdCBpc0Vycm9yID0gcmVtYWluaW5nTnVtYmVyIDwgMDtcbiAgICAgIHRoaXMuJHZpc2libGVDb3VudE1lc3NhZ2UuY2xhc3NMaXN0LnRvZ2dsZSgnZ292dWstY2hhcmFjdGVyLWNvdW50X19tZXNzYWdlLS1kaXNhYmxlZCcsICF0aGlzLmlzT3ZlclRocmVzaG9sZCgpKTtcbiAgICAgIGlmICghdGhpcy4kZXJyb3JNZXNzYWdlKSB7XG4gICAgICAgIHRoaXMuJHRleHRhcmVhLmNsYXNzTGlzdC50b2dnbGUoJ2dvdnVrLXRleHRhcmVhLS1lcnJvcicsIGlzRXJyb3IpO1xuICAgICAgfVxuICAgICAgdGhpcy4kdmlzaWJsZUNvdW50TWVzc2FnZS5jbGFzc0xpc3QudG9nZ2xlKCdnb3Z1ay1lcnJvci1tZXNzYWdlJywgaXNFcnJvcik7XG4gICAgICB0aGlzLiR2aXNpYmxlQ291bnRNZXNzYWdlLmNsYXNzTGlzdC50b2dnbGUoJ2dvdnVrLWhpbnQnLCAhaXNFcnJvcik7XG4gICAgICB0aGlzLiR2aXNpYmxlQ291bnRNZXNzYWdlLnRleHRDb250ZW50ID0gdGhpcy5nZXRDb3VudE1lc3NhZ2UoKTtcbiAgICB9XG4gICAgdXBkYXRlU2NyZWVuUmVhZGVyQ291bnRNZXNzYWdlKCkge1xuICAgICAgaWYgKHRoaXMuaXNPdmVyVGhyZXNob2xkKCkpIHtcbiAgICAgICAgdGhpcy4kc2NyZWVuUmVhZGVyQ291bnRNZXNzYWdlLnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuJHNjcmVlblJlYWRlckNvdW50TWVzc2FnZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuJHNjcmVlblJlYWRlckNvdW50TWVzc2FnZS50ZXh0Q29udGVudCA9IHRoaXMuZ2V0Q291bnRNZXNzYWdlKCk7XG4gICAgfVxuICAgIGNvdW50KHRleHQpIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5tYXh3b3Jkcykge1xuICAgICAgICB2YXIgX3RleHQkbWF0Y2g7XG4gICAgICAgIGNvbnN0IHRva2VucyA9IChfdGV4dCRtYXRjaCA9IHRleHQubWF0Y2goL1xcUysvZykpICE9IG51bGwgPyBfdGV4dCRtYXRjaCA6IFtdO1xuICAgICAgICByZXR1cm4gdG9rZW5zLmxlbmd0aDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0ZXh0Lmxlbmd0aDtcbiAgICB9XG4gICAgZ2V0Q291bnRNZXNzYWdlKCkge1xuICAgICAgY29uc3QgcmVtYWluaW5nTnVtYmVyID0gdGhpcy5tYXhMZW5ndGggLSB0aGlzLmNvdW50KHRoaXMuJHRleHRhcmVhLnZhbHVlKTtcbiAgICAgIGNvbnN0IGNvdW50VHlwZSA9IHRoaXMuY29uZmlnLm1heHdvcmRzID8gJ3dvcmRzJyA6ICdjaGFyYWN0ZXJzJztcbiAgICAgIHJldHVybiB0aGlzLmZvcm1hdENvdW50TWVzc2FnZShyZW1haW5pbmdOdW1iZXIsIGNvdW50VHlwZSk7XG4gICAgfVxuICAgIGZvcm1hdENvdW50TWVzc2FnZShyZW1haW5pbmdOdW1iZXIsIGNvdW50VHlwZSkge1xuICAgICAgaWYgKHJlbWFpbmluZ051bWJlciA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pMThuLnQoYCR7Y291bnRUeXBlfUF0TGltaXRgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHRyYW5zbGF0aW9uS2V5U3VmZml4ID0gcmVtYWluaW5nTnVtYmVyIDwgMCA/ICdPdmVyTGltaXQnIDogJ1VuZGVyTGltaXQnO1xuICAgICAgcmV0dXJuIHRoaXMuaTE4bi50KGAke2NvdW50VHlwZX0ke3RyYW5zbGF0aW9uS2V5U3VmZml4fWAsIHtcbiAgICAgICAgY291bnQ6IE1hdGguYWJzKHJlbWFpbmluZ051bWJlcilcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpc092ZXJUaHJlc2hvbGQoKSB7XG4gICAgICBpZiAoIXRoaXMuY29uZmlnLnRocmVzaG9sZCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGN1cnJlbnRMZW5ndGggPSB0aGlzLmNvdW50KHRoaXMuJHRleHRhcmVhLnZhbHVlKTtcbiAgICAgIGNvbnN0IG1heExlbmd0aCA9IHRoaXMubWF4TGVuZ3RoO1xuICAgICAgY29uc3QgdGhyZXNob2xkVmFsdWUgPSBtYXhMZW5ndGggKiB0aGlzLmNvbmZpZy50aHJlc2hvbGQgLyAxMDA7XG4gICAgICByZXR1cm4gdGhyZXNob2xkVmFsdWUgPD0gY3VycmVudExlbmd0aDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hhcmFjdGVyIGNvdW50IGNvbmZpZ1xuICAgKlxuICAgKiBAc2VlIHtAbGluayBDaGFyYWN0ZXJDb3VudC5kZWZhdWx0c31cbiAgICogQHR5cGVkZWYge29iamVjdH0gQ2hhcmFjdGVyQ291bnRDb25maWdcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFttYXhsZW5ndGhdIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMuXG4gICAqICAgSWYgbWF4d29yZHMgaXMgcHJvdmlkZWQsIHRoZSBtYXhsZW5ndGggb3B0aW9uIHdpbGwgYmUgaWdub3JlZC5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFttYXh3b3Jkc10gLSBUaGUgbWF4aW11bSBudW1iZXIgb2Ygd29yZHMuIElmIG1heHdvcmRzIGlzXG4gICAqICAgcHJvdmlkZWQsIHRoZSBtYXhsZW5ndGggb3B0aW9uIHdpbGwgYmUgaWdub3JlZC5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFt0aHJlc2hvbGQ9MF0gLSBUaGUgcGVyY2VudGFnZSB2YWx1ZSBvZiB0aGUgbGltaXQgYXRcbiAgICogICB3aGljaCBwb2ludCB0aGUgY291bnQgbWVzc2FnZSBpcyBkaXNwbGF5ZWQuIElmIHRoaXMgYXR0cmlidXRlIGlzIHNldCwgdGhlXG4gICAqICAgY291bnQgbWVzc2FnZSB3aWxsIGJlIGhpZGRlbiBieSBkZWZhdWx0LlxuICAgKiBAcHJvcGVydHkge0NoYXJhY3RlckNvdW50VHJhbnNsYXRpb25zfSBbaTE4bj1DaGFyYWN0ZXJDb3VudC5kZWZhdWx0cy5pMThuXSAtIENoYXJhY3RlciBjb3VudCB0cmFuc2xhdGlvbnNcbiAgICovXG5cbiAgLyoqXG4gICAqIENoYXJhY3RlciBjb3VudCB0cmFuc2xhdGlvbnNcbiAgICpcbiAgICogQHNlZSB7QGxpbmsgQ2hhcmFjdGVyQ291bnQuZGVmYXVsdHMuaTE4bn1cbiAgICogQHR5cGVkZWYge29iamVjdH0gQ2hhcmFjdGVyQ291bnRUcmFuc2xhdGlvbnNcbiAgICpcbiAgICogTWVzc2FnZXMgc2hvd24gdG8gdXNlcnMgYXMgdGhleSB0eXBlLiBJdCBwcm92aWRlcyBmZWVkYmFjayBvbiBob3cgbWFueSB3b3Jkc1xuICAgKiBvciBjaGFyYWN0ZXJzIHRoZXkgaGF2ZSByZW1haW5pbmcgb3IgaWYgdGhleSBhcmUgb3ZlciB0aGUgbGltaXQuIFRoaXMgYWxzb1xuICAgKiBpbmNsdWRlcyBhIG1lc3NhZ2UgdXNlZCBhcyBhbiBhY2Nlc3NpYmxlIGRlc2NyaXB0aW9uIGZvciB0aGUgdGV4dGFyZWEuXG4gICAqIEBwcm9wZXJ0eSB7VHJhbnNsYXRpb25QbHVyYWxGb3Jtc30gW2NoYXJhY3RlcnNVbmRlckxpbWl0XSAtIE1lc3NhZ2UgZGlzcGxheWVkXG4gICAqICAgd2hlbiB0aGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgaXMgdW5kZXIgdGhlIGNvbmZpZ3VyZWQgbWF4aW11bSwgYG1heGxlbmd0aGAuXG4gICAqICAgVGhpcyBtZXNzYWdlIGlzIGRpc3BsYXllZCB2aXN1YWxseSBhbmQgdGhyb3VnaCBhc3Npc3RpdmUgdGVjaG5vbG9naWVzLiBUaGVcbiAgICogICBjb21wb25lbnQgd2lsbCByZXBsYWNlIHRoZSBgJXtjb3VudH1gIHBsYWNlaG9sZGVyIHdpdGggdGhlIG51bWJlciBvZlxuICAgKiAgIHJlbWFpbmluZyBjaGFyYWN0ZXJzLiBUaGlzIGlzIGEgW3BsdXJhbGlzZWQgbGlzdCBvZlxuICAgKiAgIG1lc3NhZ2VzXShodHRwczovL2Zyb250ZW5kLmRlc2lnbi1zeXN0ZW0uc2VydmljZS5nb3YudWsvbG9jYWxpc2UtZ292dWstZnJvbnRlbmQpLlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW2NoYXJhY3RlcnNBdExpbWl0XSAtIE1lc3NhZ2UgZGlzcGxheWVkIHdoZW4gdGhlIG51bWJlciBvZlxuICAgKiAgIGNoYXJhY3RlcnMgcmVhY2hlcyB0aGUgY29uZmlndXJlZCBtYXhpbXVtLCBgbWF4bGVuZ3RoYC4gVGhpcyBtZXNzYWdlIGlzXG4gICAqICAgZGlzcGxheWVkIHZpc3VhbGx5IGFuZCB0aHJvdWdoIGFzc2lzdGl2ZSB0ZWNobm9sb2dpZXMuXG4gICAqIEBwcm9wZXJ0eSB7VHJhbnNsYXRpb25QbHVyYWxGb3Jtc30gW2NoYXJhY3RlcnNPdmVyTGltaXRdIC0gTWVzc2FnZSBkaXNwbGF5ZWRcbiAgICogICB3aGVuIHRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyBpcyBvdmVyIHRoZSBjb25maWd1cmVkIG1heGltdW0sIGBtYXhsZW5ndGhgLlxuICAgKiAgIFRoaXMgbWVzc2FnZSBpcyBkaXNwbGF5ZWQgdmlzdWFsbHkgYW5kIHRocm91Z2ggYXNzaXN0aXZlIHRlY2hub2xvZ2llcy4gVGhlXG4gICAqICAgY29tcG9uZW50IHdpbGwgcmVwbGFjZSB0aGUgYCV7Y291bnR9YCBwbGFjZWhvbGRlciB3aXRoIHRoZSBudW1iZXIgb2ZcbiAgICogICByZW1haW5pbmcgY2hhcmFjdGVycy4gVGhpcyBpcyBhIFtwbHVyYWxpc2VkIGxpc3Qgb2ZcbiAgICogICBtZXNzYWdlc10oaHR0cHM6Ly9mcm9udGVuZC5kZXNpZ24tc3lzdGVtLnNlcnZpY2UuZ292LnVrL2xvY2FsaXNlLWdvdnVrLWZyb250ZW5kKS5cbiAgICogQHByb3BlcnR5IHtUcmFuc2xhdGlvblBsdXJhbEZvcm1zfSBbd29yZHNVbmRlckxpbWl0XSAtIE1lc3NhZ2UgZGlzcGxheWVkIHdoZW5cbiAgICogICB0aGUgbnVtYmVyIG9mIHdvcmRzIGlzIHVuZGVyIHRoZSBjb25maWd1cmVkIG1heGltdW0sIGBtYXhsZW5ndGhgLiBUaGlzXG4gICAqICAgbWVzc2FnZSBpcyBkaXNwbGF5ZWQgdmlzdWFsbHkgYW5kIHRocm91Z2ggYXNzaXN0aXZlIHRlY2hub2xvZ2llcy4gVGhlXG4gICAqICAgY29tcG9uZW50IHdpbGwgcmVwbGFjZSB0aGUgYCV7Y291bnR9YCBwbGFjZWhvbGRlciB3aXRoIHRoZSBudW1iZXIgb2ZcbiAgICogICByZW1haW5pbmcgd29yZHMuIFRoaXMgaXMgYSBbcGx1cmFsaXNlZCBsaXN0IG9mXG4gICAqICAgbWVzc2FnZXNdKGh0dHBzOi8vZnJvbnRlbmQuZGVzaWduLXN5c3RlbS5zZXJ2aWNlLmdvdi51ay9sb2NhbGlzZS1nb3Z1ay1mcm9udGVuZCkuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbd29yZHNBdExpbWl0XSAtIE1lc3NhZ2UgZGlzcGxheWVkIHdoZW4gdGhlIG51bWJlciBvZlxuICAgKiAgIHdvcmRzIHJlYWNoZXMgdGhlIGNvbmZpZ3VyZWQgbWF4aW11bSwgYG1heGxlbmd0aGAuIFRoaXMgbWVzc2FnZSBpc1xuICAgKiAgIGRpc3BsYXllZCB2aXN1YWxseSBhbmQgdGhyb3VnaCBhc3Npc3RpdmUgdGVjaG5vbG9naWVzLlxuICAgKiBAcHJvcGVydHkge1RyYW5zbGF0aW9uUGx1cmFsRm9ybXN9IFt3b3Jkc092ZXJMaW1pdF0gLSBNZXNzYWdlIGRpc3BsYXllZCB3aGVuXG4gICAqICAgdGhlIG51bWJlciBvZiB3b3JkcyBpcyBvdmVyIHRoZSBjb25maWd1cmVkIG1heGltdW0sIGBtYXhsZW5ndGhgLiBUaGlzXG4gICAqICAgbWVzc2FnZSBpcyBkaXNwbGF5ZWQgdmlzdWFsbHkgYW5kIHRocm91Z2ggYXNzaXN0aXZlIHRlY2hub2xvZ2llcy4gVGhlXG4gICAqICAgY29tcG9uZW50IHdpbGwgcmVwbGFjZSB0aGUgYCV7Y291bnR9YCBwbGFjZWhvbGRlciB3aXRoIHRoZSBudW1iZXIgb2ZcbiAgICogICByZW1haW5pbmcgd29yZHMuIFRoaXMgaXMgYSBbcGx1cmFsaXNlZCBsaXN0IG9mXG4gICAqICAgbWVzc2FnZXNdKGh0dHBzOi8vZnJvbnRlbmQuZGVzaWduLXN5c3RlbS5zZXJ2aWNlLmdvdi51ay9sb2NhbGlzZS1nb3Z1ay1mcm9udGVuZCkuXG4gICAqIEBwcm9wZXJ0eSB7VHJhbnNsYXRpb25QbHVyYWxGb3Jtc30gW3RleHRhcmVhRGVzY3JpcHRpb25dIC0gTWVzc2FnZSBtYWRlXG4gICAqICAgYXZhaWxhYmxlIHRvIGFzc2lzdGl2ZSB0ZWNobm9sb2dpZXMsIGlmIG5vbmUgaXMgYWxyZWFkeSBwcmVzZW50IGluIHRoZVxuICAgKiAgIEhUTUwsIHRvIGRlc2NyaWJlIHRoYXQgdGhlIGNvbXBvbmVudCBhY2NlcHRzIG9ubHkgYSBsaW1pdGVkIGFtb3VudCBvZlxuICAgKiAgIGNvbnRlbnQuIEl0IGlzIHZpc2libGUgb24gdGhlIHBhZ2Ugd2hlbiBKYXZhU2NyaXB0IGlzIHVuYXZhaWxhYmxlLiBUaGVcbiAgICogICBjb21wb25lbnQgd2lsbCByZXBsYWNlIHRoZSBgJXtjb3VudH1gIHBsYWNlaG9sZGVyIHdpdGggdGhlIHZhbHVlIG9mIHRoZVxuICAgKiAgIGBtYXhsZW5ndGhgIG9yIGBtYXh3b3Jkc2AgcGFyYW1ldGVyLlxuICAgKi9cblxuICAvKipcbiAgICogQGltcG9ydCB7IFNjaGVtYSB9IGZyb20gJy4uLy4uL2NvbW1vbi9jb25maWd1cmF0aW9uLm1qcydcbiAgICogQGltcG9ydCB7IFRyYW5zbGF0aW9uUGx1cmFsRm9ybXMgfSBmcm9tICcuLi8uLi9pMThuLm1qcydcbiAgICovXG4gIENoYXJhY3RlckNvdW50Lm1vZHVsZU5hbWUgPSAnZ292dWstY2hhcmFjdGVyLWNvdW50JztcbiAgQ2hhcmFjdGVyQ291bnQuZGVmYXVsdHMgPSBPYmplY3QuZnJlZXplKHtcbiAgICB0aHJlc2hvbGQ6IDAsXG4gICAgaTE4bjoge1xuICAgICAgY2hhcmFjdGVyc1VuZGVyTGltaXQ6IHtcbiAgICAgICAgb25lOiAnWW91IGhhdmUgJXtjb3VudH0gY2hhcmFjdGVyIHJlbWFpbmluZycsXG4gICAgICAgIG90aGVyOiAnWW91IGhhdmUgJXtjb3VudH0gY2hhcmFjdGVycyByZW1haW5pbmcnXG4gICAgICB9LFxuICAgICAgY2hhcmFjdGVyc0F0TGltaXQ6ICdZb3UgaGF2ZSAwIGNoYXJhY3RlcnMgcmVtYWluaW5nJyxcbiAgICAgIGNoYXJhY3RlcnNPdmVyTGltaXQ6IHtcbiAgICAgICAgb25lOiAnWW91IGhhdmUgJXtjb3VudH0gY2hhcmFjdGVyIHRvbyBtYW55JyxcbiAgICAgICAgb3RoZXI6ICdZb3UgaGF2ZSAle2NvdW50fSBjaGFyYWN0ZXJzIHRvbyBtYW55J1xuICAgICAgfSxcbiAgICAgIHdvcmRzVW5kZXJMaW1pdDoge1xuICAgICAgICBvbmU6ICdZb3UgaGF2ZSAle2NvdW50fSB3b3JkIHJlbWFpbmluZycsXG4gICAgICAgIG90aGVyOiAnWW91IGhhdmUgJXtjb3VudH0gd29yZHMgcmVtYWluaW5nJ1xuICAgICAgfSxcbiAgICAgIHdvcmRzQXRMaW1pdDogJ1lvdSBoYXZlIDAgd29yZHMgcmVtYWluaW5nJyxcbiAgICAgIHdvcmRzT3ZlckxpbWl0OiB7XG4gICAgICAgIG9uZTogJ1lvdSBoYXZlICV7Y291bnR9IHdvcmQgdG9vIG1hbnknLFxuICAgICAgICBvdGhlcjogJ1lvdSBoYXZlICV7Y291bnR9IHdvcmRzIHRvbyBtYW55J1xuICAgICAgfSxcbiAgICAgIHRleHRhcmVhRGVzY3JpcHRpb246IHtcbiAgICAgICAgb3RoZXI6ICcnXG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgQ2hhcmFjdGVyQ291bnQuc2NoZW1hID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgcHJvcGVydGllczoge1xuICAgICAgaTE4bjoge1xuICAgICAgICB0eXBlOiAnb2JqZWN0J1xuICAgICAgfSxcbiAgICAgIG1heHdvcmRzOiB7XG4gICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICB9LFxuICAgICAgbWF4bGVuZ3RoOiB7XG4gICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICB9LFxuICAgICAgdGhyZXNob2xkOiB7XG4gICAgICAgIHR5cGU6ICdudW1iZXInXG4gICAgICB9XG4gICAgfSxcbiAgICBhbnlPZjogW3tcbiAgICAgIHJlcXVpcmVkOiBbJ21heHdvcmRzJ10sXG4gICAgICBlcnJvck1lc3NhZ2U6ICdFaXRoZXIgXCJtYXhsZW5ndGhcIiBvciBcIm1heHdvcmRzXCIgbXVzdCBiZSBwcm92aWRlZCdcbiAgICB9LCB7XG4gICAgICByZXF1aXJlZDogWydtYXhsZW5ndGgnXSxcbiAgICAgIGVycm9yTWVzc2FnZTogJ0VpdGhlciBcIm1heGxlbmd0aFwiIG9yIFwibWF4d29yZHNcIiBtdXN0IGJlIHByb3ZpZGVkJ1xuICAgIH1dXG4gIH0pO1xuXG4gIC8qKlxuICAgKiBDaGVja2JveGVzIGNvbXBvbmVudFxuICAgKlxuICAgKiBAcHJlc2VydmVcbiAgICovXG4gIGNsYXNzIENoZWNrYm94ZXMgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIENoZWNrYm94ZXMgY2FuIGJlIGFzc29jaWF0ZWQgd2l0aCBhICdjb25kaXRpb25hbGx5IHJldmVhbGVkJyBjb250ZW50IGJsb2NrXG4gICAgICog4oCTIGZvciBleGFtcGxlLCBhIGNoZWNrYm94IGZvciAnUGhvbmUnIGNvdWxkIHJldmVhbCBhbiBhZGRpdGlvbmFsIGZvcm0gZmllbGRcbiAgICAgKiBmb3IgdGhlIHVzZXIgdG8gZW50ZXIgdGhlaXIgcGhvbmUgbnVtYmVyLlxuICAgICAqXG4gICAgICogVGhlc2UgYXNzb2NpYXRpb25zIGFyZSBtYWRlIHVzaW5nIGEgYGRhdGEtYXJpYS1jb250cm9sc2AgYXR0cmlidXRlLCB3aGljaFxuICAgICAqIGlzIHByb21vdGVkIHRvIGFuIGFyaWEtY29udHJvbHMgYXR0cmlidXRlIGR1cmluZyBpbml0aWFsaXNhdGlvbi5cbiAgICAgKlxuICAgICAqIFdlIGFsc28gbmVlZCB0byByZXN0b3JlIHRoZSBzdGF0ZSBvZiBhbnkgY29uZGl0aW9uYWwgcmV2ZWFscyBvbiB0aGUgcGFnZVxuICAgICAqIChmb3IgZXhhbXBsZSBpZiB0aGUgdXNlciBoYXMgbmF2aWdhdGVkIGJhY2spLCBhbmQgc2V0IHVwIGV2ZW50IGhhbmRsZXJzIHRvXG4gICAgICoga2VlcCB0aGUgcmV2ZWFsIGluIHN5bmMgd2l0aCB0aGUgY2hlY2tib3ggc3RhdGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnQgfCBudWxsfSAkcm9vdCAtIEhUTUwgZWxlbWVudCB0byB1c2UgZm9yIGNoZWNrYm94ZXNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcigkcm9vdCkge1xuICAgICAgc3VwZXIoJHJvb3QpO1xuICAgICAgdGhpcy4kaW5wdXRzID0gdm9pZCAwO1xuICAgICAgY29uc3QgJGlucHV0cyA9IHRoaXMuJHJvb3QucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJyk7XG4gICAgICBpZiAoISRpbnB1dHMubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGNvbXBvbmVudDogQ2hlY2tib3hlcyxcbiAgICAgICAgICBpZGVudGlmaWVyOiAnRm9ybSBpbnB1dHMgKGA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCI+YCknXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy4kaW5wdXRzID0gJGlucHV0cztcbiAgICAgIHRoaXMuJGlucHV0cy5mb3JFYWNoKCRpbnB1dCA9PiB7XG4gICAgICAgIGNvbnN0IHRhcmdldElkID0gJGlucHV0LmdldEF0dHJpYnV0ZSgnZGF0YS1hcmlhLWNvbnRyb2xzJyk7XG4gICAgICAgIGlmICghdGFyZ2V0SWQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXRJZCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICAgIGNvbXBvbmVudDogQ2hlY2tib3hlcyxcbiAgICAgICAgICAgIGlkZW50aWZpZXI6IGBDb25kaXRpb25hbCByZXZlYWwgKFxcYGlkPVwiJHt0YXJnZXRJZH1cIlxcYClgXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgJGlucHV0LnNldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycsIHRhcmdldElkKTtcbiAgICAgICAgJGlucHV0LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1hcmlhLWNvbnRyb2xzJyk7XG4gICAgICB9KTtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwYWdlc2hvdycsICgpID0+IHRoaXMuc3luY0FsbENvbmRpdGlvbmFsUmV2ZWFscygpKTtcbiAgICAgIHRoaXMuc3luY0FsbENvbmRpdGlvbmFsUmV2ZWFscygpO1xuICAgICAgdGhpcy4kcm9vdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHRoaXMuaGFuZGxlQ2xpY2soZXZlbnQpKTtcbiAgICB9XG4gICAgc3luY0FsbENvbmRpdGlvbmFsUmV2ZWFscygpIHtcbiAgICAgIHRoaXMuJGlucHV0cy5mb3JFYWNoKCRpbnB1dCA9PiB0aGlzLnN5bmNDb25kaXRpb25hbFJldmVhbFdpdGhJbnB1dFN0YXRlKCRpbnB1dCkpO1xuICAgIH1cbiAgICBzeW5jQ29uZGl0aW9uYWxSZXZlYWxXaXRoSW5wdXRTdGF0ZSgkaW5wdXQpIHtcbiAgICAgIGNvbnN0IHRhcmdldElkID0gJGlucHV0LmdldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycpO1xuICAgICAgaWYgKCF0YXJnZXRJZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCAkdGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFyZ2V0SWQpO1xuICAgICAgaWYgKCR0YXJnZXQgIT0gbnVsbCAmJiAkdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZ292dWstY2hlY2tib3hlc19fY29uZGl0aW9uYWwnKSkge1xuICAgICAgICBjb25zdCBpbnB1dElzQ2hlY2tlZCA9ICRpbnB1dC5jaGVja2VkO1xuICAgICAgICAkaW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgaW5wdXRJc0NoZWNrZWQudG9TdHJpbmcoKSk7XG4gICAgICAgICR0YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZSgnZ292dWstY2hlY2tib3hlc19fY29uZGl0aW9uYWwtLWhpZGRlbicsICFpbnB1dElzQ2hlY2tlZCk7XG4gICAgICB9XG4gICAgfVxuICAgIHVuQ2hlY2tBbGxJbnB1dHNFeGNlcHQoJGlucHV0KSB7XG4gICAgICBjb25zdCBhbGxJbnB1dHNXaXRoU2FtZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl1bbmFtZT1cIiR7JGlucHV0Lm5hbWV9XCJdYCk7XG4gICAgICBhbGxJbnB1dHNXaXRoU2FtZU5hbWUuZm9yRWFjaCgkaW5wdXRXaXRoU2FtZU5hbWUgPT4ge1xuICAgICAgICBjb25zdCBoYXNTYW1lRm9ybU93bmVyID0gJGlucHV0LmZvcm0gPT09ICRpbnB1dFdpdGhTYW1lTmFtZS5mb3JtO1xuICAgICAgICBpZiAoaGFzU2FtZUZvcm1Pd25lciAmJiAkaW5wdXRXaXRoU2FtZU5hbWUgIT09ICRpbnB1dCkge1xuICAgICAgICAgICRpbnB1dFdpdGhTYW1lTmFtZS5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5zeW5jQ29uZGl0aW9uYWxSZXZlYWxXaXRoSW5wdXRTdGF0ZSgkaW5wdXRXaXRoU2FtZU5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgdW5DaGVja0V4Y2x1c2l2ZUlucHV0cygkaW5wdXQpIHtcbiAgICAgIGNvbnN0IGFsbElucHV0c1dpdGhTYW1lTmFtZUFuZEV4Y2x1c2l2ZUJlaGF2aW91ciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYGlucHV0W2RhdGEtYmVoYXZpb3VyPVwiZXhjbHVzaXZlXCJdW3R5cGU9XCJjaGVja2JveFwiXVtuYW1lPVwiJHskaW5wdXQubmFtZX1cIl1gKTtcbiAgICAgIGFsbElucHV0c1dpdGhTYW1lTmFtZUFuZEV4Y2x1c2l2ZUJlaGF2aW91ci5mb3JFYWNoKCRleGNsdXNpdmVJbnB1dCA9PiB7XG4gICAgICAgIGNvbnN0IGhhc1NhbWVGb3JtT3duZXIgPSAkaW5wdXQuZm9ybSA9PT0gJGV4Y2x1c2l2ZUlucHV0LmZvcm07XG4gICAgICAgIGlmIChoYXNTYW1lRm9ybU93bmVyKSB7XG4gICAgICAgICAgJGV4Y2x1c2l2ZUlucHV0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLnN5bmNDb25kaXRpb25hbFJldmVhbFdpdGhJbnB1dFN0YXRlKCRleGNsdXNpdmVJbnB1dCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVDbGljayhldmVudCkge1xuICAgICAgY29uc3QgJGNsaWNrZWRJbnB1dCA9IGV2ZW50LnRhcmdldDtcbiAgICAgIGlmICghKCRjbGlja2VkSW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB8fCAkY2xpY2tlZElucHV0LnR5cGUgIT09ICdjaGVja2JveCcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgaGFzQXJpYUNvbnRyb2xzID0gJGNsaWNrZWRJbnB1dC5nZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnKTtcbiAgICAgIGlmIChoYXNBcmlhQ29udHJvbHMpIHtcbiAgICAgICAgdGhpcy5zeW5jQ29uZGl0aW9uYWxSZXZlYWxXaXRoSW5wdXRTdGF0ZSgkY2xpY2tlZElucHV0KTtcbiAgICAgIH1cbiAgICAgIGlmICghJGNsaWNrZWRJbnB1dC5jaGVja2VkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGhhc0JlaGF2aW91ckV4Y2x1c2l2ZSA9ICRjbGlja2VkSW5wdXQuZ2V0QXR0cmlidXRlKCdkYXRhLWJlaGF2aW91cicpID09PSAnZXhjbHVzaXZlJztcbiAgICAgIGlmIChoYXNCZWhhdmlvdXJFeGNsdXNpdmUpIHtcbiAgICAgICAgdGhpcy51bkNoZWNrQWxsSW5wdXRzRXhjZXB0KCRjbGlja2VkSW5wdXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy51bkNoZWNrRXhjbHVzaXZlSW5wdXRzKCRjbGlja2VkSW5wdXQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBDaGVja2JveGVzLm1vZHVsZU5hbWUgPSAnZ292dWstY2hlY2tib3hlcyc7XG5cbiAgLyoqXG4gICAqIEVycm9yIHN1bW1hcnkgY29tcG9uZW50XG4gICAqXG4gICAqIFRha2VzIGZvY3VzIG9uIGluaXRpYWxpc2F0aW9uIGZvciBhY2Nlc3NpYmxlIGFubm91bmNlbWVudCwgdW5sZXNzIGRpc2FibGVkIGluXG4gICAqIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIEBwcmVzZXJ2ZVxuICAgKiBAYXVnbWVudHMgQ29uZmlndXJhYmxlQ29tcG9uZW50PEVycm9yU3VtbWFyeUNvbmZpZz5cbiAgICovXG4gIGNsYXNzIEVycm9yU3VtbWFyeSBleHRlbmRzIENvbmZpZ3VyYWJsZUNvbXBvbmVudCB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtFbGVtZW50IHwgbnVsbH0gJHJvb3QgLSBIVE1MIGVsZW1lbnQgdG8gdXNlIGZvciBlcnJvciBzdW1tYXJ5XG4gICAgICogQHBhcmFtIHtFcnJvclN1bW1hcnlDb25maWd9IFtjb25maWddIC0gRXJyb3Igc3VtbWFyeSBjb25maWdcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcigkcm9vdCwgY29uZmlnID0ge30pIHtcbiAgICAgIHN1cGVyKCRyb290LCBjb25maWcpO1xuICAgICAgaWYgKCF0aGlzLmNvbmZpZy5kaXNhYmxlQXV0b0ZvY3VzKSB7XG4gICAgICAgIHNldEZvY3VzKHRoaXMuJHJvb3QpO1xuICAgICAgfVxuICAgICAgdGhpcy4kcm9vdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHRoaXMuaGFuZGxlQ2xpY2soZXZlbnQpKTtcbiAgICB9XG4gICAgaGFuZGxlQ2xpY2soZXZlbnQpIHtcbiAgICAgIGNvbnN0ICR0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICBpZiAoJHRhcmdldCAmJiB0aGlzLmZvY3VzVGFyZ2V0KCR0YXJnZXQpKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfVxuICAgIGZvY3VzVGFyZ2V0KCR0YXJnZXQpIHtcbiAgICAgIGlmICghKCR0YXJnZXQgaW5zdGFuY2VvZiBIVE1MQW5jaG9yRWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3QgaW5wdXRJZCA9IGdldEZyYWdtZW50RnJvbVVybCgkdGFyZ2V0LmhyZWYpO1xuICAgICAgaWYgKCFpbnB1dElkKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0ICRpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlucHV0SWQpO1xuICAgICAgaWYgKCEkaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3QgJGxlZ2VuZE9yTGFiZWwgPSB0aGlzLmdldEFzc29jaWF0ZWRMZWdlbmRPckxhYmVsKCRpbnB1dCk7XG4gICAgICBpZiAoISRsZWdlbmRPckxhYmVsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgICRsZWdlbmRPckxhYmVsLnNjcm9sbEludG9WaWV3KCk7XG4gICAgICAkaW5wdXQuZm9jdXMoe1xuICAgICAgICBwcmV2ZW50U2Nyb2xsOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXRBc3NvY2lhdGVkTGVnZW5kT3JMYWJlbCgkaW5wdXQpIHtcbiAgICAgIHZhciBfZG9jdW1lbnQkcXVlcnlTZWxlY3Q7XG4gICAgICBjb25zdCAkZmllbGRzZXQgPSAkaW5wdXQuY2xvc2VzdCgnZmllbGRzZXQnKTtcbiAgICAgIGlmICgkZmllbGRzZXQpIHtcbiAgICAgICAgY29uc3QgJGxlZ2VuZHMgPSAkZmllbGRzZXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2xlZ2VuZCcpO1xuICAgICAgICBpZiAoJGxlZ2VuZHMubGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3QgJGNhbmRpZGF0ZUxlZ2VuZCA9ICRsZWdlbmRzWzBdO1xuICAgICAgICAgIGlmICgkaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50ICYmICgkaW5wdXQudHlwZSA9PT0gJ2NoZWNrYm94JyB8fCAkaW5wdXQudHlwZSA9PT0gJ3JhZGlvJykpIHtcbiAgICAgICAgICAgIHJldHVybiAkY2FuZGlkYXRlTGVnZW5kO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBsZWdlbmRUb3AgPSAkY2FuZGlkYXRlTGVnZW5kLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICAgICAgICBjb25zdCBpbnB1dFJlY3QgPSAkaW5wdXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgaWYgKGlucHV0UmVjdC5oZWlnaHQgJiYgd2luZG93LmlubmVySGVpZ2h0KSB7XG4gICAgICAgICAgICBjb25zdCBpbnB1dEJvdHRvbSA9IGlucHV0UmVjdC50b3AgKyBpbnB1dFJlY3QuaGVpZ2h0O1xuICAgICAgICAgICAgaWYgKGlucHV0Qm90dG9tIC0gbGVnZW5kVG9wIDwgd2luZG93LmlubmVySGVpZ2h0IC8gMikge1xuICAgICAgICAgICAgICByZXR1cm4gJGNhbmRpZGF0ZUxlZ2VuZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiAoX2RvY3VtZW50JHF1ZXJ5U2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgbGFiZWxbZm9yPSckeyRpbnB1dC5nZXRBdHRyaWJ1dGUoJ2lkJyl9J11gKSkgIT0gbnVsbCA/IF9kb2N1bWVudCRxdWVyeVNlbGVjdCA6ICRpbnB1dC5jbG9zZXN0KCdsYWJlbCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFcnJvciBzdW1tYXJ5IGNvbmZpZ1xuICAgKlxuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBFcnJvclN1bW1hcnlDb25maWdcbiAgICogQHByb3BlcnR5IHtib29sZWFufSBbZGlzYWJsZUF1dG9Gb2N1cz1mYWxzZV0gLSBJZiBzZXQgdG8gYHRydWVgIHRoZSBlcnJvclxuICAgKiAgIHN1bW1hcnkgd2lsbCBub3QgYmUgZm9jdXNzZWQgd2hlbiB0aGUgcGFnZSBsb2Fkcy5cbiAgICovXG5cbiAgLyoqXG4gICAqIEBpbXBvcnQgeyBTY2hlbWEgfSBmcm9tICcuLi8uLi9jb21tb24vY29uZmlndXJhdGlvbi5tanMnXG4gICAqL1xuICBFcnJvclN1bW1hcnkubW9kdWxlTmFtZSA9ICdnb3Z1ay1lcnJvci1zdW1tYXJ5JztcbiAgRXJyb3JTdW1tYXJ5LmRlZmF1bHRzID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgZGlzYWJsZUF1dG9Gb2N1czogZmFsc2VcbiAgfSk7XG4gIEVycm9yU3VtbWFyeS5zY2hlbWEgPSBPYmplY3QuZnJlZXplKHtcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICBkaXNhYmxlQXV0b0ZvY3VzOiB7XG4gICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEV4aXQgdGhpcyBwYWdlIGNvbXBvbmVudFxuICAgKlxuICAgKiBAcHJlc2VydmVcbiAgICogQGF1Z21lbnRzIENvbmZpZ3VyYWJsZUNvbXBvbmVudDxFeGl0VGhpc1BhZ2VDb25maWc+XG4gICAqL1xuICBjbGFzcyBFeGl0VGhpc1BhZ2UgZXh0ZW5kcyBDb25maWd1cmFibGVDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudCB8IG51bGx9ICRyb290IC0gSFRNTCBlbGVtZW50IHRoYXQgd3JhcHMgdGhlIEV4aXQgVGhpcyBQYWdlIGJ1dHRvblxuICAgICAqIEBwYXJhbSB7RXhpdFRoaXNQYWdlQ29uZmlnfSBbY29uZmlnXSAtIEV4aXQgVGhpcyBQYWdlIGNvbmZpZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCRyb290LCBjb25maWcgPSB7fSkge1xuICAgICAgc3VwZXIoJHJvb3QsIGNvbmZpZyk7XG4gICAgICB0aGlzLmkxOG4gPSB2b2lkIDA7XG4gICAgICB0aGlzLiRidXR0b24gPSB2b2lkIDA7XG4gICAgICB0aGlzLiRza2lwbGlua0J1dHRvbiA9IG51bGw7XG4gICAgICB0aGlzLiR1cGRhdGVTcGFuID0gbnVsbDtcbiAgICAgIHRoaXMuJGluZGljYXRvckNvbnRhaW5lciA9IG51bGw7XG4gICAgICB0aGlzLiRvdmVybGF5ID0gbnVsbDtcbiAgICAgIHRoaXMua2V5cHJlc3NDb3VudGVyID0gMDtcbiAgICAgIHRoaXMubGFzdEtleVdhc01vZGlmaWVkID0gZmFsc2U7XG4gICAgICB0aGlzLnRpbWVvdXRUaW1lID0gNTAwMDtcbiAgICAgIHRoaXMua2V5cHJlc3NUaW1lb3V0SWQgPSBudWxsO1xuICAgICAgdGhpcy50aW1lb3V0TWVzc2FnZUlkID0gbnVsbDtcbiAgICAgIGNvbnN0ICRidXR0b24gPSB0aGlzLiRyb290LnF1ZXJ5U2VsZWN0b3IoJy5nb3Z1ay1leGl0LXRoaXMtcGFnZV9fYnV0dG9uJyk7XG4gICAgICBpZiAoISgkYnV0dG9uIGluc3RhbmNlb2YgSFRNTEFuY2hvckVsZW1lbnQpKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGNvbXBvbmVudDogRXhpdFRoaXNQYWdlLFxuICAgICAgICAgIGVsZW1lbnQ6ICRidXR0b24sXG4gICAgICAgICAgZXhwZWN0ZWRUeXBlOiAnSFRNTEFuY2hvckVsZW1lbnQnLFxuICAgICAgICAgIGlkZW50aWZpZXI6ICdCdXR0b24gKGAuZ292dWstZXhpdC10aGlzLXBhZ2VfX2J1dHRvbmApJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaTE4biA9IG5ldyBJMThuKHRoaXMuY29uZmlnLmkxOG4pO1xuICAgICAgdGhpcy4kYnV0dG9uID0gJGJ1dHRvbjtcbiAgICAgIGNvbnN0ICRza2lwbGlua0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nb3Z1ay1qcy1leGl0LXRoaXMtcGFnZS1za2lwbGluaycpO1xuICAgICAgaWYgKCRza2lwbGlua0J1dHRvbiBpbnN0YW5jZW9mIEhUTUxBbmNob3JFbGVtZW50KSB7XG4gICAgICAgIHRoaXMuJHNraXBsaW5rQnV0dG9uID0gJHNraXBsaW5rQnV0dG9uO1xuICAgICAgfVxuICAgICAgdGhpcy5idWlsZEluZGljYXRvcigpO1xuICAgICAgdGhpcy5pbml0VXBkYXRlU3BhbigpO1xuICAgICAgdGhpcy5pbml0QnV0dG9uQ2xpY2tIYW5kbGVyKCk7XG4gICAgICBpZiAoISgnZ292dWtGcm9udGVuZEV4aXRUaGlzUGFnZUtleXByZXNzJyBpbiBkb2N1bWVudC5ib2R5LmRhdGFzZXQpKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5oYW5kbGVLZXlwcmVzcy5iaW5kKHRoaXMpLCB0cnVlKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5kYXRhc2V0LmdvdnVrRnJvbnRlbmRFeGl0VGhpc1BhZ2VLZXlwcmVzcyA9ICd0cnVlJztcbiAgICAgIH1cbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwYWdlc2hvdycsIHRoaXMucmVzZXRQYWdlLmJpbmQodGhpcykpO1xuICAgIH1cbiAgICBpbml0VXBkYXRlU3BhbigpIHtcbiAgICAgIHRoaXMuJHVwZGF0ZVNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICB0aGlzLiR1cGRhdGVTcGFuLnNldEF0dHJpYnV0ZSgncm9sZScsICdzdGF0dXMnKTtcbiAgICAgIHRoaXMuJHVwZGF0ZVNwYW4uY2xhc3NOYW1lID0gJ2dvdnVrLXZpc3VhbGx5LWhpZGRlbic7XG4gICAgICB0aGlzLiRyb290LmFwcGVuZENoaWxkKHRoaXMuJHVwZGF0ZVNwYW4pO1xuICAgIH1cbiAgICBpbml0QnV0dG9uQ2xpY2tIYW5kbGVyKCkge1xuICAgICAgdGhpcy4kYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVDbGljay5iaW5kKHRoaXMpKTtcbiAgICAgIGlmICh0aGlzLiRza2lwbGlua0J1dHRvbikge1xuICAgICAgICB0aGlzLiRza2lwbGlua0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlQ2xpY2suYmluZCh0aGlzKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGJ1aWxkSW5kaWNhdG9yKCkge1xuICAgICAgdGhpcy4kaW5kaWNhdG9yQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICB0aGlzLiRpbmRpY2F0b3JDb250YWluZXIuY2xhc3NOYW1lID0gJ2dvdnVrLWV4aXQtdGhpcy1wYWdlX19pbmRpY2F0b3InO1xuICAgICAgdGhpcy4kaW5kaWNhdG9yQ29udGFpbmVyLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgY29uc3QgJGluZGljYXRvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAkaW5kaWNhdG9yLmNsYXNzTmFtZSA9ICdnb3Z1ay1leGl0LXRoaXMtcGFnZV9faW5kaWNhdG9yLWxpZ2h0JztcbiAgICAgICAgdGhpcy4kaW5kaWNhdG9yQ29udGFpbmVyLmFwcGVuZENoaWxkKCRpbmRpY2F0b3IpO1xuICAgICAgfVxuICAgICAgdGhpcy4kYnV0dG9uLmFwcGVuZENoaWxkKHRoaXMuJGluZGljYXRvckNvbnRhaW5lcik7XG4gICAgfVxuICAgIHVwZGF0ZUluZGljYXRvcigpIHtcbiAgICAgIGlmICghdGhpcy4kaW5kaWNhdG9yQ29udGFpbmVyKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuJGluZGljYXRvckNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdnb3Z1ay1leGl0LXRoaXMtcGFnZV9faW5kaWNhdG9yLS12aXNpYmxlJywgdGhpcy5rZXlwcmVzc0NvdW50ZXIgPiAwKTtcbiAgICAgIGNvbnN0ICRpbmRpY2F0b3JzID0gdGhpcy4kaW5kaWNhdG9yQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5nb3Z1ay1leGl0LXRoaXMtcGFnZV9faW5kaWNhdG9yLWxpZ2h0Jyk7XG4gICAgICAkaW5kaWNhdG9ycy5mb3JFYWNoKCgkaW5kaWNhdG9yLCBpbmRleCkgPT4ge1xuICAgICAgICAkaW5kaWNhdG9yLmNsYXNzTGlzdC50b2dnbGUoJ2dvdnVrLWV4aXQtdGhpcy1wYWdlX19pbmRpY2F0b3ItbGlnaHQtLW9uJywgaW5kZXggPCB0aGlzLmtleXByZXNzQ291bnRlcik7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZXhpdFBhZ2UoKSB7XG4gICAgICBpZiAoIXRoaXMuJHVwZGF0ZVNwYW4pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy4kdXBkYXRlU3Bhbi50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdnb3Z1ay1leGl0LXRoaXMtcGFnZS1oaWRlLWNvbnRlbnQnKTtcbiAgICAgIHRoaXMuJG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHRoaXMuJG92ZXJsYXkuY2xhc3NOYW1lID0gJ2dvdnVrLWV4aXQtdGhpcy1wYWdlLW92ZXJsYXknO1xuICAgICAgdGhpcy4kb3ZlcmxheS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYWxlcnQnKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy4kb3ZlcmxheSk7XG4gICAgICB0aGlzLiRvdmVybGF5LnRleHRDb250ZW50ID0gdGhpcy5pMThuLnQoJ2FjdGl2YXRlZCcpO1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB0aGlzLiRidXR0b24uaHJlZjtcbiAgICB9XG4gICAgaGFuZGxlQ2xpY2soZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLmV4aXRQYWdlKCk7XG4gICAgfVxuICAgIGhhbmRsZUtleXByZXNzKGV2ZW50KSB7XG4gICAgICBpZiAoIXRoaXMuJHVwZGF0ZVNwYW4pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ1NoaWZ0JyAmJiAhdGhpcy5sYXN0S2V5V2FzTW9kaWZpZWQpIHtcbiAgICAgICAgdGhpcy5rZXlwcmVzc0NvdW50ZXIgKz0gMTtcbiAgICAgICAgdGhpcy51cGRhdGVJbmRpY2F0b3IoKTtcbiAgICAgICAgaWYgKHRoaXMudGltZW91dE1lc3NhZ2VJZCkge1xuICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy50aW1lb3V0TWVzc2FnZUlkKTtcbiAgICAgICAgICB0aGlzLnRpbWVvdXRNZXNzYWdlSWQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmtleXByZXNzQ291bnRlciA+PSAzKSB7XG4gICAgICAgICAgdGhpcy5rZXlwcmVzc0NvdW50ZXIgPSAwO1xuICAgICAgICAgIGlmICh0aGlzLmtleXByZXNzVGltZW91dElkKSB7XG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMua2V5cHJlc3NUaW1lb3V0SWQpO1xuICAgICAgICAgICAgdGhpcy5rZXlwcmVzc1RpbWVvdXRJZCA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuZXhpdFBhZ2UoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodGhpcy5rZXlwcmVzc0NvdW50ZXIgPT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuJHVwZGF0ZVNwYW4udGV4dENvbnRlbnQgPSB0aGlzLmkxOG4udCgncHJlc3NUd29Nb3JlVGltZXMnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kdXBkYXRlU3Bhbi50ZXh0Q29udGVudCA9IHRoaXMuaTE4bi50KCdwcmVzc09uZU1vcmVUaW1lJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0S2V5cHJlc3NUaW1lcigpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmtleXByZXNzVGltZW91dElkKSB7XG4gICAgICAgIHRoaXMucmVzZXRLZXlwcmVzc1RpbWVyKCk7XG4gICAgICB9XG4gICAgICB0aGlzLmxhc3RLZXlXYXNNb2RpZmllZCA9IGV2ZW50LnNoaWZ0S2V5O1xuICAgIH1cbiAgICBzZXRLZXlwcmVzc1RpbWVyKCkge1xuICAgICAgaWYgKHRoaXMua2V5cHJlc3NUaW1lb3V0SWQpIHtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLmtleXByZXNzVGltZW91dElkKTtcbiAgICAgIH1cbiAgICAgIHRoaXMua2V5cHJlc3NUaW1lb3V0SWQgPSB3aW5kb3cuc2V0VGltZW91dCh0aGlzLnJlc2V0S2V5cHJlc3NUaW1lci5iaW5kKHRoaXMpLCB0aGlzLnRpbWVvdXRUaW1lKTtcbiAgICB9XG4gICAgcmVzZXRLZXlwcmVzc1RpbWVyKCkge1xuICAgICAgaWYgKCF0aGlzLiR1cGRhdGVTcGFuKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmtleXByZXNzVGltZW91dElkKSB7XG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5rZXlwcmVzc1RpbWVvdXRJZCk7XG4gICAgICAgIHRoaXMua2V5cHJlc3NUaW1lb3V0SWQgPSBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgJHVwZGF0ZVNwYW4gPSB0aGlzLiR1cGRhdGVTcGFuO1xuICAgICAgdGhpcy5rZXlwcmVzc0NvdW50ZXIgPSAwO1xuICAgICAgJHVwZGF0ZVNwYW4udGV4dENvbnRlbnQgPSB0aGlzLmkxOG4udCgndGltZWRPdXQnKTtcbiAgICAgIHRoaXMudGltZW91dE1lc3NhZ2VJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgJHVwZGF0ZVNwYW4udGV4dENvbnRlbnQgPSAnJztcbiAgICAgIH0sIHRoaXMudGltZW91dFRpbWUpO1xuICAgICAgdGhpcy51cGRhdGVJbmRpY2F0b3IoKTtcbiAgICB9XG4gICAgcmVzZXRQYWdlKCkge1xuICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdnb3Z1ay1leGl0LXRoaXMtcGFnZS1oaWRlLWNvbnRlbnQnKTtcbiAgICAgIGlmICh0aGlzLiRvdmVybGF5KSB7XG4gICAgICAgIHRoaXMuJG92ZXJsYXkucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMuJG92ZXJsYXkgPSBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuJHVwZGF0ZVNwYW4pIHtcbiAgICAgICAgdGhpcy4kdXBkYXRlU3Bhbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnc3RhdHVzJyk7XG4gICAgICAgIHRoaXMuJHVwZGF0ZVNwYW4udGV4dENvbnRlbnQgPSAnJztcbiAgICAgIH1cbiAgICAgIHRoaXMudXBkYXRlSW5kaWNhdG9yKCk7XG4gICAgICBpZiAodGhpcy5rZXlwcmVzc1RpbWVvdXRJZCkge1xuICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMua2V5cHJlc3NUaW1lb3V0SWQpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMudGltZW91dE1lc3NhZ2VJZCkge1xuICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dE1lc3NhZ2VJZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4aXQgdGhpcyBQYWdlIGNvbmZpZ1xuICAgKlxuICAgKiBAc2VlIHtAbGluayBFeGl0VGhpc1BhZ2UuZGVmYXVsdHN9XG4gICAqIEB0eXBlZGVmIHtvYmplY3R9IEV4aXRUaGlzUGFnZUNvbmZpZ1xuICAgKiBAcHJvcGVydHkge0V4aXRUaGlzUGFnZVRyYW5zbGF0aW9uc30gW2kxOG49RXhpdFRoaXNQYWdlLmRlZmF1bHRzLmkxOG5dIC0gRXhpdCB0aGlzIHBhZ2UgdHJhbnNsYXRpb25zXG4gICAqL1xuXG4gIC8qKlxuICAgKiBFeGl0IHRoaXMgUGFnZSB0cmFuc2xhdGlvbnNcbiAgICpcbiAgICogQHNlZSB7QGxpbmsgRXhpdFRoaXNQYWdlLmRlZmF1bHRzLmkxOG59XG4gICAqIEB0eXBlZGVmIHtvYmplY3R9IEV4aXRUaGlzUGFnZVRyYW5zbGF0aW9uc1xuICAgKlxuICAgKiBNZXNzYWdlcyB1c2VkIGJ5IHRoZSBjb21wb25lbnQgcHJvZ3JhbWF0aWNhbGx5IGluc2VydGVkIHRleHQsIGluY2x1ZGluZ1xuICAgKiBvdmVybGF5IHRleHQgYW5kIHNjcmVlbiByZWFkZXIgYW5ub3VuY2VtZW50cy5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFthY3RpdmF0ZWRdIC0gU2NyZWVuIHJlYWRlciBhbm5vdW5jZW1lbnQgZm9yIHdoZW4gRXRQXG4gICAqICAga2V5cHJlc3MgZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgYWN0aXZhdGVkLlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3RpbWVkT3V0XSAtIFNjcmVlbiByZWFkZXIgYW5ub3VuY2VtZW50IGZvciB3aGVuIHRoZSBFdFBcbiAgICogICBrZXlwcmVzcyBmdW5jdGlvbmFsaXR5IGhhcyB0aW1lZCBvdXQuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbcHJlc3NUd29Nb3JlVGltZXNdIC0gU2NyZWVuIHJlYWRlciBhbm5vdW5jZW1lbnQgaW5mb3JtaW5nXG4gICAqICAgdGhlIHVzZXIgdGhleSBtdXN0IHByZXNzIHRoZSBhY3RpdmF0aW9uIGtleSB0d28gbW9yZSB0aW1lcy5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtwcmVzc09uZU1vcmVUaW1lXSAtIFNjcmVlbiByZWFkZXIgYW5ub3VuY2VtZW50IGluZm9ybWluZ1xuICAgKiAgIHRoZSB1c2VyIHRoZXkgbXVzdCBwcmVzcyB0aGUgYWN0aXZhdGlvbiBrZXkgb25lIG1vcmUgdGltZS5cbiAgICovXG5cbiAgLyoqXG4gICAqIEBpbXBvcnQgeyBTY2hlbWEgfSBmcm9tICcuLi8uLi9jb21tb24vY29uZmlndXJhdGlvbi5tanMnXG4gICAqL1xuICBFeGl0VGhpc1BhZ2UubW9kdWxlTmFtZSA9ICdnb3Z1ay1leGl0LXRoaXMtcGFnZSc7XG4gIEV4aXRUaGlzUGFnZS5kZWZhdWx0cyA9IE9iamVjdC5mcmVlemUoe1xuICAgIGkxOG46IHtcbiAgICAgIGFjdGl2YXRlZDogJ0xvYWRpbmcuJyxcbiAgICAgIHRpbWVkT3V0OiAnRXhpdCB0aGlzIHBhZ2UgZXhwaXJlZC4nLFxuICAgICAgcHJlc3NUd29Nb3JlVGltZXM6ICdTaGlmdCwgcHJlc3MgMiBtb3JlIHRpbWVzIHRvIGV4aXQuJyxcbiAgICAgIHByZXNzT25lTW9yZVRpbWU6ICdTaGlmdCwgcHJlc3MgMSBtb3JlIHRpbWUgdG8gZXhpdC4nXG4gICAgfVxuICB9KTtcbiAgRXhpdFRoaXNQYWdlLnNjaGVtYSA9IE9iamVjdC5mcmVlemUoe1xuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgIGkxOG46IHtcbiAgICAgICAgdHlwZTogJ29iamVjdCdcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBGaWxlIHVwbG9hZCBjb21wb25lbnRcbiAgICpcbiAgICogQHByZXNlcnZlXG4gICAqIEBhdWdtZW50cyBDb25maWd1cmFibGVDb21wb25lbnQ8RmlsZVVwbG9hZENvbmZpZz5cbiAgICovXG4gIGNsYXNzIEZpbGVVcGxvYWQgZXh0ZW5kcyBDb25maWd1cmFibGVDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudCB8IG51bGx9ICRyb290IC0gRmlsZSBpbnB1dCBlbGVtZW50XG4gICAgICogQHBhcmFtIHtGaWxlVXBsb2FkQ29uZmlnfSBbY29uZmlnXSAtIEZpbGUgVXBsb2FkIGNvbmZpZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCRyb290LCBjb25maWcgPSB7fSkge1xuICAgICAgc3VwZXIoJHJvb3QsIGNvbmZpZyk7XG4gICAgICB0aGlzLiRpbnB1dCA9IHZvaWQgMDtcbiAgICAgIHRoaXMuJGJ1dHRvbiA9IHZvaWQgMDtcbiAgICAgIHRoaXMuJHN0YXR1cyA9IHZvaWQgMDtcbiAgICAgIHRoaXMuaTE4biA9IHZvaWQgMDtcbiAgICAgIHRoaXMuaWQgPSB2b2lkIDA7XG4gICAgICB0aGlzLiRhbm5vdW5jZW1lbnRzID0gdm9pZCAwO1xuICAgICAgdGhpcy5lbnRlcmVkQW5vdGhlckVsZW1lbnQgPSB2b2lkIDA7XG4gICAgICBjb25zdCAkaW5wdXQgPSB0aGlzLiRyb290LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG4gICAgICBpZiAoJGlucHV0ID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGNvbXBvbmVudDogRmlsZVVwbG9hZCxcbiAgICAgICAgICBpZGVudGlmaWVyOiAnRmlsZSBpbnB1dHMgKGA8aW5wdXQgdHlwZT1cImZpbGVcIj5gKSdcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoJGlucHV0LnR5cGUgIT09ICdmaWxlJykge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKGZvcm1hdEVycm9yTWVzc2FnZShGaWxlVXBsb2FkLCAnRmlsZSBpbnB1dCAoYDxpbnB1dCB0eXBlPVwiZmlsZVwiPmApIGF0dHJpYnV0ZSAoYHR5cGVgKSBpcyBub3QgYGZpbGVgJykpO1xuICAgICAgfVxuICAgICAgdGhpcy4kaW5wdXQgPSAkaW5wdXQ7XG4gICAgICB0aGlzLiRpbnB1dC5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICd0cnVlJyk7XG4gICAgICBpZiAoIXRoaXMuJGlucHV0LmlkKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGNvbXBvbmVudDogRmlsZVVwbG9hZCxcbiAgICAgICAgICBpZGVudGlmaWVyOiAnRmlsZSBpbnB1dCAoYDxpbnB1dCB0eXBlPVwiZmlsZVwiPmApIGF0dHJpYnV0ZSAoYGlkYCknXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5pZCA9IHRoaXMuJGlucHV0LmlkO1xuICAgICAgdGhpcy5pMThuID0gbmV3IEkxOG4odGhpcy5jb25maWcuaTE4biwge1xuICAgICAgICBsb2NhbGU6IGNsb3Nlc3RBdHRyaWJ1dGVWYWx1ZSh0aGlzLiRyb290LCAnbGFuZycpXG4gICAgICB9KTtcbiAgICAgIGNvbnN0ICRsYWJlbCA9IHRoaXMuZmluZExhYmVsKCk7XG4gICAgICBpZiAoISRsYWJlbC5pZCkge1xuICAgICAgICAkbGFiZWwuaWQgPSBgJHt0aGlzLmlkfS1sYWJlbGA7XG4gICAgICB9XG4gICAgICB0aGlzLiRpbnB1dC5pZCA9IGAke3RoaXMuaWR9LWlucHV0YDtcbiAgICAgIGNvbnN0ICRidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgICRidXR0b24uY2xhc3NMaXN0LmFkZCgnZ292dWstZmlsZS11cGxvYWQtYnV0dG9uJyk7XG4gICAgICAkYnV0dG9uLnR5cGUgPSAnYnV0dG9uJztcbiAgICAgICRidXR0b24uaWQgPSB0aGlzLmlkO1xuICAgICAgJGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdnb3Z1ay1maWxlLXVwbG9hZC1idXR0b24tLWVtcHR5Jyk7XG4gICAgICBjb25zdCBhcmlhRGVzY3JpYmVkQnkgPSB0aGlzLiRpbnB1dC5nZXRBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknKTtcbiAgICAgIGlmIChhcmlhRGVzY3JpYmVkQnkpIHtcbiAgICAgICAgJGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknLCBhcmlhRGVzY3JpYmVkQnkpO1xuICAgICAgfVxuICAgICAgY29uc3QgJHN0YXR1cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICRzdGF0dXMuY2xhc3NOYW1lID0gJ2dvdnVrLWJvZHkgZ292dWstZmlsZS11cGxvYWQtYnV0dG9uX19zdGF0dXMnO1xuICAgICAgJHN0YXR1cy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGl2ZScsICdwb2xpdGUnKTtcbiAgICAgICRzdGF0dXMuaW5uZXJUZXh0ID0gdGhpcy5pMThuLnQoJ25vRmlsZUNob3NlbicpO1xuICAgICAgJGJ1dHRvbi5hcHBlbmRDaGlsZCgkc3RhdHVzKTtcbiAgICAgIGNvbnN0IGNvbW1hU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgIGNvbW1hU3Bhbi5jbGFzc05hbWUgPSAnZ292dWstdmlzdWFsbHktaGlkZGVuJztcbiAgICAgIGNvbW1hU3Bhbi5pbm5lclRleHQgPSAnLCAnO1xuICAgICAgY29tbWFTcGFuLmlkID0gYCR7dGhpcy5pZH0tY29tbWFgO1xuICAgICAgJGJ1dHRvbi5hcHBlbmRDaGlsZChjb21tYVNwYW4pO1xuICAgICAgY29uc3QgY29udGFpbmVyU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgIGNvbnRhaW5lclNwYW4uY2xhc3NOYW1lID0gJ2dvdnVrLWZpbGUtdXBsb2FkLWJ1dHRvbl9fcHNldWRvLWJ1dHRvbi1jb250YWluZXInO1xuICAgICAgY29uc3QgYnV0dG9uU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgIGJ1dHRvblNwYW4uY2xhc3NOYW1lID0gJ2dvdnVrLWJ1dHRvbiBnb3Z1ay1idXR0b24tLXNlY29uZGFyeSBnb3Z1ay1maWxlLXVwbG9hZC1idXR0b25fX3BzZXVkby1idXR0b24nO1xuICAgICAgYnV0dG9uU3Bhbi5pbm5lclRleHQgPSB0aGlzLmkxOG4udCgnY2hvb3NlRmlsZXNCdXR0b24nKTtcbiAgICAgIGNvbnRhaW5lclNwYW4uYXBwZW5kQ2hpbGQoYnV0dG9uU3Bhbik7XG4gICAgICBjb250YWluZXJTcGFuLmluc2VydEFkamFjZW50VGV4dCgnYmVmb3JlZW5kJywgJyAnKTtcbiAgICAgIGNvbnN0IGluc3RydWN0aW9uU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgIGluc3RydWN0aW9uU3Bhbi5jbGFzc05hbWUgPSAnZ292dWstYm9keSBnb3Z1ay1maWxlLXVwbG9hZC1idXR0b25fX2luc3RydWN0aW9uJztcbiAgICAgIGluc3RydWN0aW9uU3Bhbi5pbm5lclRleHQgPSB0aGlzLmkxOG4udCgnZHJvcEluc3RydWN0aW9uJyk7XG4gICAgICBjb250YWluZXJTcGFuLmFwcGVuZENoaWxkKGluc3RydWN0aW9uU3Bhbik7XG4gICAgICAkYnV0dG9uLmFwcGVuZENoaWxkKGNvbnRhaW5lclNwYW4pO1xuICAgICAgJGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWxsZWRieScsIGAkeyRsYWJlbC5pZH0gJHtjb21tYVNwYW4uaWR9ICR7JGJ1dHRvbi5pZH1gKTtcbiAgICAgICRidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2xpY2suYmluZCh0aGlzKSk7XG4gICAgICAkYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgZXZlbnQgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLiRyb290Lmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsICRidXR0b24pO1xuICAgICAgdGhpcy4kaW5wdXQuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpO1xuICAgICAgdGhpcy4kaW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgICB0aGlzLiRidXR0b24gPSAkYnV0dG9uO1xuICAgICAgdGhpcy4kc3RhdHVzID0gJHN0YXR1cztcbiAgICAgIHRoaXMuJGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMub25DaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLnVwZGF0ZURpc2FibGVkU3RhdGUoKTtcbiAgICAgIHRoaXMub2JzZXJ2ZURpc2FibGVkU3RhdGUoKTtcbiAgICAgIHRoaXMuJGFubm91bmNlbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICB0aGlzLiRhbm5vdW5jZW1lbnRzLmNsYXNzTGlzdC5hZGQoJ2dvdnVrLWZpbGUtdXBsb2FkLWFubm91bmNlbWVudHMnKTtcbiAgICAgIHRoaXMuJGFubm91bmNlbWVudHMuY2xhc3NMaXN0LmFkZCgnZ292dWstdmlzdWFsbHktaGlkZGVuJyk7XG4gICAgICB0aGlzLiRhbm5vdW5jZW1lbnRzLnNldEF0dHJpYnV0ZSgnYXJpYS1saXZlJywgJ2Fzc2VydGl2ZScpO1xuICAgICAgdGhpcy4kcm9vdC5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyZW5kJywgdGhpcy4kYW5ub3VuY2VtZW50cyk7XG4gICAgICB0aGlzLiRidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMub25Ecm9wLmJpbmQodGhpcykpO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VudGVyJywgdGhpcy51cGRhdGVEcm9wem9uZVZpc2liaWxpdHkuYmluZCh0aGlzKSk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW50ZXInLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuZW50ZXJlZEFub3RoZXJFbGVtZW50ID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2xlYXZlJywgKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuZW50ZXJlZEFub3RoZXJFbGVtZW50ICYmICF0aGlzLiRidXR0b24uZGlzYWJsZWQpIHtcbiAgICAgICAgICB0aGlzLmhpZGVEcmFnZ2luZ1N0YXRlKCk7XG4gICAgICAgICAgdGhpcy4kYW5ub3VuY2VtZW50cy5pbm5lclRleHQgPSB0aGlzLmkxOG4udCgnbGVmdERyb3Bab25lJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbnRlcmVkQW5vdGhlckVsZW1lbnQgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICB1cGRhdGVEcm9wem9uZVZpc2liaWxpdHkoZXZlbnQpIHtcbiAgICAgIGlmICh0aGlzLiRidXR0b24uZGlzYWJsZWQpIHJldHVybjtcbiAgICAgIGlmIChldmVudC50YXJnZXQgaW5zdGFuY2VvZiBOb2RlKSB7XG4gICAgICAgIGlmICh0aGlzLiRyb290LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGlzQ29udGFpbmluZ0ZpbGVzKGV2ZW50LmRhdGFUcmFuc2ZlcikpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy4kYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnZ292dWstZmlsZS11cGxvYWQtYnV0dG9uLS1kcmFnZ2luZycpKSB7XG4gICAgICAgICAgICAgIHRoaXMuc2hvd0RyYWdnaW5nU3RhdGUoKTtcbiAgICAgICAgICAgICAgdGhpcy4kYW5ub3VuY2VtZW50cy5pbm5lclRleHQgPSB0aGlzLmkxOG4udCgnZW50ZXJlZERyb3Bab25lJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICh0aGlzLiRidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdnb3Z1ay1maWxlLXVwbG9hZC1idXR0b24tLWRyYWdnaW5nJykpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZURyYWdnaW5nU3RhdGUoKTtcbiAgICAgICAgICAgIHRoaXMuJGFubm91bmNlbWVudHMuaW5uZXJUZXh0ID0gdGhpcy5pMThuLnQoJ2xlZnREcm9wWm9uZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBzaG93RHJhZ2dpbmdTdGF0ZSgpIHtcbiAgICAgIHRoaXMuJGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdnb3Z1ay1maWxlLXVwbG9hZC1idXR0b24tLWRyYWdnaW5nJyk7XG4gICAgfVxuICAgIGhpZGVEcmFnZ2luZ1N0YXRlKCkge1xuICAgICAgdGhpcy4kYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2dvdnVrLWZpbGUtdXBsb2FkLWJ1dHRvbi0tZHJhZ2dpbmcnKTtcbiAgICB9XG4gICAgb25Ecm9wKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgaWYgKGV2ZW50LmRhdGFUcmFuc2ZlciAmJiBpc0NvbnRhaW5pbmdGaWxlcyhldmVudC5kYXRhVHJhbnNmZXIpKSB7XG4gICAgICAgIHRoaXMuJGlucHV0LmZpbGVzID0gZXZlbnQuZGF0YVRyYW5zZmVyLmZpbGVzO1xuICAgICAgICB0aGlzLiRpbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnY2hhbmdlJykpO1xuICAgICAgICB0aGlzLmhpZGVEcmFnZ2luZ1N0YXRlKCk7XG4gICAgICB9XG4gICAgfVxuICAgIG9uQ2hhbmdlKCkge1xuICAgICAgY29uc3QgZmlsZUNvdW50ID0gdGhpcy4kaW5wdXQuZmlsZXMubGVuZ3RoO1xuICAgICAgaWYgKGZpbGVDb3VudCA9PT0gMCkge1xuICAgICAgICB0aGlzLiRzdGF0dXMuaW5uZXJUZXh0ID0gdGhpcy5pMThuLnQoJ25vRmlsZUNob3NlbicpO1xuICAgICAgICB0aGlzLiRidXR0b24uY2xhc3NMaXN0LmFkZCgnZ292dWstZmlsZS11cGxvYWQtYnV0dG9uLS1lbXB0eScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGZpbGVDb3VudCA9PT0gMSkge1xuICAgICAgICAgIHRoaXMuJHN0YXR1cy5pbm5lclRleHQgPSB0aGlzLiRpbnB1dC5maWxlc1swXS5uYW1lO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuJHN0YXR1cy5pbm5lclRleHQgPSB0aGlzLmkxOG4udCgnbXVsdGlwbGVGaWxlc0Nob3NlbicsIHtcbiAgICAgICAgICAgIGNvdW50OiBmaWxlQ291bnRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnZ292dWstZmlsZS11cGxvYWQtYnV0dG9uLS1lbXB0eScpO1xuICAgICAgfVxuICAgIH1cbiAgICBmaW5kTGFiZWwoKSB7XG4gICAgICBjb25zdCAkbGFiZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBsYWJlbFtmb3I9XCIke3RoaXMuJGlucHV0LmlkfVwiXWApO1xuICAgICAgaWYgKCEkbGFiZWwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVsZW1lbnRFcnJvcih7XG4gICAgICAgICAgY29tcG9uZW50OiBGaWxlVXBsb2FkLFxuICAgICAgICAgIGlkZW50aWZpZXI6IGBGaWVsZCBsYWJlbCAoXFxgPGxhYmVsIGZvcj0ke3RoaXMuJGlucHV0LmlkfT5cXGApYFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAkbGFiZWw7XG4gICAgfVxuICAgIG9uQ2xpY2soKSB7XG4gICAgICB0aGlzLiRpbnB1dC5jbGljaygpO1xuICAgIH1cbiAgICBvYnNlcnZlRGlzYWJsZWRTdGF0ZSgpIHtcbiAgICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIobXV0YXRpb25MaXN0ID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBtdXRhdGlvbkxpc3QpIHtcbiAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2F0dHJpYnV0ZXMnICYmIG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUgPT09ICdkaXNhYmxlZCcpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRGlzYWJsZWRTdGF0ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBvYnNlcnZlci5vYnNlcnZlKHRoaXMuJGlucHV0LCB7XG4gICAgICAgIGF0dHJpYnV0ZXM6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cbiAgICB1cGRhdGVEaXNhYmxlZFN0YXRlKCkge1xuICAgICAgdGhpcy4kYnV0dG9uLmRpc2FibGVkID0gdGhpcy4kaW5wdXQuZGlzYWJsZWQ7XG4gICAgICB0aGlzLiRyb290LmNsYXNzTGlzdC50b2dnbGUoJ2dvdnVrLWRyb3Atem9uZS0tZGlzYWJsZWQnLCB0aGlzLiRidXR0b24uZGlzYWJsZWQpO1xuICAgIH1cbiAgfVxuICBGaWxlVXBsb2FkLm1vZHVsZU5hbWUgPSAnZ292dWstZmlsZS11cGxvYWQnO1xuICBGaWxlVXBsb2FkLmRlZmF1bHRzID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgaTE4bjoge1xuICAgICAgY2hvb3NlRmlsZXNCdXR0b246ICdDaG9vc2UgZmlsZScsXG4gICAgICBkcm9wSW5zdHJ1Y3Rpb246ICdvciBkcm9wIGZpbGUnLFxuICAgICAgbm9GaWxlQ2hvc2VuOiAnTm8gZmlsZSBjaG9zZW4nLFxuICAgICAgbXVsdGlwbGVGaWxlc0Nob3Nlbjoge1xuICAgICAgICBvbmU6ICcle2NvdW50fSBmaWxlIGNob3NlbicsXG4gICAgICAgIG90aGVyOiAnJXtjb3VudH0gZmlsZXMgY2hvc2VuJ1xuICAgICAgfSxcbiAgICAgIGVudGVyZWREcm9wWm9uZTogJ0VudGVyZWQgZHJvcCB6b25lJyxcbiAgICAgIGxlZnREcm9wWm9uZTogJ0xlZnQgZHJvcCB6b25lJ1xuICAgIH1cbiAgfSk7XG4gIEZpbGVVcGxvYWQuc2NoZW1hID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgcHJvcGVydGllczoge1xuICAgICAgaTE4bjoge1xuICAgICAgICB0eXBlOiAnb2JqZWN0J1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGZ1bmN0aW9uIGlzQ29udGFpbmluZ0ZpbGVzKGRhdGFUcmFuc2Zlcikge1xuICAgIGNvbnN0IGhhc05vVHlwZXNJbmZvID0gZGF0YVRyYW5zZmVyLnR5cGVzLmxlbmd0aCA9PT0gMDtcbiAgICBjb25zdCBpc0RyYWdnaW5nRmlsZXMgPSBkYXRhVHJhbnNmZXIudHlwZXMuc29tZSh0eXBlID0+IHR5cGUgPT09ICdGaWxlcycpO1xuICAgIHJldHVybiBoYXNOb1R5cGVzSW5mbyB8fCBpc0RyYWdnaW5nRmlsZXM7XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge0hUTUxJbnB1dEVsZW1lbnQgJiB7ZmlsZXM6IEZpbGVMaXN0fX0gSFRNTEZpbGVJbnB1dEVsZW1lbnRcbiAgICovXG5cbiAgLyoqXG4gICAqIEZpbGUgdXBsb2FkIGNvbmZpZ1xuICAgKlxuICAgKiBAc2VlIHtAbGluayBGaWxlVXBsb2FkLmRlZmF1bHRzfVxuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBGaWxlVXBsb2FkQ29uZmlnXG4gICAqIEBwcm9wZXJ0eSB7RmlsZVVwbG9hZFRyYW5zbGF0aW9uc30gW2kxOG49RmlsZVVwbG9hZC5kZWZhdWx0cy5pMThuXSAtIEZpbGUgdXBsb2FkIHRyYW5zbGF0aW9uc1xuICAgKi9cblxuICAvKipcbiAgICogRmlsZSB1cGxvYWQgdHJhbnNsYXRpb25zXG4gICAqXG4gICAqIEBzZWUge0BsaW5rIEZpbGVVcGxvYWQuZGVmYXVsdHMuaTE4bn1cbiAgICogQHR5cGVkZWYge29iamVjdH0gRmlsZVVwbG9hZFRyYW5zbGF0aW9uc1xuICAgKlxuICAgKiBNZXNzYWdlcyB1c2VkIGJ5IHRoZSBjb21wb25lbnRcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtjaG9vc2VGaWxlXSAtIFRoZSB0ZXh0IG9mIHRoZSBidXR0b24gdGhhdCBvcGVucyB0aGUgZmlsZSBwaWNrZXJcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtkcm9wSW5zdHJ1Y3Rpb25dIC0gVGhlIHRleHQgaW5mb3JtaW5nIHVzZXJzIHRoZXkgY2FuIGRyb3AgZmlsZXNcbiAgICogQHByb3BlcnR5IHtUcmFuc2xhdGlvblBsdXJhbEZvcm1zfSBbbXVsdGlwbGVGaWxlc0Nob3Nlbl0gLSBUaGUgdGV4dCBkaXNwbGF5ZWQgd2hlbiBtdWx0aXBsZSBmaWxlc1xuICAgKiAgIGhhdmUgYmVlbiBjaG9zZW4gYnkgdGhlIHVzZXJcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtub0ZpbGVDaG9zZW5dIC0gVGhlIHRleHQgdG8gZGlzcGxheWVkIHdoZW4gbm8gZmlsZSBoYXMgYmVlbiBjaG9zZW4gYnkgdGhlIHVzZXJcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtlbnRlcmVkRHJvcFpvbmVdIC0gVGhlIHRleHQgYW5ub3VuY2VkIGJ5IGFzc2lzdGl2ZSB0ZWNobm9sb2d5XG4gICAqICAgd2hlbiB1c2VyIGRyYWdzIGZpbGVzIGFuZCBlbnRlcnMgdGhlIGRyb3Agem9uZVxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW2xlZnREcm9wWm9uZV0gLSBUaGUgdGV4dCBhbm5vdW5jZWQgYnkgYXNzaXN0aXZlIHRlY2hub2xvZ3lcbiAgICogICB3aGVuIHVzZXIgZHJhZ3MgZmlsZXMgYW5kIGxlYXZlcyB0aGUgZHJvcCB6b25lIHdpdGhvdXQgZHJvcHBpbmdcbiAgICovXG5cbiAgLyoqXG4gICAqIEBpbXBvcnQgeyBTY2hlbWEgfSBmcm9tICcuLi8uLi9jb21tb24vY29uZmlndXJhdGlvbi5tanMnXG4gICAqIEBpbXBvcnQgeyBUcmFuc2xhdGlvblBsdXJhbEZvcm1zIH0gZnJvbSAnLi4vLi4vaTE4bi5tanMnXG4gICAqL1xuXG4gIC8qKlxuICAgKiBIZWFkZXIgY29tcG9uZW50XG4gICAqXG4gICAqIEBwcmVzZXJ2ZVxuICAgKi9cbiAgY2xhc3MgSGVhZGVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICAvKipcbiAgICAgKiBBcHBseSBhIG1hdGNoTWVkaWEgZm9yIGRlc2t0b3Agd2hpY2ggd2lsbCB0cmlnZ2VyIGEgc3RhdGUgc3luYyBpZiB0aGVcbiAgICAgKiBicm93c2VyIHZpZXdwb3J0IG1vdmVzIGJldHdlZW4gc3RhdGVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50IHwgbnVsbH0gJHJvb3QgLSBIVE1MIGVsZW1lbnQgdG8gdXNlIGZvciBoZWFkZXJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcigkcm9vdCkge1xuICAgICAgc3VwZXIoJHJvb3QpO1xuICAgICAgdGhpcy4kbWVudUJ1dHRvbiA9IHZvaWQgMDtcbiAgICAgIHRoaXMuJG1lbnUgPSB2b2lkIDA7XG4gICAgICB0aGlzLm1lbnVJc09wZW4gPSBmYWxzZTtcbiAgICAgIHRoaXMubXFsID0gbnVsbDtcbiAgICAgIGNvbnN0ICRtZW51QnV0dG9uID0gdGhpcy4kcm9vdC5xdWVyeVNlbGVjdG9yKCcuZ292dWstanMtaGVhZGVyLXRvZ2dsZScpO1xuICAgICAgaWYgKCEkbWVudUJ1dHRvbikge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIHRoaXMuJHJvb3QuY2xhc3NMaXN0LmFkZCgnZ292dWstaGVhZGVyLS13aXRoLWpzLW5hdmlnYXRpb24nKTtcbiAgICAgIGNvbnN0IG1lbnVJZCA9ICRtZW51QnV0dG9uLmdldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycpO1xuICAgICAgaWYgKCFtZW51SWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVsZW1lbnRFcnJvcih7XG4gICAgICAgICAgY29tcG9uZW50OiBIZWFkZXIsXG4gICAgICAgICAgaWRlbnRpZmllcjogJ05hdmlnYXRpb24gYnV0dG9uIChgPGJ1dHRvbiBjbGFzcz1cImdvdnVrLWpzLWhlYWRlci10b2dnbGVcIj5gKSBhdHRyaWJ1dGUgKGBhcmlhLWNvbnRyb2xzYCknXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgJG1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtZW51SWQpO1xuICAgICAgaWYgKCEkbWVudSkge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICBjb21wb25lbnQ6IEhlYWRlcixcbiAgICAgICAgICBlbGVtZW50OiAkbWVudSxcbiAgICAgICAgICBpZGVudGlmaWVyOiBgTmF2aWdhdGlvbiAoXFxgPHVsIGlkPVwiJHttZW51SWR9XCI+XFxgKWBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLiRtZW51ID0gJG1lbnU7XG4gICAgICB0aGlzLiRtZW51QnV0dG9uID0gJG1lbnVCdXR0b247XG4gICAgICB0aGlzLnNldHVwUmVzcG9uc2l2ZUNoZWNrcygpO1xuICAgICAgdGhpcy4kbWVudUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuaGFuZGxlTWVudUJ1dHRvbkNsaWNrKCkpO1xuICAgIH1cbiAgICBzZXR1cFJlc3BvbnNpdmVDaGVja3MoKSB7XG4gICAgICBjb25zdCBicmVha3BvaW50ID0gZ2V0QnJlYWtwb2ludCgnZGVza3RvcCcpO1xuICAgICAgaWYgKCFicmVha3BvaW50LnZhbHVlKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGNvbXBvbmVudDogSGVhZGVyLFxuICAgICAgICAgIGlkZW50aWZpZXI6IGBDU1MgY3VzdG9tIHByb3BlcnR5IChcXGAke2JyZWFrcG9pbnQucHJvcGVydHl9XFxgKSBvbiBwc2V1ZG8tY2xhc3MgXFxgOnJvb3RcXGBgXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5tcWwgPSB3aW5kb3cubWF0Y2hNZWRpYShgKG1pbi13aWR0aDogJHticmVha3BvaW50LnZhbHVlfSlgKTtcbiAgICAgIGlmICgnYWRkRXZlbnRMaXN0ZW5lcicgaW4gdGhpcy5tcWwpIHtcbiAgICAgICAgdGhpcy5tcWwuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4gdGhpcy5jaGVja01vZGUoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm1xbC5hZGRMaXN0ZW5lcigoKSA9PiB0aGlzLmNoZWNrTW9kZSgpKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2hlY2tNb2RlKCk7XG4gICAgfVxuICAgIGNoZWNrTW9kZSgpIHtcbiAgICAgIGlmICghdGhpcy5tcWwgfHwgIXRoaXMuJG1lbnUgfHwgIXRoaXMuJG1lbnVCdXR0b24pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubXFsLm1hdGNoZXMpIHtcbiAgICAgICAgdGhpcy4kbWVudS5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgICAgICB0aGlzLiRtZW51QnV0dG9uLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4kbWVudUJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuICAgICAgICB0aGlzLiRtZW51QnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIHRoaXMubWVudUlzT3Blbi50b1N0cmluZygpKTtcbiAgICAgICAgaWYgKHRoaXMubWVudUlzT3Blbikge1xuICAgICAgICAgIHRoaXMuJG1lbnUucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLiRtZW51LnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJycpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGhhbmRsZU1lbnVCdXR0b25DbGljaygpIHtcbiAgICAgIHRoaXMubWVudUlzT3BlbiA9ICF0aGlzLm1lbnVJc09wZW47XG4gICAgICB0aGlzLmNoZWNrTW9kZSgpO1xuICAgIH1cbiAgfVxuICBIZWFkZXIubW9kdWxlTmFtZSA9ICdnb3Z1ay1oZWFkZXInO1xuXG4gIC8qKlxuICAgKiBOb3RpZmljYXRpb24gQmFubmVyIGNvbXBvbmVudFxuICAgKlxuICAgKiBAcHJlc2VydmVcbiAgICogQGF1Z21lbnRzIENvbmZpZ3VyYWJsZUNvbXBvbmVudDxOb3RpZmljYXRpb25CYW5uZXJDb25maWc+XG4gICAqL1xuICBjbGFzcyBOb3RpZmljYXRpb25CYW5uZXIgZXh0ZW5kcyBDb25maWd1cmFibGVDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudCB8IG51bGx9ICRyb290IC0gSFRNTCBlbGVtZW50IHRvIHVzZSBmb3Igbm90aWZpY2F0aW9uIGJhbm5lclxuICAgICAqIEBwYXJhbSB7Tm90aWZpY2F0aW9uQmFubmVyQ29uZmlnfSBbY29uZmlnXSAtIE5vdGlmaWNhdGlvbiBiYW5uZXIgY29uZmlnXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoJHJvb3QsIGNvbmZpZyA9IHt9KSB7XG4gICAgICBzdXBlcigkcm9vdCwgY29uZmlnKTtcbiAgICAgIGlmICh0aGlzLiRyb290LmdldEF0dHJpYnV0ZSgncm9sZScpID09PSAnYWxlcnQnICYmICF0aGlzLmNvbmZpZy5kaXNhYmxlQXV0b0ZvY3VzKSB7XG4gICAgICAgIHNldEZvY3VzKHRoaXMuJHJvb3QpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBOb3RpZmljYXRpb24gYmFubmVyIGNvbmZpZ1xuICAgKlxuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBOb3RpZmljYXRpb25CYW5uZXJDb25maWdcbiAgICogQHByb3BlcnR5IHtib29sZWFufSBbZGlzYWJsZUF1dG9Gb2N1cz1mYWxzZV0gLSBJZiBzZXQgdG8gYHRydWVgIHRoZVxuICAgKiAgIG5vdGlmaWNhdGlvbiBiYW5uZXIgd2lsbCBub3QgYmUgZm9jdXNzZWQgd2hlbiB0aGUgcGFnZSBsb2Fkcy4gVGhpcyBvbmx5XG4gICAqICAgYXBwbGllcyBpZiB0aGUgY29tcG9uZW50IGhhcyBhIGByb2xlYCBvZiBgYWxlcnRgIOKAkyBpbiBvdGhlciBjYXNlcyB0aGVcbiAgICogICBjb21wb25lbnQgd2lsbCBub3QgYmUgZm9jdXNlZCBvbiBwYWdlIGxvYWQsIHJlZ2FyZGxlc3Mgb2YgdGhpcyBvcHRpb24uXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAaW1wb3J0IHsgU2NoZW1hIH0gZnJvbSAnLi4vLi4vY29tbW9uL2NvbmZpZ3VyYXRpb24ubWpzJ1xuICAgKi9cbiAgTm90aWZpY2F0aW9uQmFubmVyLm1vZHVsZU5hbWUgPSAnZ292dWstbm90aWZpY2F0aW9uLWJhbm5lcic7XG4gIE5vdGlmaWNhdGlvbkJhbm5lci5kZWZhdWx0cyA9IE9iamVjdC5mcmVlemUoe1xuICAgIGRpc2FibGVBdXRvRm9jdXM6IGZhbHNlXG4gIH0pO1xuICBOb3RpZmljYXRpb25CYW5uZXIuc2NoZW1hID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgcHJvcGVydGllczoge1xuICAgICAgZGlzYWJsZUF1dG9Gb2N1czoge1xuICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQYXNzd29yZCBpbnB1dCBjb21wb25lbnRcbiAgICpcbiAgICogQHByZXNlcnZlXG4gICAqIEBhdWdtZW50cyBDb25maWd1cmFibGVDb21wb25lbnQ8UGFzc3dvcmRJbnB1dENvbmZpZz5cbiAgICovXG4gIGNsYXNzIFBhc3N3b3JkSW5wdXQgZXh0ZW5kcyBDb25maWd1cmFibGVDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudCB8IG51bGx9ICRyb290IC0gSFRNTCBlbGVtZW50IHRvIHVzZSBmb3IgcGFzc3dvcmQgaW5wdXRcbiAgICAgKiBAcGFyYW0ge1Bhc3N3b3JkSW5wdXRDb25maWd9IFtjb25maWddIC0gUGFzc3dvcmQgaW5wdXQgY29uZmlnXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoJHJvb3QsIGNvbmZpZyA9IHt9KSB7XG4gICAgICBzdXBlcigkcm9vdCwgY29uZmlnKTtcbiAgICAgIHRoaXMuaTE4biA9IHZvaWQgMDtcbiAgICAgIHRoaXMuJGlucHV0ID0gdm9pZCAwO1xuICAgICAgdGhpcy4kc2hvd0hpZGVCdXR0b24gPSB2b2lkIDA7XG4gICAgICB0aGlzLiRzY3JlZW5SZWFkZXJTdGF0dXNNZXNzYWdlID0gdm9pZCAwO1xuICAgICAgY29uc3QgJGlucHV0ID0gdGhpcy4kcm9vdC5xdWVyeVNlbGVjdG9yKCcuZ292dWstanMtcGFzc3dvcmQtaW5wdXQtaW5wdXQnKTtcbiAgICAgIGlmICghKCRpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGNvbXBvbmVudDogUGFzc3dvcmRJbnB1dCxcbiAgICAgICAgICBlbGVtZW50OiAkaW5wdXQsXG4gICAgICAgICAgZXhwZWN0ZWRUeXBlOiAnSFRNTElucHV0RWxlbWVudCcsXG4gICAgICAgICAgaWRlbnRpZmllcjogJ0Zvcm0gZmllbGQgKGAuZ292dWstanMtcGFzc3dvcmQtaW5wdXQtaW5wdXRgKSdcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoJGlucHV0LnR5cGUgIT09ICdwYXNzd29yZCcpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVsZW1lbnRFcnJvcignUGFzc3dvcmQgaW5wdXQ6IEZvcm0gZmllbGQgKGAuZ292dWstanMtcGFzc3dvcmQtaW5wdXQtaW5wdXRgKSBtdXN0IGJlIG9mIHR5cGUgYHBhc3N3b3JkYC4nKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0ICRzaG93SGlkZUJ1dHRvbiA9IHRoaXMuJHJvb3QucXVlcnlTZWxlY3RvcignLmdvdnVrLWpzLXBhc3N3b3JkLWlucHV0LXRvZ2dsZScpO1xuICAgICAgaWYgKCEoJHNob3dIaWRlQnV0dG9uIGluc3RhbmNlb2YgSFRNTEJ1dHRvbkVsZW1lbnQpKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGNvbXBvbmVudDogUGFzc3dvcmRJbnB1dCxcbiAgICAgICAgICBlbGVtZW50OiAkc2hvd0hpZGVCdXR0b24sXG4gICAgICAgICAgZXhwZWN0ZWRUeXBlOiAnSFRNTEJ1dHRvbkVsZW1lbnQnLFxuICAgICAgICAgIGlkZW50aWZpZXI6ICdCdXR0b24gKGAuZ292dWstanMtcGFzc3dvcmQtaW5wdXQtdG9nZ2xlYCknXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKCRzaG93SGlkZUJ1dHRvbi50eXBlICE9PSAnYnV0dG9uJykge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKCdQYXNzd29yZCBpbnB1dDogQnV0dG9uIChgLmdvdnVrLWpzLXBhc3N3b3JkLWlucHV0LXRvZ2dsZWApIG11c3QgYmUgb2YgdHlwZSBgYnV0dG9uYC4nKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuJGlucHV0ID0gJGlucHV0O1xuICAgICAgdGhpcy4kc2hvd0hpZGVCdXR0b24gPSAkc2hvd0hpZGVCdXR0b247XG4gICAgICB0aGlzLmkxOG4gPSBuZXcgSTE4bih0aGlzLmNvbmZpZy5pMThuLCB7XG4gICAgICAgIGxvY2FsZTogY2xvc2VzdEF0dHJpYnV0ZVZhbHVlKHRoaXMuJHJvb3QsICdsYW5nJylcbiAgICAgIH0pO1xuICAgICAgdGhpcy4kc2hvd0hpZGVCdXR0b24ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgIGNvbnN0ICRzY3JlZW5SZWFkZXJTdGF0dXNNZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAkc2NyZWVuUmVhZGVyU3RhdHVzTWVzc2FnZS5jbGFzc05hbWUgPSAnZ292dWstcGFzc3dvcmQtaW5wdXRfX3NyLXN0YXR1cyBnb3Z1ay12aXN1YWxseS1oaWRkZW4nO1xuICAgICAgJHNjcmVlblJlYWRlclN0YXR1c01lc3NhZ2Uuc2V0QXR0cmlidXRlKCdhcmlhLWxpdmUnLCAncG9saXRlJyk7XG4gICAgICB0aGlzLiRzY3JlZW5SZWFkZXJTdGF0dXNNZXNzYWdlID0gJHNjcmVlblJlYWRlclN0YXR1c01lc3NhZ2U7XG4gICAgICB0aGlzLiRpbnB1dC5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyZW5kJywgJHNjcmVlblJlYWRlclN0YXR1c01lc3NhZ2UpO1xuICAgICAgdGhpcy4kc2hvd0hpZGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnRvZ2dsZS5iaW5kKHRoaXMpKTtcbiAgICAgIGlmICh0aGlzLiRpbnB1dC5mb3JtKSB7XG4gICAgICAgIHRoaXMuJGlucHV0LmZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKCkgPT4gdGhpcy5oaWRlKCkpO1xuICAgICAgfVxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BhZ2VzaG93JywgZXZlbnQgPT4ge1xuICAgICAgICBpZiAoZXZlbnQucGVyc2lzdGVkICYmIHRoaXMuJGlucHV0LnR5cGUgIT09ICdwYXNzd29yZCcpIHtcbiAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICB9XG4gICAgdG9nZ2xlKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgaWYgKHRoaXMuJGlucHV0LnR5cGUgPT09ICdwYXNzd29yZCcpIHtcbiAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuaGlkZSgpO1xuICAgIH1cbiAgICBzaG93KCkge1xuICAgICAgdGhpcy5zZXRUeXBlKCd0ZXh0Jyk7XG4gICAgfVxuICAgIGhpZGUoKSB7XG4gICAgICB0aGlzLnNldFR5cGUoJ3Bhc3N3b3JkJyk7XG4gICAgfVxuICAgIHNldFR5cGUodHlwZSkge1xuICAgICAgaWYgKHR5cGUgPT09IHRoaXMuJGlucHV0LnR5cGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy4kaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgdHlwZSk7XG4gICAgICBjb25zdCBpc0hpZGRlbiA9IHR5cGUgPT09ICdwYXNzd29yZCc7XG4gICAgICBjb25zdCBwcmVmaXhCdXR0b24gPSBpc0hpZGRlbiA/ICdzaG93JyA6ICdoaWRlJztcbiAgICAgIGNvbnN0IHByZWZpeFN0YXR1cyA9IGlzSGlkZGVuID8gJ3Bhc3N3b3JkSGlkZGVuJyA6ICdwYXNzd29yZFNob3duJztcbiAgICAgIHRoaXMuJHNob3dIaWRlQnV0dG9uLmlubmVyVGV4dCA9IHRoaXMuaTE4bi50KGAke3ByZWZpeEJ1dHRvbn1QYXNzd29yZGApO1xuICAgICAgdGhpcy4kc2hvd0hpZGVCdXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgdGhpcy5pMThuLnQoYCR7cHJlZml4QnV0dG9ufVBhc3N3b3JkQXJpYUxhYmVsYCkpO1xuICAgICAgdGhpcy4kc2NyZWVuUmVhZGVyU3RhdHVzTWVzc2FnZS5pbm5lclRleHQgPSB0aGlzLmkxOG4udChgJHtwcmVmaXhTdGF0dXN9QW5ub3VuY2VtZW50YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBhc3N3b3JkIGlucHV0IGNvbmZpZ1xuICAgKlxuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBQYXNzd29yZElucHV0Q29uZmlnXG4gICAqIEBwcm9wZXJ0eSB7UGFzc3dvcmRJbnB1dFRyYW5zbGF0aW9uc30gW2kxOG49UGFzc3dvcmRJbnB1dC5kZWZhdWx0cy5pMThuXSAtIFBhc3N3b3JkIGlucHV0IHRyYW5zbGF0aW9uc1xuICAgKi9cblxuICAvKipcbiAgICogUGFzc3dvcmQgaW5wdXQgdHJhbnNsYXRpb25zXG4gICAqXG4gICAqIEBzZWUge0BsaW5rIFBhc3N3b3JkSW5wdXQuZGVmYXVsdHMuaTE4bn1cbiAgICogQHR5cGVkZWYge29iamVjdH0gUGFzc3dvcmRJbnB1dFRyYW5zbGF0aW9uc1xuICAgKlxuICAgKiBNZXNzYWdlcyBkaXNwbGF5ZWQgdG8gdGhlIHVzZXIgaW5kaWNhdGluZyB0aGUgc3RhdGUgb2YgdGhlIHNob3cvaGlkZSB0b2dnbGUuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbc2hvd1Bhc3N3b3JkXSAtIFZpc2libGUgdGV4dCBvZiB0aGUgYnV0dG9uIHdoZW4gdGhlXG4gICAqICAgcGFzc3dvcmQgaXMgY3VycmVudGx5IGhpZGRlbi4gUGxhaW4gdGV4dCBvbmx5LlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW2hpZGVQYXNzd29yZF0gLSBWaXNpYmxlIHRleHQgb2YgdGhlIGJ1dHRvbiB3aGVuIHRoZVxuICAgKiAgIHBhc3N3b3JkIGlzIGN1cnJlbnRseSB2aXNpYmxlLiBQbGFpbiB0ZXh0IG9ubHkuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbc2hvd1Bhc3N3b3JkQXJpYUxhYmVsXSAtIGFyaWEtbGFiZWwgb2YgdGhlIGJ1dHRvbiB3aGVuXG4gICAqICAgdGhlIHBhc3N3b3JkIGlzIGN1cnJlbnRseSBoaWRkZW4uIFBsYWluIHRleHQgb25seS5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtoaWRlUGFzc3dvcmRBcmlhTGFiZWxdIC0gYXJpYS1sYWJlbCBvZiB0aGUgYnV0dG9uIHdoZW5cbiAgICogICB0aGUgcGFzc3dvcmQgaXMgY3VycmVudGx5IHZpc2libGUuIFBsYWluIHRleHQgb25seS5cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtwYXNzd29yZFNob3duQW5ub3VuY2VtZW50XSAtIFNjcmVlbiByZWFkZXJcbiAgICogICBhbm5vdW5jZW1lbnQgdG8gbWFrZSB3aGVuIHRoZSBwYXNzd29yZCBoYXMganVzdCBiZWNvbWUgdmlzaWJsZS5cbiAgICogICBQbGFpbiB0ZXh0IG9ubHkuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbcGFzc3dvcmRIaWRkZW5Bbm5vdW5jZW1lbnRdIC0gU2NyZWVuIHJlYWRlclxuICAgKiAgIGFubm91bmNlbWVudCB0byBtYWtlIHdoZW4gdGhlIHBhc3N3b3JkIGhhcyBqdXN0IGJlZW4gaGlkZGVuLlxuICAgKiAgIFBsYWluIHRleHQgb25seS5cbiAgICovXG5cbiAgLyoqXG4gICAqIEBpbXBvcnQgeyBTY2hlbWEgfSBmcm9tICcuLi8uLi9jb21tb24vY29uZmlndXJhdGlvbi5tanMnXG4gICAqL1xuICBQYXNzd29yZElucHV0Lm1vZHVsZU5hbWUgPSAnZ292dWstcGFzc3dvcmQtaW5wdXQnO1xuICBQYXNzd29yZElucHV0LmRlZmF1bHRzID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgaTE4bjoge1xuICAgICAgc2hvd1Bhc3N3b3JkOiAnU2hvdycsXG4gICAgICBoaWRlUGFzc3dvcmQ6ICdIaWRlJyxcbiAgICAgIHNob3dQYXNzd29yZEFyaWFMYWJlbDogJ1Nob3cgcGFzc3dvcmQnLFxuICAgICAgaGlkZVBhc3N3b3JkQXJpYUxhYmVsOiAnSGlkZSBwYXNzd29yZCcsXG4gICAgICBwYXNzd29yZFNob3duQW5ub3VuY2VtZW50OiAnWW91ciBwYXNzd29yZCBpcyB2aXNpYmxlJyxcbiAgICAgIHBhc3N3b3JkSGlkZGVuQW5ub3VuY2VtZW50OiAnWW91ciBwYXNzd29yZCBpcyBoaWRkZW4nXG4gICAgfVxuICB9KTtcbiAgUGFzc3dvcmRJbnB1dC5zY2hlbWEgPSBPYmplY3QuZnJlZXplKHtcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICBpMThuOiB7XG4gICAgICAgIHR5cGU6ICdvYmplY3QnXG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUmFkaW9zIGNvbXBvbmVudFxuICAgKlxuICAgKiBAcHJlc2VydmVcbiAgICovXG4gIGNsYXNzIFJhZGlvcyBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgLyoqXG4gICAgICogUmFkaW9zIGNhbiBiZSBhc3NvY2lhdGVkIHdpdGggYSAnY29uZGl0aW9uYWxseSByZXZlYWxlZCcgY29udGVudCBibG9jayDigJNcbiAgICAgKiBmb3IgZXhhbXBsZSwgYSByYWRpbyBmb3IgJ1Bob25lJyBjb3VsZCByZXZlYWwgYW4gYWRkaXRpb25hbCBmb3JtIGZpZWxkIGZvclxuICAgICAqIHRoZSB1c2VyIHRvIGVudGVyIHRoZWlyIHBob25lIG51bWJlci5cbiAgICAgKlxuICAgICAqIFRoZXNlIGFzc29jaWF0aW9ucyBhcmUgbWFkZSB1c2luZyBhIGBkYXRhLWFyaWEtY29udHJvbHNgIGF0dHJpYnV0ZSwgd2hpY2hcbiAgICAgKiBpcyBwcm9tb3RlZCB0byBhbiBhcmlhLWNvbnRyb2xzIGF0dHJpYnV0ZSBkdXJpbmcgaW5pdGlhbGlzYXRpb24uXG4gICAgICpcbiAgICAgKiBXZSBhbHNvIG5lZWQgdG8gcmVzdG9yZSB0aGUgc3RhdGUgb2YgYW55IGNvbmRpdGlvbmFsIHJldmVhbHMgb24gdGhlIHBhZ2VcbiAgICAgKiAoZm9yIGV4YW1wbGUgaWYgdGhlIHVzZXIgaGFzIG5hdmlnYXRlZCBiYWNrKSwgYW5kIHNldCB1cCBldmVudCBoYW5kbGVycyB0b1xuICAgICAqIGtlZXAgdGhlIHJldmVhbCBpbiBzeW5jIHdpdGggdGhlIHJhZGlvIHN0YXRlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50IHwgbnVsbH0gJHJvb3QgLSBIVE1MIGVsZW1lbnQgdG8gdXNlIGZvciByYWRpb3NcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcigkcm9vdCkge1xuICAgICAgc3VwZXIoJHJvb3QpO1xuICAgICAgdGhpcy4kaW5wdXRzID0gdm9pZCAwO1xuICAgICAgY29uc3QgJGlucHV0cyA9IHRoaXMuJHJvb3QucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT1cInJhZGlvXCJdJyk7XG4gICAgICBpZiAoISRpbnB1dHMubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgIGNvbXBvbmVudDogUmFkaW9zLFxuICAgICAgICAgIGlkZW50aWZpZXI6ICdGb3JtIGlucHV0cyAoYDxpbnB1dCB0eXBlPVwicmFkaW9cIj5gKSdcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLiRpbnB1dHMgPSAkaW5wdXRzO1xuICAgICAgdGhpcy4kaW5wdXRzLmZvckVhY2goJGlucHV0ID0+IHtcbiAgICAgICAgY29uc3QgdGFyZ2V0SWQgPSAkaW5wdXQuZ2V0QXR0cmlidXRlKCdkYXRhLWFyaWEtY29udHJvbHMnKTtcbiAgICAgICAgaWYgKCF0YXJnZXRJZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldElkKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFbGVtZW50RXJyb3Ioe1xuICAgICAgICAgICAgY29tcG9uZW50OiBSYWRpb3MsXG4gICAgICAgICAgICBpZGVudGlmaWVyOiBgQ29uZGl0aW9uYWwgcmV2ZWFsIChcXGBpZD1cIiR7dGFyZ2V0SWR9XCJcXGApYFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgICRpbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCB0YXJnZXRJZCk7XG4gICAgICAgICRpbnB1dC5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtYXJpYS1jb250cm9scycpO1xuICAgICAgfSk7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncGFnZXNob3cnLCAoKSA9PiB0aGlzLnN5bmNBbGxDb25kaXRpb25hbFJldmVhbHMoKSk7XG4gICAgICB0aGlzLnN5bmNBbGxDb25kaXRpb25hbFJldmVhbHMoKTtcbiAgICAgIHRoaXMuJHJvb3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB0aGlzLmhhbmRsZUNsaWNrKGV2ZW50KSk7XG4gICAgfVxuICAgIHN5bmNBbGxDb25kaXRpb25hbFJldmVhbHMoKSB7XG4gICAgICB0aGlzLiRpbnB1dHMuZm9yRWFjaCgkaW5wdXQgPT4gdGhpcy5zeW5jQ29uZGl0aW9uYWxSZXZlYWxXaXRoSW5wdXRTdGF0ZSgkaW5wdXQpKTtcbiAgICB9XG4gICAgc3luY0NvbmRpdGlvbmFsUmV2ZWFsV2l0aElucHV0U3RhdGUoJGlucHV0KSB7XG4gICAgICBjb25zdCB0YXJnZXRJZCA9ICRpbnB1dC5nZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnKTtcbiAgICAgIGlmICghdGFyZ2V0SWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgJHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldElkKTtcbiAgICAgIGlmICgkdGFyZ2V0ICE9IG51bGwgJiYgJHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2dvdnVrLXJhZGlvc19fY29uZGl0aW9uYWwnKSkge1xuICAgICAgICBjb25zdCBpbnB1dElzQ2hlY2tlZCA9ICRpbnB1dC5jaGVja2VkO1xuICAgICAgICAkaW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgaW5wdXRJc0NoZWNrZWQudG9TdHJpbmcoKSk7XG4gICAgICAgICR0YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZSgnZ292dWstcmFkaW9zX19jb25kaXRpb25hbC0taGlkZGVuJywgIWlucHV0SXNDaGVja2VkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlQ2xpY2soZXZlbnQpIHtcbiAgICAgIGNvbnN0ICRjbGlja2VkSW5wdXQgPSBldmVudC50YXJnZXQ7XG4gICAgICBpZiAoISgkY2xpY2tlZElucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgfHwgJGNsaWNrZWRJbnB1dC50eXBlICE9PSAncmFkaW8nKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0ICRhbGxJbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPVwicmFkaW9cIl1bYXJpYS1jb250cm9sc10nKTtcbiAgICAgIGNvbnN0ICRjbGlja2VkSW5wdXRGb3JtID0gJGNsaWNrZWRJbnB1dC5mb3JtO1xuICAgICAgY29uc3QgJGNsaWNrZWRJbnB1dE5hbWUgPSAkY2xpY2tlZElucHV0Lm5hbWU7XG4gICAgICAkYWxsSW5wdXRzLmZvckVhY2goJGlucHV0ID0+IHtcbiAgICAgICAgY29uc3QgaGFzU2FtZUZvcm1Pd25lciA9ICRpbnB1dC5mb3JtID09PSAkY2xpY2tlZElucHV0Rm9ybTtcbiAgICAgICAgY29uc3QgaGFzU2FtZU5hbWUgPSAkaW5wdXQubmFtZSA9PT0gJGNsaWNrZWRJbnB1dE5hbWU7XG4gICAgICAgIGlmIChoYXNTYW1lTmFtZSAmJiBoYXNTYW1lRm9ybU93bmVyKSB7XG4gICAgICAgICAgdGhpcy5zeW5jQ29uZGl0aW9uYWxSZXZlYWxXaXRoSW5wdXRTdGF0ZSgkaW5wdXQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgUmFkaW9zLm1vZHVsZU5hbWUgPSAnZ292dWstcmFkaW9zJztcblxuICAvKipcbiAgICogU2VydmljZSBOYXZpZ2F0aW9uIGNvbXBvbmVudFxuICAgKlxuICAgKiBAcHJlc2VydmVcbiAgICovXG4gIGNsYXNzIFNlcnZpY2VOYXZpZ2F0aW9uIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnQgfCBudWxsfSAkcm9vdCAtIEhUTUwgZWxlbWVudCB0byB1c2UgZm9yIGhlYWRlclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCRyb290KSB7XG4gICAgICBzdXBlcigkcm9vdCk7XG4gICAgICB0aGlzLiRtZW51QnV0dG9uID0gdm9pZCAwO1xuICAgICAgdGhpcy4kbWVudSA9IHZvaWQgMDtcbiAgICAgIHRoaXMubWVudUlzT3BlbiA9IGZhbHNlO1xuICAgICAgdGhpcy5tcWwgPSBudWxsO1xuICAgICAgY29uc3QgJG1lbnVCdXR0b24gPSB0aGlzLiRyb290LnF1ZXJ5U2VsZWN0b3IoJy5nb3Z1ay1qcy1zZXJ2aWNlLW5hdmlnYXRpb24tdG9nZ2xlJyk7XG4gICAgICBpZiAoISRtZW51QnV0dG9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgY29uc3QgbWVudUlkID0gJG1lbnVCdXR0b24uZ2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJyk7XG4gICAgICBpZiAoIW1lbnVJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICBjb21wb25lbnQ6IFNlcnZpY2VOYXZpZ2F0aW9uLFxuICAgICAgICAgIGlkZW50aWZpZXI6ICdOYXZpZ2F0aW9uIGJ1dHRvbiAoYDxidXR0b24gY2xhc3M9XCJnb3Z1ay1qcy1zZXJ2aWNlLW5hdmlnYXRpb24tdG9nZ2xlXCI+YCkgYXR0cmlidXRlIChgYXJpYS1jb250cm9sc2ApJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0ICRtZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobWVudUlkKTtcbiAgICAgIGlmICghJG1lbnUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVsZW1lbnRFcnJvcih7XG4gICAgICAgICAgY29tcG9uZW50OiBTZXJ2aWNlTmF2aWdhdGlvbixcbiAgICAgICAgICBlbGVtZW50OiAkbWVudSxcbiAgICAgICAgICBpZGVudGlmaWVyOiBgTmF2aWdhdGlvbiAoXFxgPHVsIGlkPVwiJHttZW51SWR9XCI+XFxgKWBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLiRtZW51ID0gJG1lbnU7XG4gICAgICB0aGlzLiRtZW51QnV0dG9uID0gJG1lbnVCdXR0b247XG4gICAgICB0aGlzLnNldHVwUmVzcG9uc2l2ZUNoZWNrcygpO1xuICAgICAgdGhpcy4kbWVudUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuaGFuZGxlTWVudUJ1dHRvbkNsaWNrKCkpO1xuICAgIH1cbiAgICBzZXR1cFJlc3BvbnNpdmVDaGVja3MoKSB7XG4gICAgICBjb25zdCBicmVha3BvaW50ID0gZ2V0QnJlYWtwb2ludCgndGFibGV0Jyk7XG4gICAgICBpZiAoIWJyZWFrcG9pbnQudmFsdWUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVsZW1lbnRFcnJvcih7XG4gICAgICAgICAgY29tcG9uZW50OiBTZXJ2aWNlTmF2aWdhdGlvbixcbiAgICAgICAgICBpZGVudGlmaWVyOiBgQ1NTIGN1c3RvbSBwcm9wZXJ0eSAoXFxgJHticmVha3BvaW50LnByb3BlcnR5fVxcYCkgb24gcHNldWRvLWNsYXNzIFxcYDpyb290XFxgYFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMubXFsID0gd2luZG93Lm1hdGNoTWVkaWEoYChtaW4td2lkdGg6ICR7YnJlYWtwb2ludC52YWx1ZX0pYCk7XG4gICAgICBpZiAoJ2FkZEV2ZW50TGlzdGVuZXInIGluIHRoaXMubXFsKSB7XG4gICAgICAgIHRoaXMubXFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHRoaXMuY2hlY2tNb2RlKCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5tcWwuYWRkTGlzdGVuZXIoKCkgPT4gdGhpcy5jaGVja01vZGUoKSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNoZWNrTW9kZSgpO1xuICAgIH1cbiAgICBjaGVja01vZGUoKSB7XG4gICAgICBpZiAoIXRoaXMubXFsIHx8ICF0aGlzLiRtZW51IHx8ICF0aGlzLiRtZW51QnV0dG9uKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1xbC5tYXRjaGVzKSB7XG4gICAgICAgIHRoaXMuJG1lbnUucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgdGhpcy4kbWVudUJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICcnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuJG1lbnVCdXR0b24ucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcbiAgICAgICAgdGhpcy4kbWVudUJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0aGlzLm1lbnVJc09wZW4udG9TdHJpbmcoKSk7XG4gICAgICAgIGlmICh0aGlzLm1lbnVJc09wZW4pIHtcbiAgICAgICAgICB0aGlzLiRtZW51LnJlbW92ZUF0dHJpYnV0ZSgnaGlkZGVuJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy4kbWVudS5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsICcnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVNZW51QnV0dG9uQ2xpY2soKSB7XG4gICAgICB0aGlzLm1lbnVJc09wZW4gPSAhdGhpcy5tZW51SXNPcGVuO1xuICAgICAgdGhpcy5jaGVja01vZGUoKTtcbiAgICB9XG4gIH1cbiAgU2VydmljZU5hdmlnYXRpb24ubW9kdWxlTmFtZSA9ICdnb3Z1ay1zZXJ2aWNlLW5hdmlnYXRpb24nO1xuXG4gIC8qKlxuICAgKiBTa2lwIGxpbmsgY29tcG9uZW50XG4gICAqXG4gICAqIEBwcmVzZXJ2ZVxuICAgKiBAYXVnbWVudHMgQ29tcG9uZW50PEhUTUxBbmNob3JFbGVtZW50PlxuICAgKi9cbiAgY2xhc3MgU2tpcExpbmsgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudCB8IG51bGx9ICRyb290IC0gSFRNTCBlbGVtZW50IHRvIHVzZSBmb3Igc2tpcCBsaW5rXG4gICAgICogQHRocm93cyB7RWxlbWVudEVycm9yfSB3aGVuICRyb290IGlzIG5vdCBzZXQgb3IgdGhlIHdyb25nIHR5cGVcbiAgICAgKiBAdGhyb3dzIHtFbGVtZW50RXJyb3J9IHdoZW4gJHJvb3QuaGFzaCBkb2VzIG5vdCBjb250YWluIGEgaGFzaFxuICAgICAqIEB0aHJvd3Mge0VsZW1lbnRFcnJvcn0gd2hlbiB0aGUgbGlua2VkIGVsZW1lbnQgaXMgbWlzc2luZyBvciB0aGUgd3JvbmcgdHlwZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCRyb290KSB7XG4gICAgICB2YXIgX3RoaXMkJHJvb3QkZ2V0QXR0cmliO1xuICAgICAgc3VwZXIoJHJvb3QpO1xuICAgICAgY29uc3QgaGFzaCA9IHRoaXMuJHJvb3QuaGFzaDtcbiAgICAgIGNvbnN0IGhyZWYgPSAoX3RoaXMkJHJvb3QkZ2V0QXR0cmliID0gdGhpcy4kcm9vdC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSkgIT0gbnVsbCA/IF90aGlzJCRyb290JGdldEF0dHJpYiA6ICcnO1xuICAgICAgbGV0IHVybDtcbiAgICAgIHRyeSB7XG4gICAgICAgIHVybCA9IG5ldyB3aW5kb3cuVVJMKHRoaXMuJHJvb3QuaHJlZik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKGBTa2lwIGxpbms6IFRhcmdldCBsaW5rIChcXGBocmVmPVwiJHtocmVmfVwiXFxgKSBpcyBpbnZhbGlkYCk7XG4gICAgICB9XG4gICAgICBpZiAodXJsLm9yaWdpbiAhPT0gd2luZG93LmxvY2F0aW9uLm9yaWdpbiB8fCB1cmwucGF0aG5hbWUgIT09IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBsaW5rZWRFbGVtZW50SWQgPSBnZXRGcmFnbWVudEZyb21VcmwoaGFzaCk7XG4gICAgICBpZiAoIWxpbmtlZEVsZW1lbnRJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKGBTa2lwIGxpbms6IFRhcmdldCBsaW5rIChcXGBocmVmPVwiJHtocmVmfVwiXFxgKSBoYXMgbm8gaGFzaCBmcmFnbWVudGApO1xuICAgICAgfVxuICAgICAgY29uc3QgJGxpbmtlZEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaW5rZWRFbGVtZW50SWQpO1xuICAgICAgaWYgKCEkbGlua2VkRWxlbWVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICBjb21wb25lbnQ6IFNraXBMaW5rLFxuICAgICAgICAgIGVsZW1lbnQ6ICRsaW5rZWRFbGVtZW50LFxuICAgICAgICAgIGlkZW50aWZpZXI6IGBUYXJnZXQgY29udGVudCAoXFxgaWQ9XCIke2xpbmtlZEVsZW1lbnRJZH1cIlxcYClgXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy4kcm9vdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldEZvY3VzKCRsaW5rZWRFbGVtZW50LCB7XG4gICAgICAgIG9uQmVmb3JlRm9jdXMoKSB7XG4gICAgICAgICAgJGxpbmtlZEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZ292dWstc2tpcC1saW5rLWZvY3VzZWQtZWxlbWVudCcpO1xuICAgICAgICB9LFxuICAgICAgICBvbkJsdXIoKSB7XG4gICAgICAgICAgJGxpbmtlZEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZ292dWstc2tpcC1saW5rLWZvY3VzZWQtZWxlbWVudCcpO1xuICAgICAgICB9XG4gICAgICB9KSk7XG4gICAgfVxuICB9XG4gIFNraXBMaW5rLmVsZW1lbnRUeXBlID0gSFRNTEFuY2hvckVsZW1lbnQ7XG4gIFNraXBMaW5rLm1vZHVsZU5hbWUgPSAnZ292dWstc2tpcC1saW5rJztcblxuICAvKipcbiAgICogVGFicyBjb21wb25lbnRcbiAgICpcbiAgICogQHByZXNlcnZlXG4gICAqL1xuICBjbGFzcyBUYWJzIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnQgfCBudWxsfSAkcm9vdCAtIEhUTUwgZWxlbWVudCB0byB1c2UgZm9yIHRhYnNcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcigkcm9vdCkge1xuICAgICAgc3VwZXIoJHJvb3QpO1xuICAgICAgdGhpcy4kdGFicyA9IHZvaWQgMDtcbiAgICAgIHRoaXMuJHRhYkxpc3QgPSB2b2lkIDA7XG4gICAgICB0aGlzLiR0YWJMaXN0SXRlbXMgPSB2b2lkIDA7XG4gICAgICB0aGlzLmpzSGlkZGVuQ2xhc3MgPSAnZ292dWstdGFic19fcGFuZWwtLWhpZGRlbic7XG4gICAgICB0aGlzLmNoYW5naW5nSGFzaCA9IGZhbHNlO1xuICAgICAgdGhpcy5ib3VuZFRhYkNsaWNrID0gdm9pZCAwO1xuICAgICAgdGhpcy5ib3VuZFRhYktleWRvd24gPSB2b2lkIDA7XG4gICAgICB0aGlzLmJvdW5kT25IYXNoQ2hhbmdlID0gdm9pZCAwO1xuICAgICAgdGhpcy5tcWwgPSBudWxsO1xuICAgICAgY29uc3QgJHRhYnMgPSB0aGlzLiRyb290LnF1ZXJ5U2VsZWN0b3JBbGwoJ2EuZ292dWstdGFic19fdGFiJyk7XG4gICAgICBpZiAoISR0YWJzLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICBjb21wb25lbnQ6IFRhYnMsXG4gICAgICAgICAgaWRlbnRpZmllcjogJ0xpbmtzIChgPGEgY2xhc3M9XCJnb3Z1ay10YWJzX190YWJcIj5gKSdcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLiR0YWJzID0gJHRhYnM7XG4gICAgICB0aGlzLmJvdW5kVGFiQ2xpY2sgPSB0aGlzLm9uVGFiQ2xpY2suYmluZCh0aGlzKTtcbiAgICAgIHRoaXMuYm91bmRUYWJLZXlkb3duID0gdGhpcy5vblRhYktleWRvd24uYmluZCh0aGlzKTtcbiAgICAgIHRoaXMuYm91bmRPbkhhc2hDaGFuZ2UgPSB0aGlzLm9uSGFzaENoYW5nZS5iaW5kKHRoaXMpO1xuICAgICAgY29uc3QgJHRhYkxpc3QgPSB0aGlzLiRyb290LnF1ZXJ5U2VsZWN0b3IoJy5nb3Z1ay10YWJzX19saXN0Jyk7XG4gICAgICBjb25zdCAkdGFiTGlzdEl0ZW1zID0gdGhpcy4kcm9vdC5xdWVyeVNlbGVjdG9yQWxsKCdsaS5nb3Z1ay10YWJzX19saXN0LWl0ZW0nKTtcbiAgICAgIGlmICghJHRhYkxpc3QpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVsZW1lbnRFcnJvcih7XG4gICAgICAgICAgY29tcG9uZW50OiBUYWJzLFxuICAgICAgICAgIGlkZW50aWZpZXI6ICdMaXN0IChgPHVsIGNsYXNzPVwiZ292dWstdGFic19fbGlzdFwiPmApJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICghJHRhYkxpc3RJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVsZW1lbnRFcnJvcih7XG4gICAgICAgICAgY29tcG9uZW50OiBUYWJzLFxuICAgICAgICAgIGlkZW50aWZpZXI6ICdMaXN0IGl0ZW1zIChgPGxpIGNsYXNzPVwiZ292dWstdGFic19fbGlzdC1pdGVtXCI+YCknXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy4kdGFiTGlzdCA9ICR0YWJMaXN0O1xuICAgICAgdGhpcy4kdGFiTGlzdEl0ZW1zID0gJHRhYkxpc3RJdGVtcztcbiAgICAgIHRoaXMuc2V0dXBSZXNwb25zaXZlQ2hlY2tzKCk7XG4gICAgfVxuICAgIHNldHVwUmVzcG9uc2l2ZUNoZWNrcygpIHtcbiAgICAgIGNvbnN0IGJyZWFrcG9pbnQgPSBnZXRCcmVha3BvaW50KCd0YWJsZXQnKTtcbiAgICAgIGlmICghYnJlYWtwb2ludC52YWx1ZSkge1xuICAgICAgICB0aHJvdyBuZXcgRWxlbWVudEVycm9yKHtcbiAgICAgICAgICBjb21wb25lbnQ6IFRhYnMsXG4gICAgICAgICAgaWRlbnRpZmllcjogYENTUyBjdXN0b20gcHJvcGVydHkgKFxcYCR7YnJlYWtwb2ludC5wcm9wZXJ0eX1cXGApIG9uIHBzZXVkby1jbGFzcyBcXGA6cm9vdFxcYGBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLm1xbCA9IHdpbmRvdy5tYXRjaE1lZGlhKGAobWluLXdpZHRoOiAke2JyZWFrcG9pbnQudmFsdWV9KWApO1xuICAgICAgaWYgKCdhZGRFdmVudExpc3RlbmVyJyBpbiB0aGlzLm1xbCkge1xuICAgICAgICB0aGlzLm1xbC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB0aGlzLmNoZWNrTW9kZSgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubXFsLmFkZExpc3RlbmVyKCgpID0+IHRoaXMuY2hlY2tNb2RlKCkpO1xuICAgICAgfVxuICAgICAgdGhpcy5jaGVja01vZGUoKTtcbiAgICB9XG4gICAgY2hlY2tNb2RlKCkge1xuICAgICAgdmFyIF90aGlzJG1xbDtcbiAgICAgIGlmICgoX3RoaXMkbXFsID0gdGhpcy5tcWwpICE9IG51bGwgJiYgX3RoaXMkbXFsLm1hdGNoZXMpIHtcbiAgICAgICAgdGhpcy5zZXR1cCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50ZWFyZG93bigpO1xuICAgICAgfVxuICAgIH1cbiAgICBzZXR1cCgpIHtcbiAgICAgIHZhciBfdGhpcyRnZXRUYWI7XG4gICAgICB0aGlzLiR0YWJMaXN0LnNldEF0dHJpYnV0ZSgncm9sZScsICd0YWJsaXN0Jyk7XG4gICAgICB0aGlzLiR0YWJMaXN0SXRlbXMuZm9yRWFjaCgkaXRlbSA9PiB7XG4gICAgICAgICRpdGVtLnNldEF0dHJpYnV0ZSgncm9sZScsICdwcmVzZW50YXRpb24nKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy4kdGFicy5mb3JFYWNoKCR0YWIgPT4ge1xuICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZXMoJHRhYik7XG4gICAgICAgICR0YWIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmJvdW5kVGFiQ2xpY2ssIHRydWUpO1xuICAgICAgICAkdGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmJvdW5kVGFiS2V5ZG93biwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuaGlkZVRhYigkdGFiKTtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgJGFjdGl2ZVRhYiA9IChfdGhpcyRnZXRUYWIgPSB0aGlzLmdldFRhYih3aW5kb3cubG9jYXRpb24uaGFzaCkpICE9IG51bGwgPyBfdGhpcyRnZXRUYWIgOiB0aGlzLiR0YWJzWzBdO1xuICAgICAgdGhpcy5zaG93VGFiKCRhY3RpdmVUYWIpO1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2hhc2hjaGFuZ2UnLCB0aGlzLmJvdW5kT25IYXNoQ2hhbmdlLCB0cnVlKTtcbiAgICB9XG4gICAgdGVhcmRvd24oKSB7XG4gICAgICB0aGlzLiR0YWJMaXN0LnJlbW92ZUF0dHJpYnV0ZSgncm9sZScpO1xuICAgICAgdGhpcy4kdGFiTGlzdEl0ZW1zLmZvckVhY2goJGl0ZW0gPT4ge1xuICAgICAgICAkaXRlbS5yZW1vdmVBdHRyaWJ1dGUoJ3JvbGUnKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy4kdGFicy5mb3JFYWNoKCR0YWIgPT4ge1xuICAgICAgICAkdGFiLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5ib3VuZFRhYkNsaWNrLCB0cnVlKTtcbiAgICAgICAgJHRhYi5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5ib3VuZFRhYktleWRvd24sIHRydWUpO1xuICAgICAgICB0aGlzLnVuc2V0QXR0cmlidXRlcygkdGFiKTtcbiAgICAgIH0pO1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2hhc2hjaGFuZ2UnLCB0aGlzLmJvdW5kT25IYXNoQ2hhbmdlLCB0cnVlKTtcbiAgICB9XG4gICAgb25IYXNoQ2hhbmdlKCkge1xuICAgICAgY29uc3QgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuICAgICAgY29uc3QgJHRhYldpdGhIYXNoID0gdGhpcy5nZXRUYWIoaGFzaCk7XG4gICAgICBpZiAoISR0YWJXaXRoSGFzaCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5jaGFuZ2luZ0hhc2gpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2luZ0hhc2ggPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgJHByZXZpb3VzVGFiID0gdGhpcy5nZXRDdXJyZW50VGFiKCk7XG4gICAgICBpZiAoISRwcmV2aW91c1RhYikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmhpZGVUYWIoJHByZXZpb3VzVGFiKTtcbiAgICAgIHRoaXMuc2hvd1RhYigkdGFiV2l0aEhhc2gpO1xuICAgICAgJHRhYldpdGhIYXNoLmZvY3VzKCk7XG4gICAgfVxuICAgIGhpZGVUYWIoJHRhYikge1xuICAgICAgdGhpcy51bmhpZ2hsaWdodFRhYigkdGFiKTtcbiAgICAgIHRoaXMuaGlkZVBhbmVsKCR0YWIpO1xuICAgIH1cbiAgICBzaG93VGFiKCR0YWIpIHtcbiAgICAgIHRoaXMuaGlnaGxpZ2h0VGFiKCR0YWIpO1xuICAgICAgdGhpcy5zaG93UGFuZWwoJHRhYik7XG4gICAgfVxuICAgIGdldFRhYihoYXNoKSB7XG4gICAgICByZXR1cm4gdGhpcy4kcm9vdC5xdWVyeVNlbGVjdG9yKGBhLmdvdnVrLXRhYnNfX3RhYltocmVmPVwiJHtoYXNofVwiXWApO1xuICAgIH1cbiAgICBzZXRBdHRyaWJ1dGVzKCR0YWIpIHtcbiAgICAgIGNvbnN0IHBhbmVsSWQgPSBnZXRGcmFnbWVudEZyb21VcmwoJHRhYi5ocmVmKTtcbiAgICAgIGlmICghcGFuZWxJZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAkdGFiLnNldEF0dHJpYnV0ZSgnaWQnLCBgdGFiXyR7cGFuZWxJZH1gKTtcbiAgICAgICR0YWIuc2V0QXR0cmlidXRlKCdyb2xlJywgJ3RhYicpO1xuICAgICAgJHRhYi5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBwYW5lbElkKTtcbiAgICAgICR0YWIuc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgJ2ZhbHNlJyk7XG4gICAgICAkdGFiLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnLTEnKTtcbiAgICAgIGNvbnN0ICRwYW5lbCA9IHRoaXMuZ2V0UGFuZWwoJHRhYik7XG4gICAgICBpZiAoISRwYW5lbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAkcGFuZWwuc2V0QXR0cmlidXRlKCdyb2xlJywgJ3RhYnBhbmVsJyk7XG4gICAgICAkcGFuZWwuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsbGVkYnknLCAkdGFiLmlkKTtcbiAgICAgICRwYW5lbC5jbGFzc0xpc3QuYWRkKHRoaXMuanNIaWRkZW5DbGFzcyk7XG4gICAgfVxuICAgIHVuc2V0QXR0cmlidXRlcygkdGFiKSB7XG4gICAgICAkdGFiLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTtcbiAgICAgICR0YWIucmVtb3ZlQXR0cmlidXRlKCdyb2xlJyk7XG4gICAgICAkdGFiLnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycpO1xuICAgICAgJHRhYi5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnKTtcbiAgICAgICR0YWIucmVtb3ZlQXR0cmlidXRlKCd0YWJpbmRleCcpO1xuICAgICAgY29uc3QgJHBhbmVsID0gdGhpcy5nZXRQYW5lbCgkdGFiKTtcbiAgICAgIGlmICghJHBhbmVsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgICRwYW5lbC5yZW1vdmVBdHRyaWJ1dGUoJ3JvbGUnKTtcbiAgICAgICRwYW5lbC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtbGFiZWxsZWRieScpO1xuICAgICAgJHBhbmVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5qc0hpZGRlbkNsYXNzKTtcbiAgICB9XG4gICAgb25UYWJDbGljayhldmVudCkge1xuICAgICAgY29uc3QgJGN1cnJlbnRUYWIgPSB0aGlzLmdldEN1cnJlbnRUYWIoKTtcbiAgICAgIGNvbnN0ICRuZXh0VGFiID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgIGlmICghJGN1cnJlbnRUYWIgfHwgISgkbmV4dFRhYiBpbnN0YW5jZW9mIEhUTUxBbmNob3JFbGVtZW50KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5oaWRlVGFiKCRjdXJyZW50VGFiKTtcbiAgICAgIHRoaXMuc2hvd1RhYigkbmV4dFRhYik7XG4gICAgICB0aGlzLmNyZWF0ZUhpc3RvcnlFbnRyeSgkbmV4dFRhYik7XG4gICAgfVxuICAgIGNyZWF0ZUhpc3RvcnlFbnRyeSgkdGFiKSB7XG4gICAgICBjb25zdCAkcGFuZWwgPSB0aGlzLmdldFBhbmVsKCR0YWIpO1xuICAgICAgaWYgKCEkcGFuZWwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgcGFuZWxJZCA9ICRwYW5lbC5pZDtcbiAgICAgICRwYW5lbC5pZCA9ICcnO1xuICAgICAgdGhpcy5jaGFuZ2luZ0hhc2ggPSB0cnVlO1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBwYW5lbElkO1xuICAgICAgJHBhbmVsLmlkID0gcGFuZWxJZDtcbiAgICB9XG4gICAgb25UYWJLZXlkb3duKGV2ZW50KSB7XG4gICAgICBzd2l0Y2ggKGV2ZW50LmtleSkge1xuICAgICAgICBjYXNlICdBcnJvd0xlZnQnOlxuICAgICAgICBjYXNlICdMZWZ0JzpcbiAgICAgICAgICB0aGlzLmFjdGl2YXRlUHJldmlvdXNUYWIoKTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdBcnJvd1JpZ2h0JzpcbiAgICAgICAgY2FzZSAnUmlnaHQnOlxuICAgICAgICAgIHRoaXMuYWN0aXZhdGVOZXh0VGFiKCk7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgYWN0aXZhdGVOZXh0VGFiKCkge1xuICAgICAgY29uc3QgJGN1cnJlbnRUYWIgPSB0aGlzLmdldEN1cnJlbnRUYWIoKTtcbiAgICAgIGlmICghKCRjdXJyZW50VGFiICE9IG51bGwgJiYgJGN1cnJlbnRUYWIucGFyZW50RWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgJG5leHRUYWJMaXN0SXRlbSA9ICRjdXJyZW50VGFiLnBhcmVudEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICAgaWYgKCEkbmV4dFRhYkxpc3RJdGVtKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0ICRuZXh0VGFiID0gJG5leHRUYWJMaXN0SXRlbS5xdWVyeVNlbGVjdG9yKCdhLmdvdnVrLXRhYnNfX3RhYicpO1xuICAgICAgaWYgKCEkbmV4dFRhYikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmhpZGVUYWIoJGN1cnJlbnRUYWIpO1xuICAgICAgdGhpcy5zaG93VGFiKCRuZXh0VGFiKTtcbiAgICAgICRuZXh0VGFiLmZvY3VzKCk7XG4gICAgICB0aGlzLmNyZWF0ZUhpc3RvcnlFbnRyeSgkbmV4dFRhYik7XG4gICAgfVxuICAgIGFjdGl2YXRlUHJldmlvdXNUYWIoKSB7XG4gICAgICBjb25zdCAkY3VycmVudFRhYiA9IHRoaXMuZ2V0Q3VycmVudFRhYigpO1xuICAgICAgaWYgKCEoJGN1cnJlbnRUYWIgIT0gbnVsbCAmJiAkY3VycmVudFRhYi5wYXJlbnRFbGVtZW50KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCAkcHJldmlvdXNUYWJMaXN0SXRlbSA9ICRjdXJyZW50VGFiLnBhcmVudEVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgIGlmICghJHByZXZpb3VzVGFiTGlzdEl0ZW0pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgJHByZXZpb3VzVGFiID0gJHByZXZpb3VzVGFiTGlzdEl0ZW0ucXVlcnlTZWxlY3RvcignYS5nb3Z1ay10YWJzX190YWInKTtcbiAgICAgIGlmICghJHByZXZpb3VzVGFiKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuaGlkZVRhYigkY3VycmVudFRhYik7XG4gICAgICB0aGlzLnNob3dUYWIoJHByZXZpb3VzVGFiKTtcbiAgICAgICRwcmV2aW91c1RhYi5mb2N1cygpO1xuICAgICAgdGhpcy5jcmVhdGVIaXN0b3J5RW50cnkoJHByZXZpb3VzVGFiKTtcbiAgICB9XG4gICAgZ2V0UGFuZWwoJHRhYikge1xuICAgICAgY29uc3QgcGFuZWxJZCA9IGdldEZyYWdtZW50RnJvbVVybCgkdGFiLmhyZWYpO1xuICAgICAgaWYgKCFwYW5lbElkKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuJHJvb3QucXVlcnlTZWxlY3RvcihgIyR7cGFuZWxJZH1gKTtcbiAgICB9XG4gICAgc2hvd1BhbmVsKCR0YWIpIHtcbiAgICAgIGNvbnN0ICRwYW5lbCA9IHRoaXMuZ2V0UGFuZWwoJHRhYik7XG4gICAgICBpZiAoISRwYW5lbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAkcGFuZWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmpzSGlkZGVuQ2xhc3MpO1xuICAgIH1cbiAgICBoaWRlUGFuZWwoJHRhYikge1xuICAgICAgY29uc3QgJHBhbmVsID0gdGhpcy5nZXRQYW5lbCgkdGFiKTtcbiAgICAgIGlmICghJHBhbmVsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgICRwYW5lbC5jbGFzc0xpc3QuYWRkKHRoaXMuanNIaWRkZW5DbGFzcyk7XG4gICAgfVxuICAgIHVuaGlnaGxpZ2h0VGFiKCR0YWIpIHtcbiAgICAgIGlmICghJHRhYi5wYXJlbnRFbGVtZW50KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgICR0YWIuc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgJ2ZhbHNlJyk7XG4gICAgICAkdGFiLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZ292dWstdGFic19fbGlzdC1pdGVtLS1zZWxlY3RlZCcpO1xuICAgICAgJHRhYi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgfVxuICAgIGhpZ2hsaWdodFRhYigkdGFiKSB7XG4gICAgICBpZiAoISR0YWIucGFyZW50RWxlbWVudCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAkdGFiLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsICd0cnVlJyk7XG4gICAgICAkdGFiLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZ292dWstdGFic19fbGlzdC1pdGVtLS1zZWxlY3RlZCcpO1xuICAgICAgJHRhYi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgICB9XG4gICAgZ2V0Q3VycmVudFRhYigpIHtcbiAgICAgIHJldHVybiB0aGlzLiRyb290LnF1ZXJ5U2VsZWN0b3IoJy5nb3Z1ay10YWJzX19saXN0LWl0ZW0tLXNlbGVjdGVkIGEuZ292dWstdGFic19fdGFiJyk7XG4gICAgfVxuICB9XG4gIFRhYnMubW9kdWxlTmFtZSA9ICdnb3Z1ay10YWJzJztcblxuICAvKipcbiAgICogSW5pdGlhbGlzZSBhbGwgY29tcG9uZW50c1xuICAgKlxuICAgKiBVc2UgdGhlIGBkYXRhLW1vZHVsZWAgYXR0cmlidXRlcyB0byBmaW5kLCBpbnN0YW50aWF0ZSBhbmQgaW5pdCBhbGwgb2YgdGhlXG4gICAqIGNvbXBvbmVudHMgcHJvdmlkZWQgYXMgcGFydCBvZiBHT1YuVUsgRnJvbnRlbmQuXG4gICAqXG4gICAqIEBwYXJhbSB7Q29uZmlnICYgeyBzY29wZT86IEVsZW1lbnQsIG9uRXJyb3I/OiBPbkVycm9yQ2FsbGJhY2s8Q29tcGF0aWJsZUNsYXNzPiB9fSBbY29uZmlnXSAtIENvbmZpZyBmb3IgYWxsIGNvbXBvbmVudHMgKHdpdGggb3B0aW9uYWwgc2NvcGUpXG4gICAqL1xuICBmdW5jdGlvbiBpbml0QWxsKGNvbmZpZykge1xuICAgIHZhciBfY29uZmlnJHNjb3BlO1xuICAgIGNvbmZpZyA9IHR5cGVvZiBjb25maWcgIT09ICd1bmRlZmluZWQnID8gY29uZmlnIDoge307XG4gICAgaWYgKCFpc1N1cHBvcnRlZCgpKSB7XG4gICAgICBpZiAoY29uZmlnLm9uRXJyb3IpIHtcbiAgICAgICAgY29uZmlnLm9uRXJyb3IobmV3IFN1cHBvcnRFcnJvcigpLCB7XG4gICAgICAgICAgY29uZmlnXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2cobmV3IFN1cHBvcnRFcnJvcigpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY29tcG9uZW50cyA9IFtbQWNjb3JkaW9uLCBjb25maWcuYWNjb3JkaW9uXSwgW0J1dHRvbiwgY29uZmlnLmJ1dHRvbl0sIFtDaGFyYWN0ZXJDb3VudCwgY29uZmlnLmNoYXJhY3RlckNvdW50XSwgW0NoZWNrYm94ZXNdLCBbRXJyb3JTdW1tYXJ5LCBjb25maWcuZXJyb3JTdW1tYXJ5XSwgW0V4aXRUaGlzUGFnZSwgY29uZmlnLmV4aXRUaGlzUGFnZV0sIFtGaWxlVXBsb2FkLCBjb25maWcuZmlsZVVwbG9hZF0sIFtIZWFkZXJdLCBbTm90aWZpY2F0aW9uQmFubmVyLCBjb25maWcubm90aWZpY2F0aW9uQmFubmVyXSwgW1Bhc3N3b3JkSW5wdXQsIGNvbmZpZy5wYXNzd29yZElucHV0XSwgW1JhZGlvc10sIFtTZXJ2aWNlTmF2aWdhdGlvbl0sIFtTa2lwTGlua10sIFtUYWJzXV07XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIHNjb3BlOiAoX2NvbmZpZyRzY29wZSA9IGNvbmZpZy5zY29wZSkgIT0gbnVsbCA/IF9jb25maWckc2NvcGUgOiBkb2N1bWVudCxcbiAgICAgIG9uRXJyb3I6IGNvbmZpZy5vbkVycm9yXG4gICAgfTtcbiAgICBjb21wb25lbnRzLmZvckVhY2goKFtDb21wb25lbnQsIGNvbmZpZ10pID0+IHtcbiAgICAgIGNyZWF0ZUFsbChDb21wb25lbnQsIGNvbmZpZywgb3B0aW9ucyk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGFsbCBpbnN0YW5jZXMgb2YgYSBzcGVjaWZpYyBjb21wb25lbnQgb24gdGhlIHBhZ2VcbiAgICpcbiAgICogVXNlcyB0aGUgYGRhdGEtbW9kdWxlYCBhdHRyaWJ1dGUgdG8gZmluZCBhbGwgZWxlbWVudHMgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZFxuICAgKiBjb21wb25lbnQgb24gdGhlIHBhZ2UsIGNyZWF0aW5nIGluc3RhbmNlcyBvZiB0aGUgY29tcG9uZW50IG9iamVjdCBmb3IgZWFjaFxuICAgKiBvZiB0aGVtLlxuICAgKlxuICAgKiBBbnkgY29tcG9uZW50IGVycm9ycyB3aWxsIGJlIGNhdWdodCBhbmQgbG9nZ2VkIHRvIHRoZSBjb25zb2xlLlxuICAgKlxuICAgKiBAdGVtcGxhdGUge0NvbXBhdGlibGVDbGFzc30gQ29tcG9uZW50Q2xhc3NcbiAgICogQHBhcmFtIHtDb21wb25lbnRDbGFzc30gQ29tcG9uZW50IC0gY2xhc3Mgb2YgdGhlIGNvbXBvbmVudCB0byBjcmVhdGVcbiAgICogQHBhcmFtIHtDb21wb25lbnRDb25maWc8Q29tcG9uZW50Q2xhc3M+fSBbY29uZmlnXSAtIENvbmZpZyBzdXBwbGllZCB0byBjb21wb25lbnRcbiAgICogQHBhcmFtIHtPbkVycm9yQ2FsbGJhY2s8Q29tcG9uZW50Q2xhc3M+IHwgRWxlbWVudCB8IERvY3VtZW50IHwgQ3JlYXRlQWxsT3B0aW9uczxDb21wb25lbnRDbGFzcz4gfSBbY3JlYXRlQWxsT3B0aW9uc10gLSBvcHRpb25zIGZvciBjcmVhdGVBbGwgaW5jbHVkaW5nIHNjb3BlIG9mIHRoZSBkb2N1bWVudCB0byBzZWFyY2ggd2l0aGluIGFuZCBjYWxsYmFjayBmdW5jdGlvbiBpZiBlcnJvciB0aHJvdyBieSBjb21wb25lbnQgb24gaW5pdFxuICAgKiBAcmV0dXJucyB7QXJyYXk8SW5zdGFuY2VUeXBlPENvbXBvbmVudENsYXNzPj59IC0gYXJyYXkgb2YgaW5zdGFudGlhdGVkIGNvbXBvbmVudHNcbiAgICovXG4gIGZ1bmN0aW9uIGNyZWF0ZUFsbChDb21wb25lbnQsIGNvbmZpZywgY3JlYXRlQWxsT3B0aW9ucykge1xuICAgIGxldCAkc2NvcGUgPSBkb2N1bWVudDtcbiAgICBsZXQgb25FcnJvcjtcbiAgICBpZiAodHlwZW9mIGNyZWF0ZUFsbE9wdGlvbnMgPT09ICdvYmplY3QnKSB7XG4gICAgICB2YXIgX2NyZWF0ZUFsbE9wdGlvbnMkc2NvO1xuICAgICAgY3JlYXRlQWxsT3B0aW9ucyA9IGNyZWF0ZUFsbE9wdGlvbnM7XG4gICAgICAkc2NvcGUgPSAoX2NyZWF0ZUFsbE9wdGlvbnMkc2NvID0gY3JlYXRlQWxsT3B0aW9ucy5zY29wZSkgIT0gbnVsbCA/IF9jcmVhdGVBbGxPcHRpb25zJHNjbyA6ICRzY29wZTtcbiAgICAgIG9uRXJyb3IgPSBjcmVhdGVBbGxPcHRpb25zLm9uRXJyb3I7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY3JlYXRlQWxsT3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgb25FcnJvciA9IGNyZWF0ZUFsbE9wdGlvbnM7XG4gICAgfVxuICAgIGlmIChjcmVhdGVBbGxPcHRpb25zIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcbiAgICAgICRzY29wZSA9IGNyZWF0ZUFsbE9wdGlvbnM7XG4gICAgfVxuICAgIGNvbnN0ICRlbGVtZW50cyA9ICRzY29wZS5xdWVyeVNlbGVjdG9yQWxsKGBbZGF0YS1tb2R1bGU9XCIke0NvbXBvbmVudC5tb2R1bGVOYW1lfVwiXWApO1xuICAgIGlmICghaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgaWYgKG9uRXJyb3IpIHtcbiAgICAgICAgb25FcnJvcihuZXcgU3VwcG9ydEVycm9yKCksIHtcbiAgICAgICAgICBjb21wb25lbnQ6IENvbXBvbmVudCxcbiAgICAgICAgICBjb25maWdcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhuZXcgU3VwcG9ydEVycm9yKCkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICByZXR1cm4gQXJyYXkuZnJvbSgkZWxlbWVudHMpLm1hcCgkZWxlbWVudCA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIGNvbmZpZyAhPT0gJ3VuZGVmaW5lZCcgPyBuZXcgQ29tcG9uZW50KCRlbGVtZW50LCBjb25maWcpIDogbmV3IENvbXBvbmVudCgkZWxlbWVudCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBpZiAob25FcnJvcikge1xuICAgICAgICAgIG9uRXJyb3IoZXJyb3IsIHtcbiAgICAgICAgICAgIGVsZW1lbnQ6ICRlbGVtZW50LFxuICAgICAgICAgICAgY29tcG9uZW50OiBDb21wb25lbnQsXG4gICAgICAgICAgICBjb25maWdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfSkuZmlsdGVyKEJvb2xlYW4pO1xuICB9XG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7e25ldyAoLi4uYXJnczogYW55W10pOiBhbnksIG1vZHVsZU5hbWU6IHN0cmluZ319IENvbXBhdGlibGVDbGFzc1xuICAgKi9cbiAgLyoqXG4gICAqIENvbmZpZyBmb3IgYWxsIGNvbXBvbmVudHMgdmlhIGBpbml0QWxsKClgXG4gICAqXG4gICAqIEB0eXBlZGVmIHtvYmplY3R9IENvbmZpZ1xuICAgKiBAcHJvcGVydHkge0FjY29yZGlvbkNvbmZpZ30gW2FjY29yZGlvbl0gLSBBY2NvcmRpb24gY29uZmlnXG4gICAqIEBwcm9wZXJ0eSB7QnV0dG9uQ29uZmlnfSBbYnV0dG9uXSAtIEJ1dHRvbiBjb25maWdcbiAgICogQHByb3BlcnR5IHtDaGFyYWN0ZXJDb3VudENvbmZpZ30gW2NoYXJhY3RlckNvdW50XSAtIENoYXJhY3RlciBDb3VudCBjb25maWdcbiAgICogQHByb3BlcnR5IHtFcnJvclN1bW1hcnlDb25maWd9IFtlcnJvclN1bW1hcnldIC0gRXJyb3IgU3VtbWFyeSBjb25maWdcbiAgICogQHByb3BlcnR5IHtFeGl0VGhpc1BhZ2VDb25maWd9IFtleGl0VGhpc1BhZ2VdIC0gRXhpdCBUaGlzIFBhZ2UgY29uZmlnXG4gICAqIEBwcm9wZXJ0eSB7RmlsZVVwbG9hZENvbmZpZ30gW2ZpbGVVcGxvYWRdIC0gRmlsZSBVcGxvYWQgY29uZmlnXG4gICAqIEBwcm9wZXJ0eSB7Tm90aWZpY2F0aW9uQmFubmVyQ29uZmlnfSBbbm90aWZpY2F0aW9uQmFubmVyXSAtIE5vdGlmaWNhdGlvbiBCYW5uZXIgY29uZmlnXG4gICAqIEBwcm9wZXJ0eSB7UGFzc3dvcmRJbnB1dENvbmZpZ30gW3Bhc3N3b3JkSW5wdXRdIC0gUGFzc3dvcmQgaW5wdXQgY29uZmlnXG4gICAqL1xuICAvKipcbiAgICogQ29uZmlnIGZvciBpbmRpdmlkdWFsIGNvbXBvbmVudHNcbiAgICpcbiAgICogQGltcG9ydCB7IEFjY29yZGlvbkNvbmZpZyB9IGZyb20gJy4vY29tcG9uZW50cy9hY2NvcmRpb24vYWNjb3JkaW9uLm1qcydcbiAgICogQGltcG9ydCB7IEJ1dHRvbkNvbmZpZyB9IGZyb20gJy4vY29tcG9uZW50cy9idXR0b24vYnV0dG9uLm1qcydcbiAgICogQGltcG9ydCB7IENoYXJhY3RlckNvdW50Q29uZmlnIH0gZnJvbSAnLi9jb21wb25lbnRzL2NoYXJhY3Rlci1jb3VudC9jaGFyYWN0ZXItY291bnQubWpzJ1xuICAgKiBAaW1wb3J0IHsgRXJyb3JTdW1tYXJ5Q29uZmlnIH0gZnJvbSAnLi9jb21wb25lbnRzL2Vycm9yLXN1bW1hcnkvZXJyb3Itc3VtbWFyeS5tanMnXG4gICAqIEBpbXBvcnQgeyBFeGl0VGhpc1BhZ2VDb25maWcgfSBmcm9tICcuL2NvbXBvbmVudHMvZXhpdC10aGlzLXBhZ2UvZXhpdC10aGlzLXBhZ2UubWpzJ1xuICAgKiBAaW1wb3J0IHsgTm90aWZpY2F0aW9uQmFubmVyQ29uZmlnIH0gZnJvbSAnLi9jb21wb25lbnRzL25vdGlmaWNhdGlvbi1iYW5uZXIvbm90aWZpY2F0aW9uLWJhbm5lci5tanMnXG4gICAqIEBpbXBvcnQgeyBQYXNzd29yZElucHV0Q29uZmlnIH0gZnJvbSAnLi9jb21wb25lbnRzL3Bhc3N3b3JkLWlucHV0L3Bhc3N3b3JkLWlucHV0Lm1qcydcbiAgICogQGltcG9ydCB7IEZpbGVVcGxvYWRDb25maWcgfSBmcm9tICcuL2NvbXBvbmVudHMvZmlsZS11cGxvYWQvZmlsZS11cGxvYWQubWpzJ1xuICAgKi9cbiAgLyoqXG4gICAqIENvbXBvbmVudCBjb25maWcga2V5cywgZS5nLiBgYWNjb3JkaW9uYCBhbmQgYGNoYXJhY3RlckNvdW50YFxuICAgKlxuICAgKiBAdHlwZWRlZiB7a2V5b2YgQ29uZmlnfSBDb25maWdLZXlcbiAgICovXG4gIC8qKlxuICAgKiBAdGVtcGxhdGUge0NvbXBhdGlibGVDbGFzc30gQ29tcG9uZW50Q2xhc3NcbiAgICogQHR5cGVkZWYge0NvbnN0cnVjdG9yUGFyYW1ldGVyczxDb21wb25lbnRDbGFzcz5bMV19IENvbXBvbmVudENvbmZpZ1xuICAgKi9cbiAgLyoqXG4gICAqIEB0ZW1wbGF0ZSB7Q29tcGF0aWJsZUNsYXNzfSBDb21wb25lbnRDbGFzc1xuICAgKiBAdHlwZWRlZiB7b2JqZWN0fSBFcnJvckNvbnRleHRcbiAgICogQHByb3BlcnR5IHtFbGVtZW50fSBbZWxlbWVudF0gLSBFbGVtZW50IHVzZWQgZm9yIGNvbXBvbmVudCBtb2R1bGUgaW5pdGlhbGlzYXRpb25cbiAgICogQHByb3BlcnR5IHtDb21wb25lbnRDbGFzc30gW2NvbXBvbmVudF0gLSBDbGFzcyBvZiBjb21wb25lbnRcbiAgICogQHByb3BlcnR5IHtDb21wb25lbnRDb25maWc8Q29tcG9uZW50Q2xhc3M+fSBjb25maWcgLSBDb25maWcgc3VwcGxpZWQgdG8gY29tcG9uZW50XG4gICAqL1xuICAvKipcbiAgICogQHRlbXBsYXRlIHtDb21wYXRpYmxlQ2xhc3N9IENvbXBvbmVudENsYXNzXG4gICAqIEBjYWxsYmFjayBPbkVycm9yQ2FsbGJhY2tcbiAgICogQHBhcmFtIHt1bmtub3dufSBlcnJvciAtIFRocm93biBlcnJvclxuICAgKiBAcGFyYW0ge0Vycm9yQ29udGV4dDxDb21wb25lbnRDbGFzcz59IGNvbnRleHQgLSBPYmplY3QgY29udGFpbmluZyB0aGUgZWxlbWVudCwgY29tcG9uZW50IGNsYXNzIGFuZCBjb25maWd1cmF0aW9uXG4gICAqL1xuICAvKipcbiAgICogQHRlbXBsYXRlIHtDb21wYXRpYmxlQ2xhc3N9IENvbXBvbmVudENsYXNzXG4gICAqIEB0eXBlZGVmIHtvYmplY3R9IENyZWF0ZUFsbE9wdGlvbnNcbiAgICogQHByb3BlcnR5IHtFbGVtZW50IHwgRG9jdW1lbnR9IFtzY29wZV0gLSBzY29wZSBvZiB0aGUgZG9jdW1lbnQgdG8gc2VhcmNoIHdpdGhpblxuICAgKiBAcHJvcGVydHkge09uRXJyb3JDYWxsYmFjazxDb21wb25lbnRDbGFzcz59IFtvbkVycm9yXSAtIGNhbGxiYWNrIGZ1bmN0aW9uIGlmIGVycm9yIHRocm93IGJ5IGNvbXBvbmVudCBvbiBpbml0XG4gICAqL1xuXG4gIGV4cG9ydHMuQWNjb3JkaW9uID0gQWNjb3JkaW9uO1xuICBleHBvcnRzLkJ1dHRvbiA9IEJ1dHRvbjtcbiAgZXhwb3J0cy5DaGFyYWN0ZXJDb3VudCA9IENoYXJhY3RlckNvdW50O1xuICBleHBvcnRzLkNoZWNrYm94ZXMgPSBDaGVja2JveGVzO1xuICBleHBvcnRzLkNvbXBvbmVudCA9IENvbXBvbmVudDtcbiAgZXhwb3J0cy5Db25maWd1cmFibGVDb21wb25lbnQgPSBDb25maWd1cmFibGVDb21wb25lbnQ7XG4gIGV4cG9ydHMuRXJyb3JTdW1tYXJ5ID0gRXJyb3JTdW1tYXJ5O1xuICBleHBvcnRzLkV4aXRUaGlzUGFnZSA9IEV4aXRUaGlzUGFnZTtcbiAgZXhwb3J0cy5GaWxlVXBsb2FkID0gRmlsZVVwbG9hZDtcbiAgZXhwb3J0cy5IZWFkZXIgPSBIZWFkZXI7XG4gIGV4cG9ydHMuTm90aWZpY2F0aW9uQmFubmVyID0gTm90aWZpY2F0aW9uQmFubmVyO1xuICBleHBvcnRzLlBhc3N3b3JkSW5wdXQgPSBQYXNzd29yZElucHV0O1xuICBleHBvcnRzLlJhZGlvcyA9IFJhZGlvcztcbiAgZXhwb3J0cy5TZXJ2aWNlTmF2aWdhdGlvbiA9IFNlcnZpY2VOYXZpZ2F0aW9uO1xuICBleHBvcnRzLlNraXBMaW5rID0gU2tpcExpbms7XG4gIGV4cG9ydHMuVGFicyA9IFRhYnM7XG4gIGV4cG9ydHMuY3JlYXRlQWxsID0gY3JlYXRlQWxsO1xuICBleHBvcnRzLmluaXRBbGwgPSBpbml0QWxsO1xuICBleHBvcnRzLmlzU3VwcG9ydGVkID0gaXNTdXBwb3J0ZWQ7XG4gIGV4cG9ydHMudmVyc2lvbiA9IHZlcnNpb247XG5cbn0pKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFsbC5idW5kbGUuanMubWFwXG4iXX0=
